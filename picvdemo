[{"id":"df9841f2.71dce","type":"tab","label":"MAGNA3 Backend","disabled":false,"info":""},{"id":"41ddd688.39b148","type":"tab","label":"Overall Pump Dashboard","disabled":false,"info":""},{"id":"a37ace7a.dab1a","type":"tab","label":"Simulation Page (Cooling)","disabled":false,"info":""},{"id":"de07c079.634c3","type":"tab","label":"Simulation Page (Heating)","disabled":false,"info":""},{"id":"9a5395ce.c2f6e8","type":"tab","label":"Fault Page","disabled":false,"info":""},{"id":"eea6a755.f6fb28","type":"tab","label":"Valve Overview","disabled":false,"info":""},{"id":"eb529f3f.63dd2","type":"tab","label":"Valve Backend","disabled":false,"info":""},{"id":"6a9884df.6ee45c","type":"tab","label":"FlowMeter","disabled":false,"info":""},{"id":"4826a594.91d66c","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"f973084d.a2c5f8","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#11497b","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#11497b","edited":true},"page-titlebar-backgroundColor":{"value":"#11497b","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#1a71be","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#11497b","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"DPS Demo Unit","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"8dd78c30.ffe35","type":"ui_group","name":"Configuration","tab":"c2200288.0e6cd","order":1,"disp":true,"width":"6","collapse":false},{"id":"562c0b41.4f5f24","type":"modbus-client","name":"MAGNA3","clienttype":"tcp","bufferCommands":false,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"169.254.215.180","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/tmp/modbus","serialType":"RTU-BUFFERD","serialBaudrate":"19200","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":1,"commandDelay":1,"clientTimeout":10000,"reconnectOnTimeout":true,"reconnectTimeout":2000,"parallelUnitIdsAllowed":false},{"id":"2a42b678.b2f55a","type":"ui_tab","name":"MAGNA3 Dashboard","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"806379db.c33df8","type":"ui_group","name":"Controls","tab":"2a42b678.b2f55a","order":1,"disp":true,"width":"6","collapse":false},{"id":"ab3a9e02.8ace9","type":"ui_group","name":"Configuration","tab":"2a42b678.b2f55a","order":2,"disp":true,"width":"6","collapse":false},{"id":"1eed226c.4ab33e","type":"ui_group","name":"Head and Flow","tab":"2a42b678.b2f55a","order":3,"disp":false,"width":"6","collapse":false},{"id":"2635b728.9e6d88","type":"ui_group","name":"Status","tab":"2a42b678.b2f55a","order":5,"disp":true,"width":"6","collapse":false},{"id":"39f5b403.20849c","type":"ui_group","name":"Info","tab":"2a42b678.b2f55a","order":6,"disp":true,"width":"6","collapse":false},{"id":"25ba43c.34f63bc","type":"ui_tab","name":"Warning, Alarms and Faults","icon":"fa-bell","order":4,"disabled":false,"hidden":false},{"id":"bd33570d.7d8268","type":"ui_group","name":"Warning / Alarm","tab":"25ba43c.34f63bc","order":1,"disp":true,"width":"6","collapse":false},{"id":"3256df1b.4a908","type":"ui_group","name":"Faults","tab":"25ba43c.34f63bc","order":2,"disp":true,"width":"6","collapse":false},{"id":"26881754.b529d8","type":"ui_group","name":"Simulation","tab":"25ba43c.34f63bc","order":3,"disp":true,"width":"6","collapse":false},{"id":"3c1be052.4e291","type":"ui_group","name":"Control Simulation (Cooling)","tab":"ea9b6de0.2693d","order":1,"disp":true,"width":"6","collapse":false},{"id":"ea9b6de0.2693d","type":"ui_tab","name":"Simulations","icon":"fa-snowflake-o","order":3,"disabled":false,"hidden":false},{"id":"e9d68c7e.c2fed","type":"ui_group","name":"Visualizations","tab":"ea9b6de0.2693d","order":4,"disp":true,"width":"12","collapse":false},{"id":"a1c8c13.98bb94","type":"ui_group","name":"Water Use","tab":"ea9b6de0.2693d","order":11,"disp":true,"width":"6","collapse":false},{"id":"c3b98441.243208","type":"sqlitedb","db":".node-red/MAGNA3","mode":"RWC"},{"id":"3be2a9e5.53a7f6","type":"ui_group","name":"Database","tab":"ea9b6de0.2693d","order":3,"disp":true,"width":"6","collapse":false},{"id":"276147dc.e6e7f8","type":"modbus-client","name":"RTU MAGNA3","clienttype":"serial","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"127.0.0.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB0","serialType":"RTU-BUFFERD","serialBaudrate":"19200","serialDatabits":"8","serialStopbits":"1","serialParity":"even","serialConnectionDelay":"100","unit_id":17,"commandDelay":1,"clientTimeout":1000,"reconnectOnTimeout":true,"reconnectTimeout":2000,"parallelUnitIdsAllowed":false},{"id":"99f00951.c27168","type":"modbusSerialConfig","d":true,"port":"/dev/ttyUSB0","baud":"38400","data":"8","parity":"even","stop":"1","name":"Test MAGNA3 RTU"},{"id":"c2200288.0e6cd","type":"ui_tab","name":"Valve Overview","icon":"dashboard","disabled":false,"hidden":false},{"id":"e26629c0.74cc58","type":"ui_group","name":"Valve Control","tab":"c2200288.0e6cd","order":2,"disp":true,"width":"6","collapse":false},{"id":"7185a1fe.34f35","type":"ui_group","name":"Data","tab":"c2200288.0e6cd","order":3,"disp":true,"width":"6","collapse":false},{"id":"bb2dbcc9.07f63","type":"ui_group","name":"Pump Data","tab":"c2200288.0e6cd","order":4,"disp":true,"width":"6","collapse":false},{"id":"d97a3a3.5b566c8","type":"ui_group","name":"Temperatures","tab":"ea9b6de0.2693d","order":13,"disp":true,"width":"6","collapse":false},{"id":"5bc5e1ec.4bddf","type":"ui_group","name":"Pump Status (Cooling)","tab":"ea9b6de0.2693d","order":15,"disp":true,"width":"6","collapse":false},{"id":"8911427a.03002","type":"ui_group","name":"Pump Duty Point","tab":"ea9b6de0.2693d","order":5,"disp":true,"width":"6","collapse":false},{"id":"ebb8f692.86f908","type":"ui_group","name":"help and information","tab":"ea9b6de0.2693d","order":2,"disp":false,"width":"6","collapse":false},{"id":"38d14db9.3d4dd2","type":"ui_group","name":"Duty Point","tab":"2a42b678.b2f55a","order":4,"disp":true,"width":"6","collapse":false},{"id":"8443a485.7acdd8","type":"ui_group","name":"Valve Position (Cooling)","tab":"ea9b6de0.2693d","order":16,"disp":true,"width":"6","collapse":false},{"id":"a09ba203.8376","type":"ui_group","name":"Power and RPM (Cooling)","tab":"ea9b6de0.2693d","order":10,"disp":true,"width":"6","collapse":false},{"id":"84e42c64.70197","type":"ui_group","name":"Group 2","tab":"","order":2,"disp":true,"width":6},{"id":"248473c9.d2f6bc","type":"ui_group","name":"Gauges","tab":"2a42b678.b2f55a","order":7,"disp":true,"width":"6","collapse":false},{"id":"af265a.c2f459a8","type":"ui_group","name":"Power Flow","tab":"ea9b6de0.2693d","order":12,"disp":true,"width":"6","collapse":false},{"id":"c98bda22.201598","type":"ui_group","name":"Controls","tab":"f03bd0a1.4ad42","order":1,"disp":true,"width":"6","collapse":false},{"id":"a27d3f3.5007cc","type":"sqlitedb","db":".node-red/MAGNA3","mode":"RWC"},{"id":"aa81d4d2.b0f7c8","type":"modbus-client","name":"RTU MAGNA3","clienttype":"serial","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"127.0.0.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB0","serialType":"RTU-BUFFERD","serialBaudrate":"19200","serialDatabits":"8","serialStopbits":"1","serialParity":"even","serialConnectionDelay":"100","unit_id":"17","commandDelay":"1","clientTimeout":"1000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":false},{"id":"f03bd0a1.4ad42","type":"ui_tab","name":"MAGNA3 Dashboard","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"5112450.59176bc","type":"ui_tab","name":"Simulations","icon":"fa-fire","order":2,"disabled":false,"hidden":false},{"id":"988388a.75b7578","type":"ui_group","name":"Control Simulation (Heating)","tab":"5112450.59176bc","order":1,"disp":true,"width":"6","collapse":false},{"id":"19b2742b.3d2acc","type":"ui_group","name":"help and information","tab":"5112450.59176bc","order":2,"disp":true,"width":"6","collapse":false},{"id":"b4b31549.5df0c8","type":"ui_group","name":"Database","tab":"5112450.59176bc","order":3,"disp":true,"width":"6","collapse":false},{"id":"69749989.81e7e8","type":"ui_group","name":"Visualizations","tab":"5112450.59176bc","order":4,"disp":true,"width":"12","collapse":false},{"id":"886dc0ab.cbd76","type":"ui_group","name":"Pump Duty Point","tab":"5112450.59176bc","order":5,"disp":true,"width":"6","collapse":false},{"id":"e1ad3e01.8681d","type":"ui_group","name":"Power and RPM (Heating)","tab":"5112450.59176bc","order":7,"disp":true,"width":"6","collapse":false},{"id":"79204422.47fc5c","type":"ui_group","name":"Water Use","tab":"5112450.59176bc","order":8,"disp":true,"width":"6","collapse":false},{"id":"63a393e.67e446c","type":"ui_group","name":"Temperatures","tab":"5112450.59176bc","order":9,"disp":true,"width":"6","collapse":false},{"id":"2fa7e0a2.4b9c8","type":"ui_group","name":"Pump Status (Heating)","tab":"5112450.59176bc","order":11,"disp":true,"width":"6","collapse":false},{"id":"16714a80.c29cf6","type":"ui_group","name":"Valve Position (Heating)","tab":"5112450.59176bc","order":12,"disp":true,"width":"6","collapse":false},{"id":"165f672.651a899","type":"ui_group","z":"4826a594.91d66c","name":"Click","tab":"","order":1,"disp":true,"width":"5"},{"id":"961a2f02.8716d","type":"ui_group","name":"Flow (Cooling)","tab":"ea9b6de0.2693d","order":17,"disp":true,"width":"6","collapse":false},{"id":"569c7584.71325c","type":"ui_group","name":"Pressure (Cooling)","tab":"ea9b6de0.2693d","order":18,"disp":true,"width":"6","collapse":false},{"id":"e932fe53.8056","type":"ui_group","name":"RWT (Cooling)","tab":"ea9b6de0.2693d","order":19,"disp":true,"width":"6","collapse":false},{"id":"23da77c.24a8d88","type":"ui_group","name":"Supply Air Temp (Cooling)","tab":"ea9b6de0.2693d","order":14,"disp":true,"width":"6","collapse":false},{"id":"c08fc457.414228","type":"ui_group","name":"Power Flow","tab":"ea9b6de0.2693d","order":9,"disp":true,"width":"6","collapse":false},{"id":"da80b030.8ae43","type":"ui_group","name":"RWT (Heating)","tab":"5112450.59176bc","order":10,"disp":true,"width":"6","collapse":false},{"id":"3ba8e044.13894","type":"ui_group","name":"Power Flow","tab":"5112450.59176bc","order":6,"disp":true,"width":"6","collapse":false},{"id":"1bdc6df6.ccbdc2","type":"ui_group","name":"Flow (Heating)","tab":"5112450.59176bc","order":13,"disp":true,"width":"6","collapse":false},{"id":"7d6c26ba.b40a38","type":"ui_group","name":"Pressure (Heating)","tab":"5112450.59176bc","order":14,"disp":true,"width":"6","collapse":false},{"id":"89bc8dd.4ec5d7","type":"ui_group","d":true,"name":"RWT (Heating) - HIDE","tab":"5112450.59176bc","order":15,"disp":false,"width":"6","collapse":false},{"id":"b0d1c18a.9b586","type":"switch","z":"df9841f2.71dce","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"},{"t":"eq","v":"8","vt":"str"},{"t":"eq","v":"128","vt":"str"},{"t":"eq","v":"129","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":710,"y":940,"wires":[["31797d1e.b1fef2"],["31797d1e.b1fef2"],["31797d1e.b1fef2"],["31797d1e.b1fef2"],["31797d1e.b1fef2"],["31797d1e.b1fef2"],["f595f6f.16bb008"],["f595f6f.16bb008"]]},{"id":"f595f6f.16bb008","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":980,"wires":[["b7855da1.46905"]]},{"id":"31797d1e.b1fef2","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":940,"wires":[["b7855da1.46905"]]},{"id":"af027f22.95821","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"control_mode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":880,"wires":[[]]},{"id":"f97e76ce.10f948","type":"function","z":"df9841f2.71dce","name":"calc set point display","func":"var set_point = msg.payload/10000;\nvar select = global.get(\"control_mode\");\nvar display = 0;\n\n//Constant Speed / Curve\nif (select === 0){\n    var sensor_min = global.get(\"min_freq\")\n    display = parseFloat((set_point*100).toFixed(1));\n    if (display < sensor_min){\n        display = sensor_min\n    } \n    msg.payload = display+\" %\"\n}\n\n//Constant freq / curve\nif (select === 1){\n    var sensor_min = global.get(\"min_freq\")\n    display = parseFloat((set_point*100).toFixed(1));\n    if (display < sensor_min){\n        display = sensor_min\n    } \n    msg.payload = display+\" %\"\n}\n\n\n// Constant Head\nelse if (select == 3){\n    var min = global.get(\"min_head\")\n    var max = global.get(\"max_head\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max*sensor_max\n    var r_min = max*sensor_min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n\n    msg.payload = display+\" m\"\n    \n}\n\n// Constant Pressure\nelse if (select == 4){\n    var min = global.get(\"min_head\")\n    var max = global.get(\"max_head\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max*sensor_max\n    var r_min = max*sensor_min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n    \n    msg.payload = display+\" m\"\n    \n}\n\n// Const. Diff. Press.\nelse if (select == 5){\n    var min = global.get(\"min_head\")\n    var max = global.get(\"max_head\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max*sensor_max\n    var r_min = max*sensor_min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n\n    msg.payload = display+\" m\"\n}\n\n// Prop. Pres\nelse if (select == 6){\n    var min = global.get(\"min_head\")\n    var max = global.get(\"max_head\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max*sensor_max\n    var r_min = max*sensor_min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n\n    msg.payload = display+\" m\"\n    \n}\n\n// Constant Flow\nelse if (select == 7){\n    var min = global.get(\"min_flow\")\n    var max = global.get(\"max_flow\")\n    var unit = global.get(\"unit\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max*sensor_max\n    var r_min = max*sensor_min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n    if (unit == 6){\n    msg.payload = display+\" m<sup>3</sup>/h\"\n    }\n    else if (unit == 7){\n    msg.payload = display+\" m<sup>3</sup>/s\"    \n    }\n    else if (unit == 8){\n    msg.payload = display+\" L/s\"    \n    }\n    else if (unit == 9){\n    msg.payload = display+\" GPM\"    \n    }\n    else {\n    msg.payload = display\n    }\n}\n\n// Constant Temp\nelse if (select == 8){\n    var min = global.get(\"min_temp\")\n    var max = global.get(\"max_temp\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max\n    var r_min = min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n    msg.payload = display+\" &deg C\"\n    \n}\n\n// Constant Diff Temp\nelse if (select == 9){\n    var min = global.get(\"min_temp\")\n    var max = global.get(\"max_temp\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max\n    var r_min = min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n    msg.payload = display+\" &deg C\"\n    \n}\n\n// Constant Pressure\nelse if (select == 10){\n    var min = global.get(\"min_head\")\n    var max = global.get(\"max_head\")\n    var sensor_min = global.get(\"sensor_min\")\n    var sensor_max = global.get(\"sensor_max\")\n    \n    var r_max = max*sensor_max\n    var r_min = max*sensor_min\n    \n    tmp = set_point*(r_max-r_min)+r_min\n    display =  parseFloat((tmp).toFixed(1));\n    if (display < r_min){\n        display = r_min\n    }\n    \n    msg.payload = display+\" m\"\n    \n}\n\nelse {\n    msg.payload = 0\n}\n\nglobal.set(\"set_point\",display)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1660,"y":900,"wires":[["298955b4.ec951a"]]},{"id":"199aeea0.b3fdf1","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"BMS_ONOFF","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":400,"wires":[["9f0c7cb0.84e07"]]},{"id":"6b594b18.0fed14","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"START_STOP","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":440,"wires":[["9f0c7cb0.84e07"]]},{"id":"6f0c263c.306968","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"FLOWLIMIT","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":540,"wires":[["9f0c7cb0.84e07"]]},{"id":"a67db544.ab36f8","type":"inject","z":"df9841f2.71dce","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":290,"y":140,"wires":[["a874ad43.2740a","cdbbf9fc.f48368"]]},{"id":"f7d2da7d.4e8848","type":"function","z":"df9841f2.71dce","name":"rounding","func":"msg.payload = parseFloat((msg.payload / 100).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":620,"wires":[["26fbe614.33de4a"]]},{"id":"92dbdf87.5654c","type":"modbus-write","z":"a37ace7a.dab1a","d":true,"name":"FC6 108 Feedback Sensor","showStatusActivities":false,"showErrors":false,"unitid":"1","dataType":"HoldingRegister","adr":"108","quantity":"1","server":"276147dc.e6e7f8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1180,"y":1940,"wires":[[],[]]},{"id":"a3c26f8d.f2ef3","type":"ui_slider","z":"a37ace7a.dab1a","d":true,"name":"","label":"Occupancy ","tooltip":"","group":"3c1be052.4e291","order":10,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"100","step":1,"x":810,"y":1380,"wires":[["34da4e0c.52f2f2","a98c37a6.158f68"]]},{"id":"34da4e0c.52f2f2","type":"ui_text","z":"a37ace7a.dab1a","d":true,"group":"3c1be052.4e291","order":12,"width":"2","height":"1","name":"Load Setting Display","label":"","format":"{{msg.payload | uppercase}} %","layout":"row-left","x":1220,"y":1400,"wires":[]},{"id":"af10dc70.625c","type":"ui_switch","z":"a37ace7a.dab1a","d":true,"name":"Sim_ON_OFF","label":"Stop / Start","tooltip":"","group":"3c1be052.4e291","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"start","onvalueType":"str","onicon":"","oncolor":"","offvalue":"stop","offvalueType":"str","officon":"","offcolor":"","x":220,"y":2320,"wires":[["f62c7bb6.0d32e8","7c5741ba.da542","a15f55cf.36c818"]]},{"id":"64cbfb77.838544","type":"traffic","z":"a37ace7a.dab1a","name":"","property_allow":"payload","filter_allow":"start","ignore_case_allow":true,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"stop","ignore_case_stop":true,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":690,"y":1980,"wires":[["52956de4.3eee94","4377c8ec.347e28"]]},{"id":"52956de4.3eee94","type":"change","z":"a37ace7a.dab1a","d":true,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Sensor","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":1920,"wires":[["92dbdf87.5654c","9c25a3e7.93bd2"]]},{"id":"bdc9e117.710f9","type":"function","z":"a37ace7a.dab1a","name":"Coil Power ","func":"var status = global.get(\"coil_status\")/100\n\nvar p1 = 7.84e3\nvar p2 = 9.346e-15\nvar q1 = 2/3\nq = msg.payload*0.277778\nmsg.payload = (((p1*q+p2)/(q+q1))*2)*status;\nreturn msg;","outputs":1,"noerr":0,"x":1550,"y":1880,"wires":[[]]},{"id":"ad8b3486.0214a8","type":"function","z":"a37ace7a.dab1a","name":"Return Water Temp","func":"var p = msg.payload\nvar q = global.get(\"Flow\")*0.00028; //water Flow, assumed to be constant\nvar Tw_s = flow.get(\"Tw_s\") || 10;\nvar Ts = flow.get(\"Ts\") || 2;\nvar Tw_r = flow.get(\"Tw_r\") || 10;\nvar rho = 997\nvar V = 0.09  // m3, volume of water \nvar M = V*rho  // Mass of water volumne\nvar c = 4182  // water heat storage capacity\nvar C = M*c  // Thermal Capacity of Coil\n\nvar dot_T = (-q*rho*c*(Tw_r-Tw_s)+p)/C\n\nvar T = Tw_r+dot_T*Ts\n\nflow.set(\"Tw_r\",T)\nmsg.Tw_r = T\nmsg.payload = parseFloat(T).toFixed(2);\nmsg.topic = \"water\"\nmsg.dot_T = dot_T\nmsg.Tw_s = Tw_s\nmsg.Tw_r = Tw_r\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1170,"y":2120,"wires":[["94f08163.86c4c","8561cfdc.459dd","610594ea.13e0ec","f98f1030.d08a2","70653dd2.6f85a4","4af9f642.9314a8","18aa787f.d4fc38"]]},{"id":"2123be63.a1a432","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"delete","p":"Tw_r","pt":"flow"},{"t":"set","p":"Ta_s","pt":"flow","to":"Ta_s_setting","tot":"flow"},{"t":"delete","p":"T","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":1600,"wires":[[]]},{"id":"5a7039ae.5779e8","type":"function","z":"a37ace7a.dab1a","name":"Supply Air Temp","func":"var p = msg.payload\nvar q = 2.4; //Air Flow, assumed to be constant\n//var q = 2;\nvar O = flow.get('occupancy')\n//var q = 3-((O)/100)*1; \nflow.set('q_air',q)\nvar Ta_s = flow.get(\"Ta_s\")||28;\nvar Ts = flow.get(\"Ts\") || 2\nvar Ta_r = flow.get(\"Ta_r\")||28;\nvar rho = 1.225\nvar V = 80  // m3, volume of ahu \nvar M = V*rho  // Mass of air volumne\nvar c = 1000  // air heat storage capacity\nvar C = M*c  // Thermal Capacity of Coil\n\nvar dot_T = (q*rho*c*(Ta_r-Ta_s)-p)/C\n\nvar T = Ta_s+dot_T*Ts\n\nflow.set(\"Ta_s\",T)\nmsg.Ta_s = T\nmsg.payload = parseFloat(T).toFixed(2);\nmsg.topic = \"air\"\nmsg.dot_T = dot_T\nmsg.Ta_s = Ta_s\nmsg.Ta_r = Ta_r\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\nflow.set(\"Ta_s\",22)\nflow.set(\"Ta_r\",28)","finalize":"","libs":[],"x":1160,"y":2200,"wires":[["85f922b8.a2946","63b58268.3b133c","8cf17efe.8d20c","8a1431fd.0f321","cf44ccd.291df3","1b309e6c.3f25b2","4079e149.71d18","955015f9.d2b348","80eff8ac.0bdd58","42b53822.8a8928","48d69626.4b2028"]]},{"id":"a98c37a6.158f68","type":"function","z":"a37ace7a.dab1a","name":"load calc","func":"var setting = msg.payload;\nvar Ta_r = 28-((100-msg.payload)/100)*3;\nflow.set(\"Ta_r\",Ta_r)\n\nmsg.payload = parseFloat(Ta_r).toFixed(1);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1200,"y":1500,"wires":[["9689e23.c97292","6d254e9e.26208"]]},{"id":"8cf17efe.8d20c","type":"ui_text","z":"a37ace7a.dab1a","group":"23da77c.24a8d88","order":1,"width":"0","height":"0","name":"Supply Air Temp","label":"","format":"{{msg.payload}} &deg C","layout":"row-spread","x":1980,"y":2180,"wires":[]},{"id":"94f08163.86c4c","type":"ui_text","z":"a37ace7a.dab1a","group":"e932fe53.8056","order":1,"width":"0","height":"0","name":"Return Water Temp","label":"RWT","format":"{{msg.payload}} &deg C","layout":"row-spread","x":1990,"y":1840,"wires":[]},{"id":"9689e23.c97292","type":"ui_text","z":"a37ace7a.dab1a","d":true,"group":"3c1be052.4e291","order":9,"width":0,"height":0,"name":"","label":"Return Air ","format":"{{msg.payload}} &deg C","layout":"row-spread","x":1400,"y":1460,"wires":[]},{"id":"d085969a.6b0888","type":"ui_button","z":"a37ace7a.dab1a","name":"","group":"3c1be052.4e291","order":17,"width":0,"height":0,"passthru":false,"label":"Reset","tooltip":"","color":"","bgcolor":"","icon":"","payload":"stop","payloadType":"str","topic":"","x":290,"y":1820,"wires":[["2123be63.a1a432","52e70cbb.d302f4","f62c7bb6.0d32e8","ed96737f.e32"]]},{"id":"85f922b8.a2946","type":"function","z":"a37ace7a.dab1a","d":true,"name":"Sensor To Global","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\n\n//min = -10\n//max = 130\n\nvar sensor = ((msg.Ta_s-min)/(max-min))*10000\nsensor = parseFloat(sensor).toFixed(0);\nmsg.payload = sensor\nglobal.set(\"Sensor\",sensor)\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":2400,"wires":[["7fdfff4d.6aa03"]]},{"id":"6fc4d476.00d0bc","type":"inject","z":"a37ace7a.dab1a","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"stop","payloadType":"str","x":150,"y":1940,"wires":[["af10dc70.625c"]]},{"id":"4147e757.b38148","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"alarm_reset","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":320,"wires":[["72780349.32da2c","9f0c7cb0.84e07"]]},{"id":"15b6a60.af40e5a","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"Copy_Local","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":260,"wires":[["9f0c7cb0.84e07"]]},{"id":"d771ab2f.029aa8","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"Copy_Local","pt":"global","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":220,"wires":[["9f0c7cb0.84e07"]]},{"id":"72780349.32da2c","type":"delay","z":"df9841f2.71dce","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":830,"y":280,"wires":[["b565ea21.22bbc8"]]},{"id":"b565ea21.22bbc8","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"alarm_reset","pt":"global","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":280,"wires":[["9f0c7cb0.84e07"]]},{"id":"9f0c7cb0.84e07","type":"function","z":"df9841f2.71dce","name":"","func":"var binary = [0, 0, 0, 0,0, 0, 0, 0,0, 0, 0, 0,0, 0, 0, 0]\n\nbinary[0] = global.get(\"BMS_ONOFF\")\nbinary[1] = global.get(\"START_STOP\");\nbinary[2] = global.get(\"alarm_reset\")\nbinary[4] = global.get(\"Copy_Local\")\n\nbinary[5] = global.get(\"FLOWLIMIT\");\n\nvar index = 0\nvar sum = 0\n\nfor (var i in binary){\n    if (index===0){\n        sum = binary[0]\n    }\n    else{\n    sum = sum+Math.pow(2*binary[index],index);\n    }\n    index = index+1\n}\nmsg.payload = sum\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":380,"wires":[["d360a4f.b1dd858","1795c9d7.1118c6"]]},{"id":"d360a4f.b1dd858","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1450,"y":360,"wires":[]},{"id":"425792d.3a6816c","type":"switch","z":"df9841f2.71dce","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":360,"wires":[["d771ab2f.029aa8"]]},{"id":"a874ad43.2740a","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"Copy_Local","pt":"global","to":"0","tot":"num"},{"t":"set","p":"alarm_reset","pt":"global","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":140,"wires":[[]]},{"id":"f9c910ab.375c7","type":"comment","z":"df9841f2.71dce","name":"Temp Sim Flow","info":"","x":400,"y":700,"wires":[]},{"id":"c097fd22.94385","type":"link in","z":"a37ace7a.dab1a","name":"","links":["65abf0d5.8ff66"],"x":395,"y":2120,"wires":[["64cbfb77.838544"]]},{"id":"d170b1d0.8b10d","type":"ui_slider","z":"a37ace7a.dab1a","d":true,"name":"","label":"Coil Efficiency ","tooltip":"","group":"3c1be052.4e291","order":13,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"100","step":1,"x":820,"y":1300,"wires":[["c9c7498d.e9c9a8","106d9a10.797256"]]},{"id":"de6e379f.347918","type":"inject","z":"a37ace7a.dab1a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"100","payloadType":"num","x":190,"y":1460,"wires":[["a3c26f8d.f2ef3","d170b1d0.8b10d","be6e32e9.099b","da3abf38.b0f2"]]},{"id":"c9c7498d.e9c9a8","type":"ui_text","z":"a37ace7a.dab1a","d":true,"group":"3c1be052.4e291","order":14,"width":"2","height":"1","name":"Coil Status display","label":"","format":"{{msg.payload | uppercase}} %","layout":"row-left","x":1230,"y":1300,"wires":[]},{"id":"106d9a10.797256","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"coil_status","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1190,"y":1220,"wires":[[]]},{"id":"7fdfff4d.6aa03","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1460,"y":2400,"wires":[]},{"id":"9c25a3e7.93bd2","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1250,"y":1880,"wires":[]},{"id":"e0b0f406.b501e8","type":"comment","z":"df9841f2.71dce","name":"MAGNA3 Write Section","info":"","x":280,"y":40,"wires":[]},{"id":"9bd77bce.e84d38","type":"ui_template","z":"df9841f2.71dce","group":"806379db.c33df8","name":"Header Logo (and clock)","order":8,"width":0,"height":0,"format":"<script id=\"clockScript1\" type=\"text/javascript\">\n    var clockInterval;\n    $(function () {\n        if (clockInterval) return;\n\n        //add logo\n        var div1 = $('<div/>');\n        var logo = new Image();\n\n        logo.src = '/logo_old.png'\n        logo.height = 45;\n        div1[0].style.margin = '5px';\n\n        div1.append(logo);\n\n        //add clock\n        var div2 = $('<div/>');\n        var p = $('<p/>');\n\n        div2.append(p);\n        div2[0].style.margin = '10px auto';\n        \n        var div3 = $('<div/>');\n        div3[0].style.margin = '10px auto';\n        function displayTime() {\n            p.text(new Date().toLocaleString());\n        }\n        \n        clockInterval = setInterval(displayTime, 1000);\n\n        //add to toolbar when it's available\n        var addToToolbarTimer;\n        \n        function addToToolbar() {\n            var toolbar = $('.md-toolbar-tools');\n            \n            if(!toolbar.length) return;\n            \n            toolbar.append(div3);\n            toolbar.append(div1);\n            clearInterval(addToToolbarTimer);\n        }\n        addToToolbarTimer = setInterval(addToToolbar, 100);\n    });\n</script>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"global","x":750,"y":60,"wires":[[]]},{"id":"dbc94141.821cf","type":"ui_chart","z":"41ddd688.39b148","name":"Flow Chart","group":"1eed226c.4ab33e","order":3,"width":0,"height":0,"label":"Pump Flow","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"20","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#9d0027","#a3465d","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1210,"y":200,"wires":[[]]},{"id":"6b22be57.0e27","type":"ui_chart","z":"41ddd688.39b148","name":"Head Chart","group":"1eed226c.4ab33e","order":4,"width":0,"height":0,"label":"Pump Head","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"12","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#f49500","#f49500","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1210,"y":320,"wires":[[]]},{"id":"107bf942.104077","type":"ui_gauge","z":"41ddd688.39b148","name":"RPM","group":"248473c9.d2f6bc","order":5,"width":"3","height":"3","gtype":"gage","title":"","label":"RPM","format":"{{msg.payload.data[0] | uppercase}}","min":"1300","max":"4000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1190,"y":140,"wires":[]},{"id":"235c90b0.e8778","type":"ui_text","z":"41ddd688.39b148","group":"1eed226c.4ab33e","order":1,"width":"3","height":"1","name":"Flow Meter","label":"Flow M:","format":"{{msg.payload}} m<sup>3</sup>/h","layout":"row-spread","x":1190,"y":20,"wires":[]},{"id":"5efd8cdc.56fbd4","type":"ui_text","z":"41ddd688.39b148","group":"1eed226c.4ab33e","order":2,"width":"3","height":"1","name":"Flow Pump","label":"Flow P:","format":"{{msg.payload}} m<sup>3</sup>/h","layout":"row-spread","x":1190,"y":80,"wires":[]},{"id":"2b516eae.b54692","type":"ui_gauge","z":"41ddd688.39b148","name":"kW Gauge","group":"248473c9.d2f6bc","order":6,"width":"3","height":"3","gtype":"gage","title":"","label":"W","format":"{{msg.payload.data[0] | uppercase}}","min":"0","max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1210,"y":440,"wires":[]},{"id":"cfe92f74.bc068","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":7,"width":0,"height":0,"name":"","label":"Actual SetPoint","format":"{{msg.payload}}","layout":"row-spread","x":2040,"y":560,"wires":[]},{"id":"f6230025.40442","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":6,"width":0,"height":0,"name":"","label":"Actual FlowLimit","format":"{{msg.payload}}","layout":"row-spread","x":2040,"y":620,"wires":[]},{"id":"fc72b58b.749948","type":"ui_text","z":"41ddd688.39b148","group":"39f5b403.20849c","order":0,"width":0,"height":0,"name":"","label":"Opperation Hours","format":"{{msg.payload.data[0]}}","layout":"row-spread","x":1230,"y":760,"wires":[]},{"id":"f6a5bdf9.f174c","type":"ui_text","z":"41ddd688.39b148","group":"39f5b403.20849c","order":0,"width":0,"height":0,"name":"","label":"Powered Hours","format":"{{msg.payload.data[0]}}","layout":"row-spread","x":1220,"y":820,"wires":[]},{"id":"70d4b8f4.9696e8","type":"ui_text","z":"41ddd688.39b148","group":"39f5b403.20849c","order":0,"width":0,"height":0,"name":"","label":"# Start/Stop","format":"{{msg.payload.data[0]}}","layout":"row-spread","x":1210,"y":880,"wires":[]},{"id":"7ac9e3f9.f681bc","type":"ui_text","z":"41ddd688.39b148","group":"39f5b403.20849c","order":0,"width":0,"height":0,"name":"","label":"# kWh","format":"{{msg.payload.data[0]}}","layout":"row-spread","x":1190,"y":940,"wires":[]},{"id":"9609f538.934c48","type":"ui_gauge","z":"41ddd688.39b148","name":"liquid temp","group":"248473c9.d2f6bc","order":7,"width":"3","height":"3","gtype":"gage","title":"","label":"Liquid Temp","format":"{{msg.payload | uppercase}}","min":"-10","max":"130","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1210,"y":500,"wires":[]},{"id":"1ad6b1ed.12cc1e","type":"ui_gauge","z":"41ddd688.39b148","name":"external sensor","group":"248473c9.d2f6bc","order":8,"width":"3","height":"3","gtype":"gage","title":"","label":"{{msg.unit}}","format":"{{msg.payload | uppercase}}","min":"0","max":"60","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1220,"y":560,"wires":[]},{"id":"4c47c181.e53eb","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":2,"width":0,"height":0,"name":"","label":"Remote Control:","format":"{{msg.payload}}","layout":"row-spread","x":2040,"y":360,"wires":[]},{"id":"2bb8bcfb.2816d4","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":3,"width":0,"height":0,"name":"","label":"Start / Stop:","format":"{{msg.payload}}","layout":"row-spread","x":2030,"y":320,"wires":[]},{"id":"5252de6c.08cee","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":5,"width":0,"height":0,"name":"","label":"FlowLIMIT:","format":"{{msg.payload}}","layout":"row-spread","x":2030,"y":440,"wires":[]},{"id":"25abaeb9.5e35e2","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":10,"width":0,"height":0,"name":"","label":"Faults:","format":"{{msg.payload}}","layout":"row-spread","x":2010,"y":280,"wires":[]},{"id":"db2dd759.ce0b18","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":11,"width":0,"height":0,"name":"","label":"Warnings:","format":"{{msg.payload}}","layout":"row-spread","x":2020,"y":240,"wires":[]},{"id":"6f635f1.d9708a","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":12,"width":0,"height":0,"name":"","label":"Forced Local:","format":"{{msg.payload}}","layout":"row-spread","x":2040,"y":180,"wires":[]},{"id":"8bccf4ac.a324d8","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":1,"width":0,"height":0,"name":"","label":"Control Mode","format":"{{msg.payload}}","layout":"row-spread","x":2040,"y":500,"wires":[]},{"id":"9f036a24.d4d818","type":"ui_toast","z":"41ddd688.39b148","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Min Max Notification","x":2060,"y":120,"wires":[]},{"id":"4f591eb7.ddbbd","type":"link in","z":"41ddd688.39b148","name":"","links":["304fb527.50d4ea"],"x":1695,"y":120,"wires":[["9f036a24.d4d818"]]},{"id":"10bf3a3.a2d21c6","type":"link in","z":"41ddd688.39b148","name":"","links":["119844b7.624f1b"],"x":1695,"y":180,"wires":[["6f635f1.d9708a"]]},{"id":"47269e13.a181b","type":"link in","z":"41ddd688.39b148","name":"","links":["c8d457d2.3e98f8"],"x":1695,"y":240,"wires":[["db2dd759.ce0b18"]]},{"id":"88920b9d.f5f848","type":"link in","z":"41ddd688.39b148","name":"","links":["ddfa0c09.8eede"],"x":1695,"y":280,"wires":[["25abaeb9.5e35e2"]]},{"id":"36f8fff3.6122","type":"link in","z":"41ddd688.39b148","name":"","links":["a5a80b61.670c28"],"x":1695,"y":320,"wires":[["2bb8bcfb.2816d4"]]},{"id":"5ce169c5.baa3b8","type":"link in","z":"41ddd688.39b148","name":"","links":["892449e3.63c0c8"],"x":1695,"y":360,"wires":[["4c47c181.e53eb"]]},{"id":"67150a1a.b23d54","type":"link in","z":"41ddd688.39b148","name":"","links":["79600cac.5f5084"],"x":1695,"y":440,"wires":[["5252de6c.08cee"]]},{"id":"c88c3be7.27ff78","type":"link in","z":"41ddd688.39b148","name":"","links":["4d4d0b7a.c51f04"],"x":1695,"y":500,"wires":[["8bccf4ac.a324d8"]]},{"id":"29cdcd0d.7f8842","type":"link in","z":"41ddd688.39b148","name":"","links":["a058e9d5.7e1cb8"],"x":1695,"y":560,"wires":[["cfe92f74.bc068"]]},{"id":"66a44110.64ea5","type":"link in","z":"41ddd688.39b148","name":"","links":["938c064a.8b0d78"],"x":1695,"y":620,"wires":[["f6230025.40442"]]},{"id":"900df489.4b0a18","type":"link in","z":"41ddd688.39b148","name":"","links":["47ec14e9.29d95c"],"x":1055,"y":760,"wires":[["fc72b58b.749948"]]},{"id":"9198768d.6261f8","type":"link in","z":"41ddd688.39b148","name":"","links":["2d87c67d.39c38a"],"x":1055,"y":820,"wires":[["f6a5bdf9.f174c"]]},{"id":"d41a47ab.4b7038","type":"link in","z":"41ddd688.39b148","name":"","links":["cb5863e.742cda"],"x":1055,"y":880,"wires":[["70d4b8f4.9696e8"]]},{"id":"962497a7.b6e448","type":"link in","z":"41ddd688.39b148","name":"","links":["1dc6027a.cadf3e"],"x":1055,"y":940,"wires":[["7ac9e3f9.f681bc"]]},{"id":"ede32f5f.cdd9a","type":"link in","z":"41ddd688.39b148","name":"","links":["22ff831a.97c09c"],"x":1075,"y":140,"wires":[["107bf942.104077"]]},{"id":"195cf2c6.1d92cd","type":"link in","z":"41ddd688.39b148","name":"","links":["53473916.7aade8"],"x":915,"y":220,"wires":[["dbc94141.821cf","5efd8cdc.56fbd4"]]},{"id":"9e68a0d6.0fa58","type":"link in","z":"41ddd688.39b148","name":"","links":["5c0c0e5c.0d0d2"],"x":1075,"y":320,"wires":[["6b22be57.0e27"]]},{"id":"8446de07.61587","type":"link in","z":"41ddd688.39b148","name":"","links":["16dbf834.0ab598"],"x":1075,"y":440,"wires":[["2b516eae.b54692"]]},{"id":"fa2f59c0.0824e8","type":"link in","z":"41ddd688.39b148","name":"","links":["d9e15191.4bd98"],"x":1075,"y":500,"wires":[["9609f538.934c48"]]},{"id":"d579c556.4b8168","type":"link in","z":"41ddd688.39b148","name":"","links":["7aee277e.173f38"],"x":1075,"y":560,"wires":[["1ad6b1ed.12cc1e"]]},{"id":"26fbe614.33de4a","type":"link out","z":"df9841f2.71dce","name":"Flow Limit Display","links":["a01a0757.c3ccc8"],"x":1610,"y":720,"wires":[],"l":true},{"id":"298955b4.ec951a","type":"link out","z":"df9841f2.71dce","name":"SetPoint Display","links":["a1311b97.071218"],"x":1680,"y":840,"wires":[],"l":true},{"id":"c1d4f99d.8ac618","type":"ui_text","z":"41ddd688.39b148","d":true,"group":"ab3a9e02.8ace9","order":6,"width":"2","height":"1","name":"Flow Limit Display","label":"","format":"{{msg.payload | uppercase}} m<sup>3</sup>/h","layout":"row-left","x":610,"y":1420,"wires":[]},{"id":"ca7f0844.7b21d8","type":"ui_text","z":"41ddd688.39b148","group":"ab3a9e02.8ace9","order":9,"width":"2","height":"1","name":"Set Point Display","label":"","format":"{{msg.payload}}","layout":"row-left","x":670,"y":1620,"wires":[]},{"id":"a01a0757.c3ccc8","type":"link in","z":"41ddd688.39b148","name":"","links":["26fbe614.33de4a"],"x":355,"y":1420,"wires":[["c1d4f99d.8ac618"]]},{"id":"a1311b97.071218","type":"link in","z":"41ddd688.39b148","name":"","links":["298955b4.ec951a"],"x":355,"y":1620,"wires":[["ca7f0844.7b21d8"]]},{"id":"7c73b2fb.34e94c","type":"link in","z":"df9841f2.71dce","name":"Copy To local","links":["885559c7.fcb7e8"],"x":310,"y":220,"wires":[["15b6a60.af40e5a"]],"l":true},{"id":"dbcf0a0d.3fcca8","type":"link in","z":"df9841f2.71dce","name":"Reset Alarms","links":["79d74066.20f5"],"x":310,"y":300,"wires":[["4147e757.b38148"]],"l":true},{"id":"c188eecc.a682b","type":"link in","z":"df9841f2.71dce","name":"BMS ON/OFF","links":["a3db36a5.0ed478"],"x":290,"y":360,"wires":[["425792d.3a6816c","199aeea0.b3fdf1"]],"l":true},{"id":"454708be.bc7bc8","type":"link in","z":"df9841f2.71dce","name":"GO / STOP","links":["43daf734.69feb8"],"x":310,"y":420,"wires":[["dcff7055.59f24"]],"l":true},{"id":"cfcba096.383d8","type":"link in","z":"df9841f2.71dce","name":"Enable FlowLimit","links":["3449b5a9.5bbe9a"],"x":300,"y":540,"wires":[["6f0c263c.306968"]],"l":true},{"id":"63986bd2.c574a4","type":"link in","z":"df9841f2.71dce","name":"Set FlowLimit","links":["95e70fe.90b4cf"],"x":310,"y":580,"wires":[["f7d2da7d.4e8848","9819a4fa.874458"]],"l":true},{"id":"4620f51.5ec230c","type":"link in","z":"df9841f2.71dce","name":"Set Control Mode","links":["579c158d.79d34c"],"x":300,"y":840,"wires":[["b0d1c18a.9b586","af027f22.95821","1d1648ef.fbbd77"]],"l":true},{"id":"b7855da1.46905","type":"link out","z":"df9841f2.71dce","name":"Default Set Point","links":["6ba60776.f91fe8"],"x":1215,"y":980,"wires":[]},{"id":"5c5cf3e0.1b94ec","type":"link in","z":"df9841f2.71dce","name":"OUTPUT set Setpoint","links":["5d64db1a.33c914","1a433392.73ce4c","3148fbdc.71ff34","83548cfa.a35f2","492954fa.13c0bc"],"x":1420,"y":940,"wires":[["f97e76ce.10f948","815fc409.1f7568"]],"l":true},{"id":"8df0d6cc.c429b8","type":"ui_slider","z":"41ddd688.39b148","d":true,"name":"","label":"Set Point","tooltip":"","group":"ab3a9e02.8ace9","order":7,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"10000","step":"1","x":520,"y":1540,"wires":[["5d64db1a.33c914"]]},{"id":"5d64db1a.33c914","type":"link out","z":"41ddd688.39b148","name":"Set SetPoint","links":["5c5cf3e0.1b94ec"],"x":730,"y":1540,"wires":[],"l":true},{"id":"6ba60776.f91fe8","type":"link in","z":"41ddd688.39b148","name":"Default SetPoint","links":["b7855da1.46905"],"x":135,"y":1540,"wires":[["8df0d6cc.c429b8"]]},{"id":"44f636e5.24eda8","type":"ui_switch","z":"41ddd688.39b148","d":true,"name":"","label":"Start Stop","tooltip":"","group":"806379db.c33df8","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":440,"y":320,"wires":[["43daf734.69feb8"]]},{"id":"b79db931.e3a078","type":"ui_switch","z":"41ddd688.39b148","name":"","label":"Enable Flow Limit","tooltip":"","group":"ab3a9e02.8ace9","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":1120,"wires":[["3449b5a9.5bbe9a"]]},{"id":"8e00fcfb.48146","type":"ui_switch","z":"41ddd688.39b148","d":true,"name":"BMS_ONOFF","label":"BMS Control","tooltip":"","group":"806379db.c33df8","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":460,"y":260,"wires":[["a3db36a5.0ed478"]]},{"id":"7ff01a8d.5a9734","type":"ui_slider","z":"41ddd688.39b148","d":true,"name":"","label":"Flow Limit","tooltip":"","group":"ab3a9e02.8ace9","order":5,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":"0","max":"1600","step":"1","x":400,"y":1360,"wires":[["95e70fe.90b4cf"]]},{"id":"a8d8b0b2.a7839","type":"ui_button","z":"41ddd688.39b148","name":"","group":"806379db.c33df8","order":9,"width":0,"height":0,"passthru":false,"label":"Reset Alarms","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"","x":460,"y":100,"wires":[["79d74066.20f5"]]},{"id":"c34f5a29.0be7f8","type":"ui_button","z":"41ddd688.39b148","name":"","group":"806379db.c33df8","order":10,"width":0,"height":0,"passthru":false,"label":"Copy to Local","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"","x":460,"y":40,"wires":[["885559c7.fcb7e8"]]},{"id":"885559c7.fcb7e8","type":"link out","z":"41ddd688.39b148","name":"Copy To local","links":["7c73b2fb.34e94c"],"x":655,"y":40,"wires":[]},{"id":"79d74066.20f5","type":"link out","z":"41ddd688.39b148","name":"Reset Alarms","links":["dbcf0a0d.3fcca8"],"x":665,"y":80,"wires":[]},{"id":"a3db36a5.0ed478","type":"link out","z":"41ddd688.39b148","name":"BMS ON/OFF","links":["c188eecc.a682b"],"x":655,"y":240,"wires":[]},{"id":"43daf734.69feb8","type":"link out","z":"41ddd688.39b148","name":"GO/STOP","links":["454708be.bc7bc8"],"x":655,"y":300,"wires":[]},{"id":"3449b5a9.5bbe9a","type":"link out","z":"41ddd688.39b148","name":"Enable FlowLimit","links":["cfcba096.383d8"],"x":735,"y":1100,"wires":[]},{"id":"95e70fe.90b4cf","type":"link out","z":"41ddd688.39b148","name":"Set FlowLimit","links":["63986bd2.c574a4"],"x":675,"y":1360,"wires":[]},{"id":"8c4f6f63.251a","type":"link in","z":"41ddd688.39b148","name":"Sim Temp Flow","links":[],"x":100,"y":1000,"wires":[["8e00fcfb.48146","44f636e5.24eda8","f5b200e1.5109a","a3db36a5.0ed478","43daf734.69feb8","fdab57f7.03a318","9758040f.cb7458"]],"l":true},{"id":"f5b200e1.5109a","type":"change","z":"41ddd688.39b148","name":"Control Mode","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1200,"wires":[["6446ea3c.132c04"]]},{"id":"6446ea3c.132c04","type":"ui_dropdown","z":"41ddd688.39b148","name":"","label":"Control Mode","tooltip":"","place":"Select option","group":"ab3a9e02.8ace9","order":1,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"Constant Curve","value":1,"type":"num"},{"label":"Constant Head","value":"3","type":"str"},{"label":"Constant Presssure","value":4,"type":"num"},{"label":"Constant Differential Pressure","value":"5","type":"str"},{"label":"Proportional Pressure","value":"6","type":"str"},{"label":"Constant Temperature","value":"8","type":"str"},{"label":"Differential Temperature","value":"9","type":"str"},{"label":"AUTOAdapt","value":"128","type":"str"},{"label":"FLOWAdapt","value":"129","type":"str"}],"payload":"","topic":"","x":640,"y":1200,"wires":[["579c158d.79d34c"]]},{"id":"579c158d.79d34c","type":"link out","z":"41ddd688.39b148","name":"Control Mode","links":["4620f51.5ec230c"],"x":795,"y":1200,"wires":[]},{"id":"cdbbf9fc.f48368","type":"link out","z":"df9841f2.71dce","name":"initial Reset","links":["bb35e242.69504"],"x":495,"y":180,"wires":[]},{"id":"bb35e242.69504","type":"link in","z":"41ddd688.39b148","name":"Initial Reset","links":["cdbbf9fc.f48368"],"x":110,"y":240,"wires":[["8e00fcfb.48146","44f636e5.24eda8","b79db931.e3a078","cd1b806a.652c2","a3db36a5.0ed478","43daf734.69feb8","8be589ce.1ca4b8","6bd3ac8b.80aef4","9bb3cfbe.85fb6","9173f7f6.e3f388"]],"l":true},{"id":"8ef835f1.5d3208","type":"ui_chart","z":"a37ace7a.dab1a","name":"Flow Chart","group":"961a2f02.8716d","order":2,"width":"0","height":"0","label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"20","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#9d0027","#a3465d","#ff7f0e","#2ca02c","#98df8a","#9d0027","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1330,"y":780,"wires":[[]]},{"id":"39a74019.9b739","type":"ui_text","z":"a37ace7a.dab1a","group":"961a2f02.8716d","order":1,"width":"0","height":"0","name":"Flow Value","label":"Flow","format":"{{msg.payload}} m<sup>3</sup>/h","layout":"row-spread","x":1330,"y":820,"wires":[]},{"id":"8e804c74.30442","type":"ui_chart","z":"a37ace7a.dab1a","name":"Pressure Chart","group":"569c7584.71325c","order":2,"width":"0","height":"0","label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"12","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#facb7a","#f49500","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1340,"y":880,"wires":[[]]},{"id":"5b3687d8.c86978","type":"ui_text","z":"a37ace7a.dab1a","group":"569c7584.71325c","order":1,"width":"6","height":"1","name":"Head Value","label":"Pressure ","format":"{{msg.payload}} m","layout":"row-spread","x":1330,"y":920,"wires":[]},{"id":"c7a71a24.5bcf68","type":"ui_gauge","z":"a37ace7a.dab1a","name":"kW Gauge","group":"a09ba203.8376","order":1,"width":"3","height":"3","gtype":"gage","title":"","label":"W","format":"{{msg.payload.data[0] | uppercase}}","min":"0","max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1330,"y":660,"wires":[]},{"id":"fcf9bac0.d3d8c8","type":"ui_gauge","z":"a37ace7a.dab1a","name":"RPM","group":"a09ba203.8376","order":2,"width":"3","height":"3","gtype":"gage","title":"","label":"RPM","format":"{{msg.payload.data[0] | uppercase}}","min":"1300","max":"4000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1310,"y":700,"wires":[]},{"id":"bc8d850f.e9e368","type":"comment","z":"a37ace7a.dab1a","name":"Simulation page","info":"","x":1340,"y":620,"wires":[]},{"id":"299408d4.969a08","type":"link in","z":"a37ace7a.dab1a","name":"","links":["fd18d18e.75773","22ff831a.97c09c","6e89ac88.ae7414"],"x":415,"y":740,"wires":[["fcf9bac0.d3d8c8"]]},{"id":"501c3f8a.bbd56","type":"link in","z":"a37ace7a.dab1a","name":"","links":["65abf0d5.8ff66"],"x":415,"y":820,"wires":[["8ef835f1.5d3208","39a74019.9b739"]]},{"id":"905601d4.2bbeb","type":"link in","z":"a37ace7a.dab1a","name":"","links":["aef19316.51085","5c0c0e5c.0d0d2","d3f2e4b2.919ad8"],"x":415,"y":920,"wires":[["5b3687d8.c86978","b4a0978c.fa50f8"]]},{"id":"a5d13acb.90f7e8","type":"link in","z":"a37ace7a.dab1a","name":"","links":["16dbf834.0ab598"],"x":415,"y":700,"wires":[["c7a71a24.5bcf68"]]},{"id":"492954fa.13c0bc","type":"link out","z":"a37ace7a.dab1a","name":"Set SetPoint","links":["5c5cf3e0.1b94ec"],"x":1735,"y":2720,"wires":[]},{"id":"c4b47450.d42398","type":"function","z":"df9841f2.71dce","name":"Sensor range","func":"var unit = msg.payload.data[0]\nvar min = msg.payload.data[1]\nvar max = msg.payload.data[2]\nif (unit == 13){\n    \nmin_c = min-273;\nmax_c = max-273;\n\nglobal.set(\"min_temp\",min_c)\nglobal.set(\"max_temp\",max_c)\n\nmsg.min = min_c\nmsg.max = max_c\n}\n\nif (unit == 12){\n    \nmin_c = min;\nmax_c = max;\n\nglobal.set(\"min_temp\",min_c)\nglobal.set(\"max_temp\",max_c)\n\nmsg.min = min_c\nmsg.max = max_c\n}\n\n\n\nif (unit == 2){\n    global.set(\"min_head\",min)\n    global.set(\"max_head\",max)\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":1820,"wires":[["ec8a31c1.6b68f"]]},{"id":"ab3a644d.a2c9c8","type":"function","z":"df9841f2.71dce","name":"Sensor MinMax","func":"var sensor_min = msg.payload.data[0];\nvar sensor_max = msg.payload.data[1]/10000;\n\nif (sensor_min === 0){\n    sensor_min = sensor_min;\n}\nelse {\n    sensor_min = sensor_min/10000;\n}\n\nglobal.set(\"sensor_min\",sensor_min)\nglobal.set(\"sensor_max\",sensor_max)\n\nmsg.sensor_min = sensor_min\nmsg.sensor_max = sensor_max\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1020,"y":1900,"wires":[["e60c306d.34b49"]]},{"id":"d9f8f96d.13c438","type":"function","z":"df9841f2.71dce","name":"rounding","func":"msg.payload = parseFloat((msg.payload.data / 10).toFixed(1));\nmsg.topic = \"MAGNA3\"\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":2660,"wires":[["94ff6dab.0d896","3c0b09b4.2e3036","53473916.7aade8"]]},{"id":"4d453a7f.c1f6d4","type":"function","z":"df9841f2.71dce","name":"rounding","func":"msg.payload = parseFloat((msg.payload.data / 100).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":2780,"wires":[["463e4a8f.88b224","5c0c0e5c.0d0d2"]]},{"id":"1829b91a.1036c7","type":"function","z":"df9841f2.71dce","name":"16 bit status conversion","func":"const buf = Buffer.from(msg.payload.buffer);\n\nvar tmp = parseInt(msg.payload.data).toString(2)\nvar lg = tmp.length\nmsg.lg = lg\n\nif (lg ==8){\n    tmp = \"00000000\"+tmp\n}\n\nif (lg ==9){\n    tmp = \"0000000\"+tmp\n}\n\nif (lg ==10){\n    tmp = \"000000\"+tmp\n} \n\nif (lg ==12){\n    tmp = \"0000\"+tmp\n} \nelse {\n    tmp=tmp\n}\nmsg.payload = tmp\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":2040,"wires":[["c7960526.2dc3d8"]]},{"id":"c7960526.2dc3d8","type":"split","z":"df9841f2.71dce","name":"","splt":"1","spltType":"len","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1350,"y":2080,"wires":[["6ae5e33f.0cb72c"]]},{"id":"6ae5e33f.0cb72c","type":"switch","z":"df9841f2.71dce","name":"16 bit states","property":"parts.index","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"},{"t":"eq","v":"6","vt":"num"},{"t":"eq","v":"7","vt":"num"},{"t":"eq","v":"8","vt":"num"},{"t":"eq","v":"9","vt":"num"},{"t":"eq","v":"10","vt":"num"},{"t":"eq","v":"11","vt":"num"},{"t":"eq","v":"12","vt":"num"},{"t":"eq","v":"13","vt":"num"},{"t":"eq","v":"14","vt":"num"},{"t":"eq","v":"15","vt":"num"}],"checkall":"true","repair":false,"outputs":16,"x":1530,"y":2000,"wires":[["c6b2fc6b.b2ea7"],[],["a8861ea.fa160e"],["55db9369.c7e85c"],["9e186853.0a7f68"],["e297eb62.5ad4e8"],["3c2e965.7d5cb6a"],["504b9daa.260254"],[],[],[],[],[],["e1c9a3ca.a724b"],[],[]]},{"id":"61b48c66.e8f584","type":"function","z":"df9841f2.71dce","name":"rounding","func":"msg.payload = parseFloat((msg.payload.data / 100).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":3080,"wires":[["a058e9d5.7e1cb8"]]},{"id":"65395add.6b2704","type":"function","z":"df9841f2.71dce","name":"rounding","func":"msg.payload = parseFloat((msg.payload.data / 100).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":3200,"wires":[["938c064a.8b0d78"]]},{"id":"e1c9a3ca.a724b","type":"function","z":"df9841f2.71dce","name":"","func":"if (msg.payload == 1){\n    msg.payload = \"Yes\"\n}\nelse {\n    msg.payload = \"No\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":2080,"wires":[["79600cac.5f5084"]]},{"id":"504b9daa.260254","type":"function","z":"df9841f2.71dce","name":"","func":"if (msg.payload == 1){\n    msg.payload = \"Yes\"\n}\nelse {\n    msg.payload = \"No\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":2000,"wires":[["892449e3.63c0c8"]]},{"id":"3c2e965.7d5cb6a","type":"function","z":"df9841f2.71dce","name":"","func":"if (msg.payload == 1){\n    msg.payload = \"Running\"\n}\nelse {\n    msg.payload = \"Stopped\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":1960,"wires":[["a5a80b61.670c28"]]},{"id":"e297eb62.5ad4e8","type":"function","z":"df9841f2.71dce","name":"","func":"if (msg.payload == 1){\n    msg.payload = \"Yes\"\n}\nelse {\n    msg.payload = \"No\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":1920,"wires":[["ddfa0c09.8eede"]]},{"id":"55db9369.c7e85c","type":"function","z":"df9841f2.71dce","name":"","func":"if (msg.payload == 1){\n    msg.payload = \"Yes\"\n}\nelse {\n    msg.payload = \"No\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":1780,"wires":[["119844b7.624f1b"]]},{"id":"9e186853.0a7f68","type":"function","z":"df9841f2.71dce","name":"","func":"if (msg.payload == 1){\n    msg.payload = \"Yes\"\n}\nelse {\n    msg.payload = \"No\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":1880,"wires":[["c8d457d2.3e98f8"]]},{"id":"843806a0.72f8b8","type":"function","z":"df9841f2.71dce","name":"Control mode lookup","func":"if (msg.payload.data[0] === 0){\n    msg.payload = \"Constant Curve\"\n}\nelse if (msg.payload.data[0] == 1){\n    msg.payload = \"Constant Curve\"\n}\n\nelse if (msg.payload.data[0] == 3){\n    msg.payload = \"Constant Head\"\n}\n\nelse if (msg.payload.data[0] == 4){\n    msg.payload = \"Constant Pressure\"\n}\nelse if (msg.payload.data[0] == 5){\n    msg.payload = \"Constant Diff. Pressure\"\n}\nelse if (msg.payload.data[0] == 6){\n    msg.payload = \"Prop. Pressure\"\n}\n\nelse if (msg.payload.data[0] == 7){\n    msg.payload = \"Constant Flow\"\n}\nelse if (msg.payload.data[0] == 8){\n    msg.payload = \"Constant Temperature\"\n}\n\nelse if (msg.payload.data[0] == 9){\n    msg.payload = \"Constant Diff. Temperature\"\n}\n\nelse if (msg.payload.data[0] == 128){\n    msg.payload = \"AutoADAPT\"\n}\n\nelse if (msg.payload.data[0] == 129){\n    msg.payload = \"FlowADAPT\"\n}\n\nelse {\n    msg.payload = \"Undefined\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1020,"y":2140,"wires":[["4d4d0b7a.c51f04"]]},{"id":"c5960fbf.a7427","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)-273).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":3600,"wires":[["d9e15191.4bd98","ec6d0e16.f7c74"]]},{"id":"94ff6dab.0d896","type":"change","z":"df9841f2.71dce","d":true,"name":"Global Flow","rules":[{"t":"move","p":"payload","pt":"msg","to":"Flow","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1330,"y":2680,"wires":[[]]},{"id":"54d26e0c.2176a","type":"function","z":"df9841f2.71dce","name":"200 range split","func":"var msg1 ={'payload' : {'data' : msg.payload.data[0],'buffer': []}}//200 Status\nmsg1.payload.buffer[0] = msg.payload.buffer[0]//Status\nmsg1.payload.buffer[1] = msg.payload.buffer[1]//Status\n\nvar msg2 ={'payload' : {'data' : []}} // 201 Process Feedback\nmsg2.payload.data[0] = msg.payload.data[1]\n\nvar msg3 ={'payload' : {'data' : []}} //202 Control mode\nmsg3.payload.data[0] = msg.payload.data[2]\n\nvar msg4 ={'payload' : {'data' : []}} //203 Operation Mode\nmsg4.payload.data[0] = msg.payload.data[3]\n\nvar msg5 ={'payload' : {'data' : []}} //204 Fault Code\nmsg5.payload.data[0] = msg.payload.data[4]\n\nvar msg6 ={'payload' : {'data' : []}} //205 Alarm Code\nmsg6.payload.data[0] = msg.payload.data[5]\n\nvar msg7 ={'payload' : {'data' : []}} //206 Bearing Status\nmsg7.payload.data[0] = msg.payload.data[6]\n\nvar msg8 ={'payload' : {'data' : []}} //207 Drive State\nmsg8.payload.data[0] = msg.payload.data[7]\n\nvar msg9 ={'payload' : {'data' : []}} // Sensor Feedback\nmsg9.payload.data[0] = msg.payload.data[8]//208 FeedbackSensorUnit\nmsg9.payload.data[1] = msg.payload.data[9]//209 FeedbackSensorMin\nmsg9.payload.data[2] = msg.payload.data[10] //210 FeedbackSensorMax\n\n\nvar msg12 ={'payload' : {'data' : []}} //Freq info\nmsg12.payload.data[0] = msg.payload.data[11] //211NomFrequency\nmsg12.payload.data[1] = msg.payload.data[12]//212 MinFrequency\nmsg12.payload.data[2] = msg.payload.data[13]//213 MaxFrequency\n\nvar msg15 ={'payload' : {'data' : []}} \nmsg15.payload.data[0] = msg.payload.data[14]//214 SetpointRangeMin\nmsg15.payload.data[1] = msg.payload.data[15]//215 SetpointRangeMax\n\nvar msg16 ={'payload' : {'data' : []}} \nmsg16.payload.data[0] = msg.payload.data[21]//222 Kp\nmsg16.payload.data[1] = msg.payload.data[22]//223 Ti\nmsg16.payload.data[2] = msg.payload.data[23]//224 DirectControl\nreturn [msg1,msg2,msg3,msg4,msg5,msg6,msg7,msg8,msg9,msg12,msg15,msg16];","outputs":12,"noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":1840,"wires":[["1829b91a.1036c7"],[],["843806a0.72f8b8","3403ad95.234f02"],[],["ca36e614.6cd478"],["3938ad50.7f9b72"],[],[],["c4b47450.d42398"],["64221cd3.fec434"],["ab3a644d.a2c9c8"],["1bc1a497.34ba0b","3919db04.977524"]]},{"id":"ca36e614.6cd478","type":"link out","z":"df9841f2.71dce","name":"Fault Code raw","links":["3a82ddf2.58aaf2"],"x":975,"y":1740,"wires":[]},{"id":"3938ad50.7f9b72","type":"link out","z":"df9841f2.71dce","name":"Warning code raw","links":["7b33b762.79b6f8"],"x":975,"y":1780,"wires":[]},{"id":"c6b2fc6b.b2ea7","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1730,"y":1620,"wires":[["78cfc8f4.fa2408"]]},{"id":"a8861ea.fa160e","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1730,"y":1680,"wires":[["d52a054b.611ed8"]]},{"id":"87ed189.7fd54e8","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Notification","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"Pump at minimum speed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2040,"y":1600,"wires":[["304fb527.50d4ea"]]},{"id":"78cfc8f4.fa2408","type":"switch","z":"df9841f2.71dce","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1870,"y":1620,"wires":[["87ed189.7fd54e8"],[]]},{"id":"d52a054b.611ed8","type":"switch","z":"df9841f2.71dce","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1870,"y":1680,"wires":[["922c987f.ffd968"],[]]},{"id":"922c987f.ffd968","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Notification","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"Pump at maximum speed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2040,"y":1680,"wires":[["304fb527.50d4ea"]]},{"id":"5c5cae37.57c49","type":"sqlite","z":"df9841f2.71dce","mydb":"c3b98441.243208","sqlquery":"fixed","sql":"create table magna3 (thetime TimeStamp, therpm Integer, thehead float, theflow float, theair float)","name":"create table","x":730,"y":1420,"wires":[["8d33fcba.7eb46"]]},{"id":"8c6ace84.a8d4f","type":"inject","z":"df9841f2.71dce","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1420,"wires":[["5c5cae37.57c49"]]},{"id":"8d33fcba.7eb46","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1110,"y":1420,"wires":[]},{"id":"463e4a8f.88b224","type":"change","z":"df9841f2.71dce","name":"Global Head","rules":[{"t":"move","p":"payload","pt":"msg","to":"head","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1330,"y":2820,"wires":[[]]},{"id":"c1833e15.5c582","type":"change","z":"df9841f2.71dce","name":"Global RPM","rules":[{"t":"move","p":"payload.data[0]","pt":"msg","to":"rpm","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1330,"y":2520,"wires":[[]]},{"id":"bdbe9874.499f68","type":"traffic","z":"df9841f2.71dce","name":"","property_allow":"payload","filter_allow":"start","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"stop","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":1190,"y":2360,"wires":[["37c0b549.6a252a"]]},{"id":"9fc8ddc8.4ac24","type":"inject","z":"df9841f2.71dce","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"start","payloadType":"str","x":870,"y":2320,"wires":[["bdbe9874.499f68"]]},{"id":"41ace4d.d51af1c","type":"inject","z":"df9841f2.71dce","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"stop","payloadType":"str","x":870,"y":2360,"wires":[["bdbe9874.499f68"]]},{"id":"978ac019.19b23","type":"sqlite","z":"df9841f2.71dce","mydb":"c3b98441.243208","sqlquery":"prepared","sql":"insert into magna3 (thetime,therpm,thehead,theflow, theair) values ($thetime,$therpm,$thehead,$theflow,$theair)","name":"Insert Data","x":1570,"y":2360,"wires":[["13a1c168.c4266f"]]},{"id":"37c0b549.6a252a","type":"function","z":"df9841f2.71dce","name":"prepare param","func":"msg.payload = []\nmsg.params = {$thetime:Date.now(), $therpm:global.get(\"rpm\"), $thehead:global.get(\"head\"), $theflow:global.get(\"Flow\"),$theair:global.get(\"Ta_s\")}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":2360,"wires":[["978ac019.19b23"]]},{"id":"13a1c168.c4266f","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1770,"y":2360,"wires":[]},{"id":"2d360e13.819a02","type":"sqlite","z":"df9841f2.71dce","mydb":"c3b98441.243208","sqlquery":"fixed","sql":"select * from magna3","name":"view data","x":720,"y":1480,"wires":[["3e04e2ce.071b1e"]]},{"id":"75905096.9970f","type":"inject","z":"df9841f2.71dce","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1480,"wires":[["2d360e13.819a02"]]},{"id":"3e04e2ce.071b1e","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1110,"y":1480,"wires":[]},{"id":"2a2f7cc4.4da734","type":"sqlite","z":"df9841f2.71dce","mydb":"c3b98441.243208","sqlquery":"fixed","sql":"drop table magna3","name":"drop table","x":720,"y":1540,"wires":[[]]},{"id":"53e60490.473b2c","type":"inject","z":"df9841f2.71dce","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1540,"wires":[["2a2f7cc4.4da734"]]},{"id":"1801d0c4.79271f","type":"link in","z":"df9841f2.71dce","name":"","links":[],"x":175,"y":1720,"wires":[["2a2f7cc4.4da734","302ac7fc.4f7728"]]},{"id":"d594a13d.110c6","type":"link in","z":"df9841f2.71dce","name":"","links":[],"x":895,"y":2280,"wires":[["bdbe9874.499f68"]]},{"id":"302ac7fc.4f7728","type":"delay","z":"df9841f2.71dce","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":310,"y":1600,"wires":[["5c5cae37.57c49"]]},{"id":"3c0b09b4.2e3036","type":"link out","z":"df9841f2.71dce","name":"flow simulation","links":[],"x":1275,"y":2740,"wires":[]},{"id":"ec8a31c1.6b68f","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1230,"y":1780,"wires":[]},{"id":"e60c306d.34b49","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1270,"y":1900,"wires":[]},{"id":"47bfae9b.2b94e","type":"function","z":"df9841f2.71dce","d":true,"name":"Modbus Reader ","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 322\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":220,"y":2480,"wires":[[]]},{"id":"af813e1c.b65f","type":"comment","z":"df9841f2.71dce","name":"Copy as needed and enable","info":"","x":240,"y":2440,"wires":[]},{"id":"37f375c0.632e9a","type":"function","z":"df9841f2.71dce","name":"RPM 304","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 304\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":860,"y":2540,"wires":[["c1833e15.5c582","bdbe9874.499f68","22ff831a.97c09c"]]},{"id":"7f3c6dcf.1d9844","type":"function","z":"df9841f2.71dce","name":"Flow 302","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 302\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":860,"y":2620,"wires":[["d9f8f96d.13c438"]]},{"id":"1011c8b2.add7a7","type":"function","z":"df9841f2.71dce","name":"Head 301","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 301\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":860,"y":2740,"wires":[["4d453a7f.c1f6d4"]]},{"id":"5ffc4e62.43bcc","type":"function","z":"df9841f2.71dce","name":"kW 312","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 312\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":880,"y":2980,"wires":[["16dbf834.0ab598","6846d759.d2f798","6336608a.2e11b"]]},{"id":"d064c86.cad5138","type":"function","z":"df9841f2.71dce","name":"Actual Setpoint 308","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 308\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":3040,"wires":[["61b48c66.e8f584"]]},{"id":"8fe435ba.ac5808","type":"function","z":"df9841f2.71dce","name":"Actual flowlimit 345","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 345\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":3160,"wires":[["65395add.6b2704"]]},{"id":"8460160d.7ffca8","type":"function","z":"df9841f2.71dce","name":"Liquid temp 322","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 322\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":900,"y":3560,"wires":[["c5960fbf.a7427"]]},{"id":"e72f41d9.6f9fd","type":"function","z":"df9841f2.71dce","name":"Opp Hours 327","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 327\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":900,"y":3280,"wires":[["47ec14e9.29d95c"]]},{"id":"e8345517.0e3258","type":"function","z":"df9841f2.71dce","name":"powered Hours 329","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 329\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":3360,"wires":[["2d87c67d.39c38a"]]},{"id":"8e3a9302.b4c66","type":"function","z":"df9841f2.71dce","name":"Start/stop  334","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 334\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":900,"y":3420,"wires":[["cb5863e.742cda"]]},{"id":"557c9867.8f5e08","type":"function","z":"df9841f2.71dce","name":"kWh 332","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 332\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":880,"y":3480,"wires":[["1dc6027a.cadf3e"]]},{"id":"fb5e2c40.3536f","type":"comment","z":"df9841f2.71dce","name":"Record Database","info":"","x":1200,"y":2280,"wires":[]},{"id":"22ff831a.97c09c","type":"link out","z":"df9841f2.71dce","name":"RPM","links":["7e8b0518.66a62c","299408d4.969a08","ede32f5f.cdd9a","9749eff0.d8a9c"],"x":1590,"y":2560,"wires":[],"l":true},{"id":"53473916.7aade8","type":"link out","z":"df9841f2.71dce","name":"Flow","links":["248ab9d0.7a6676","d92607da.b59ed8","2bfffed7.2d1c12","195cf2c6.1d92cd"],"x":1610,"y":2620,"wires":[],"l":true},{"id":"5c0c0e5c.0d0d2","type":"link out","z":"df9841f2.71dce","name":"Head","links":["905601d4.2bbeb","9e68a0d6.0fa58","78f8145b.b0519c","1cc8528e.76be5d"],"x":1570,"y":2780,"wires":[],"l":true},{"id":"16dbf834.0ab598","type":"link out","z":"df9841f2.71dce","name":"kW","links":["c82d5fe1.1723a","86bfbe79.3e458","a5d13acb.90f7e8","8446de07.61587"],"x":1590,"y":2980,"wires":[],"l":true},{"id":"a058e9d5.7e1cb8","type":"link out","z":"df9841f2.71dce","name":"Actual Setpoint","links":["784de128.c583c","e2559591.a6b6c8","29cdcd0d.7f8842"],"x":1600,"y":3080,"wires":[],"l":true},{"id":"938c064a.8b0d78","type":"link out","z":"df9841f2.71dce","name":"Actual FlowLimit","links":["f1c04c67.11f53","cfac4884.e14b48","66a44110.64ea5"],"x":1620,"y":3200,"wires":[],"l":true},{"id":"47ec14e9.29d95c","type":"link out","z":"df9841f2.71dce","name":"Opperation Hours","links":["900df489.4b0a18"],"x":1610,"y":3280,"wires":[],"l":true},{"id":"2d87c67d.39c38a","type":"link out","z":"df9841f2.71dce","name":"Powered Hours","links":["9198768d.6261f8"],"x":1600,"y":3360,"wires":[],"l":true},{"id":"cb5863e.742cda","type":"link out","z":"df9841f2.71dce","name":"#Start/Stop","links":["d41a47ab.4b7038"],"x":1590,"y":3420,"wires":[],"l":true},{"id":"1dc6027a.cadf3e","type":"link out","z":"df9841f2.71dce","name":"kWh","links":["962497a7.b6e448"],"x":1570,"y":3480,"wires":[],"l":true},{"id":"d9e15191.4bd98","type":"link out","z":"df9841f2.71dce","name":"Liquid Temp","links":["fa2f59c0.0824e8"],"x":1590,"y":3600,"wires":[],"l":true},{"id":"7aee277e.173f38","type":"link out","z":"df9841f2.71dce","name":"Remote Temp 2","links":["d579c556.4b8168"],"x":2200,"y":3660,"wires":[],"l":true},{"id":"304fb527.50d4ea","type":"link out","z":"df9841f2.71dce","name":"Min Max Speed Noti","links":["4f591eb7.ddbbd"],"x":2340,"y":1600,"wires":[],"l":true},{"id":"119844b7.624f1b","type":"link out","z":"df9841f2.71dce","name":"Forced Local","links":["10bf3a3.a2d21c6"],"x":2330,"y":1780,"wires":[],"l":true},{"id":"c8d457d2.3e98f8","type":"link out","z":"df9841f2.71dce","name":"Warnings","links":["47269e13.a181b"],"x":2320,"y":1880,"wires":[],"l":true},{"id":"ddfa0c09.8eede","type":"link out","z":"df9841f2.71dce","name":"Faults","links":["88920b9d.f5f848"],"x":2310,"y":1920,"wires":[],"l":true},{"id":"a5a80b61.670c28","type":"link out","z":"df9841f2.71dce","name":"Start / Stop","links":["36f8fff3.6122","8374c8a0.d45708","a6fce854.f3cd68"],"x":2330,"y":1960,"wires":[],"l":true},{"id":"892449e3.63c0c8","type":"link out","z":"df9841f2.71dce","name":"Remote Control","links":["5ce169c5.baa3b8","e61c45d3.bf85a8","3050675a.844fd8"],"x":2340,"y":2000,"wires":[],"l":true},{"id":"79600cac.5f5084","type":"link out","z":"df9841f2.71dce","name":"FlowLimit","links":["a8564ce.1044db","8b09bddd.36fa8","67150a1a.b23d54"],"x":2320,"y":2080,"wires":[],"l":true},{"id":"4d4d0b7a.c51f04","type":"link out","z":"df9841f2.71dce","name":"Control Mode","links":["c88c3be7.27ff78","2014622f.167b0e","675ac215.36be9c"],"x":2340,"y":2140,"wires":[],"l":true},{"id":"caf4a7fd.e87fa8","type":"function","z":"df9841f2.71dce","name":"Alarm/Warning Register","func":"var AlarmWarning = {\n'1' : 'Leakage current',\n'2' : 'Missing phase',\n'3' : 'External fault signal',\n'4' : 'Too many restarts',\n'7' : 'Too many hardware shutdowns',\n'14' : 'Electronic DC-link protection activated (ERP)',\n'16' : 'Other',\n'29' : 'Turbine operation. impellers forced backwards',\n'30' : 'Change bearings (specific service information)',\n'31' : 'Change varistor(s) (specific service information)',\n'32' : 'Overvoltage',\n'40' : 'Undervoltage',\n'41' : 'Undervoltage transient',\n'42' : 'Cut-in fault (dV/dt)',\n'45' : 'Voltage asymmetry',\n'48' : 'Overload',\n'49' : 'Overcurrent (i_line. i_dc. i_mo)',\n'50' : 'Motor protection function. general shutdown (MPF)',\n'51' : 'Blocked motor or pump',\n'54' : 'Motor protection function. 3 sec. limit',\n'55' : 'Motor current protection activated (MCP)',\n'56' : 'Underload',\n'57' : 'Dry-running',\n'60' : 'Low input power',\n'64' : 'Overtemperature',\n'65' : 'Motor temperature 1 (t_m or t_mo or t_mo1)',\n'66' : 'Control electronics temperature high',\n'67' : 'Temperature too high. internal frequency converter module (t_m)',\n'68' : 'Water temperature high',\n'70' : 'Thermal relay 2 in motor. for example thermistor',\n'72' : 'Hardware fault. type 1',\n'73' : 'Hardware shutdown (HSD)',\n'76' : 'Internal communication fault',\n'77' : 'Communication fault. twin-head pump',\n'80' : 'Hardware fault. type 2',\n'83' : 'Verification error. FE parameter area (EEPROM)',\n'84' : 'Memory access error',\n'85' : 'Verification error. BE parameter area (EEPROM)',\n'88' : 'Sensor fault',\n'89' : 'Signal fault. (feedback) sensor 1',\n'91' : 'Signal fault. temperature 1 sensor',\n'93' : 'Signal fault. sensor 2',\n'96' : 'Setpoint signal outside range',\n'105' : 'Electronic rectifier protection activated (ERP)',\n'106' : 'Electronic inverter protection activated (EIP)',\n'148' : 'Motor bearing temperature high (Pt100) in drive end (DE)',\n'149' : 'Motor bearing temperature high (Pt100) in non-drive end (NDE)',\n'155' : 'Inrush fault',\n'156' : 'Communication fault. internal frequency converter module',\n'157' : 'Real time clock error',\n'161' : 'Sensor supply fault. 5 V',\n'162' : 'Sensor supply fault. 24 V',\n'163' : 'Measurement fault. motor protection',\n'164' : 'Signal fault. Liqtec sensor',\n'165' : 'Signal fault. analog input 1',\n'166' : 'Signal fault. analog input 2',\n'167' : 'Signal fault. analog input 3',\n'175' : 'Signal fault. temperature 2 sensor',\n'176' : 'Signal fault. temperature 3 sensor',\n'190' : 'Limit exceeded. sensor 1',\n'191' : 'Limit exceeded. sensor 2',\n'215' : 'Soft pressure buildup timeout',\n'240' : 'Lubricate bearings (specific service information)',\n'241' : 'Motor phase failure',\n'242' : 'Automatic motor model recognition failed',\n}\n\nmsg.payload = AlarmWarning[msg.payload.data[0]]\n\nreturn msg","outputs":1,"noerr":0,"x":1270,"y":4660,"wires":[["51b9012.16a8"]]},{"id":"6285edcb.157f54","type":"function","z":"df9841f2.71dce","name":"Alarm/Warning Register","func":"var AlarmWarning = {\n'1' : 'Leakage current',\n'2' : 'Missing phase',\n'3' : 'External fault signal',\n'4' : 'Too many restarts',\n'7' : 'Too many hardware shutdowns',\n'14' : 'Electronic DC-link protection activated (ERP)',\n'16' : 'Other',\n'29' : 'Turbine operation. impellers forced backwards',\n'30' : 'Change bearings (specific service information)',\n'31' : 'Change varistor(s) (specific service information)',\n'32' : 'Overvoltage',\n'40' : 'Undervoltage',\n'41' : 'Undervoltage transient',\n'42' : 'Cut-in fault (dV/dt)',\n'45' : 'Voltage asymmetry',\n'48' : 'Overload',\n'49' : 'Overcurrent (i_line. i_dc. i_mo)',\n'50' : 'Motor protection function. general shutdown (MPF)',\n'51' : 'Blocked motor or pump',\n'54' : 'Motor protection function. 3 sec. limit',\n'55' : 'Motor current protection activated (MCP)',\n'56' : 'Underload',\n'57' : 'Dry-running',\n'60' : 'Low input power',\n'64' : 'Overtemperature',\n'65' : 'Motor temperature 1 (t_m or t_mo or t_mo1)',\n'66' : 'Control electronics temperature high',\n'67' : 'Temperature too high. internal frequency converter module (t_m)',\n'68' : 'Water temperature high',\n'70' : 'Thermal relay 2 in motor. for example thermistor',\n'72' : 'Hardware fault. type 1',\n'73' : 'Hardware shutdown (HSD)',\n'76' : 'Internal communication fault',\n'77' : 'Communication fault. twin-head pump',\n'80' : 'Hardware fault. type 2',\n'83' : 'Verification error. FE parameter area (EEPROM)',\n'84' : 'Memory access error',\n'85' : 'Verification error. BE parameter area (EEPROM)',\n'88' : 'Sensor fault',\n'89' : 'Signal fault. (feedback) sensor 1',\n'91' : 'Signal fault. temperature 1 sensor',\n'93' : 'Signal fault. sensor 2',\n'96' : 'Setpoint signal outside range',\n'105' : 'Electronic rectifier protection activated (ERP)',\n'106' : 'Electronic inverter protection activated (EIP)',\n'148' : 'Motor bearing temperature high (Pt100) in drive end (DE)',\n'149' : 'Motor bearing temperature high (Pt100) in non-drive end (NDE)',\n'155' : 'Inrush fault',\n'156' : 'Communication fault. internal frequency converter module',\n'157' : 'Real time clock error',\n'161' : 'Sensor supply fault. 5 V',\n'162' : 'Sensor supply fault. 24 V',\n'163' : 'Measurement fault. motor protection',\n'164' : 'Signal fault. Liqtec sensor',\n'165' : 'Signal fault. analog input 1',\n'166' : 'Signal fault. analog input 2',\n'167' : 'Signal fault. analog input 3',\n'175' : 'Signal fault. temperature 2 sensor',\n'176' : 'Signal fault. temperature 3 sensor',\n'190' : 'Limit exceeded. sensor 1',\n'191' : 'Limit exceeded. sensor 2',\n'215' : 'Soft pressure buildup timeout',\n'240' : 'Lubricate bearings (specific service information)',\n'241' : 'Motor phase failure',\n'242' : 'Automatic motor model recognition failed',\n}\n\nmsg.payload = AlarmWarning[msg.payload.data[0]]\n\nreturn msg","outputs":1,"noerr":0,"x":1250,"y":4900,"wires":[["fc18758b.ce2508"]]},{"id":"c69fdede.16e1b","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data[0]","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":950,"y":4640,"wires":[["8ed79256.0d0f6"],["caf4a7fd.e87fa8","ec70f217.722bf"]]},{"id":"8ed79256.0d0f6","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":4580,"wires":[["ec70f217.722bf","51b9012.16a8"]]},{"id":"8424a81.0c01c58","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data[0]","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":4900,"wires":[["f2df24e8.a29fb8"],["6285edcb.157f54","3ce6e7ab.defb48"]]},{"id":"f2df24e8.a29fb8","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":4840,"wires":[["3ce6e7ab.defb48","fc18758b.ce2508"]]},{"id":"d3ae2c52.92d06","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"neq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":4460,"wires":[["33005025.af8fd"],["f14b7a23.d9a098"]]},{"id":"33005025.af8fd","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Enabled","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":4440,"wires":[["5121cb24.6d50b4"]]},{"id":"f14b7a23.d9a098","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Disabled","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":4500,"wires":[["5121cb24.6d50b4"]]},{"id":"3a82ddf2.58aaf2","type":"link in","z":"df9841f2.71dce","name":"","links":["ca36e614.6cd478"],"x":675,"y":4820,"wires":[["8424a81.0c01c58"]]},{"id":"7b33b762.79b6f8","type":"link in","z":"df9841f2.71dce","name":"","links":["3938ad50.7f9b72"],"x":675,"y":4640,"wires":[["c69fdede.16e1b"]]},{"id":"6394a90.09c8658","type":"comment","z":"df9841f2.71dce","name":"Faults and Warnings information page","info":"","x":830,"y":4340,"wires":[]},{"id":"e1e68539.f6a618","type":"comment","z":"df9841f2.71dce","name":"MAGNA3 reading","info":"","x":320,"y":1340,"wires":[]},{"id":"ec70f217.722bf","type":"link out","z":"df9841f2.71dce","name":"Warning Code","links":["7c22e2f1.c6813c"],"x":1520,"y":4560,"wires":[],"l":true},{"id":"51b9012.16a8","type":"link out","z":"df9841f2.71dce","name":"Warning Description","links":["c6c5f66a.57e118"],"x":1540,"y":4640,"wires":[],"l":true},{"id":"3ce6e7ab.defb48","type":"link out","z":"df9841f2.71dce","name":"Fault Code","links":["d4b300dc.d3df"],"x":1510,"y":4820,"wires":[],"l":true},{"id":"fc18758b.ce2508","type":"link out","z":"df9841f2.71dce","name":"Fault Description","links":["988d6b16.5e9be8"],"x":1530,"y":4900,"wires":[],"l":true},{"id":"5121cb24.6d50b4","type":"link out","z":"df9841f2.71dce","name":"Fault Simulation Status","links":["8fe83eeb.9a635"],"x":1170,"y":4460,"wires":[],"l":true},{"id":"d7c8fef6.0a64a","type":"ui_switch","z":"9a5395ce.c2f6e8","name":"","label":"Simulation","tooltip":"","group":"26881754.b529d8","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":230,"y":180,"wires":[["323a71e4.aadf9e"]]},{"id":"b85e31b.cda52d","type":"ui_dropdown","z":"9a5395ce.c2f6e8","d":true,"name":"","label":"Error Code","tooltip":"","place":"Select option","group":"26881754.b529d8","order":1,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"Forced Pumping","value":"29","type":"str"},{"label":"Internal Sensor Fault","value":"88","type":"str"}],"payload":"","topic":"","x":230,"y":120,"wires":[["c8517e28.6fca4"]]},{"id":"c8517e28.6fca4","type":"link out","z":"9a5395ce.c2f6e8","name":"Fault Code Simulation","links":["e6409af.1b98c68","700581d9.2880f"],"x":520,"y":120,"wires":[],"l":true},{"id":"323a71e4.aadf9e","type":"link out","z":"9a5395ce.c2f6e8","name":"Fault Simulation Enable","links":["9f69c2bb.16d78","abe1fcb5.cba1a"],"x":530,"y":180,"wires":[],"l":true},{"id":"b2658090.6b7f4","type":"ui_text","z":"9a5395ce.c2f6e8","group":"bd33570d.7d8268","order":2,"width":"0","height":"0","name":"","label":"Warning Description","format":"{{msg.payload}}","layout":"row-spread","x":500,"y":380,"wires":[]},{"id":"94f6a229.bd301","type":"ui_text","z":"9a5395ce.c2f6e8","group":"bd33570d.7d8268","order":1,"width":0,"height":0,"name":"","label":"Warning Code","format":"{{msg.payload.data[0]}}","layout":"row-spread","x":480,"y":280,"wires":[]},{"id":"ce2d71d1.ae529","type":"ui_text","z":"9a5395ce.c2f6e8","group":"3256df1b.4a908","order":1,"width":0,"height":0,"name":"","label":"Fault Code","format":"{{msg.payload.data[0]}}","layout":"row-spread","x":470,"y":560,"wires":[]},{"id":"7116ea58.2912f4","type":"ui_text","z":"9a5395ce.c2f6e8","group":"3256df1b.4a908","order":2,"width":"0","height":"0","name":"","label":"Fault Description","format":"{{msg.payload}}","layout":"row-spread","x":490,"y":640,"wires":[]},{"id":"8b6b8c69.15254","type":"ui_text","z":"9a5395ce.c2f6e8","group":"26881754.b529d8","order":3,"width":0,"height":0,"name":"","label":"Simulation Status:","format":"{{msg.payload}}","layout":"row-spread","x":490,"y":720,"wires":[]},{"id":"8fe83eeb.9a635","type":"link in","z":"9a5395ce.c2f6e8","name":"Fault Simulation Status","links":["5121cb24.6d50b4"],"x":240,"y":720,"wires":[["8b6b8c69.15254"]],"l":true},{"id":"7c22e2f1.c6813c","type":"link in","z":"9a5395ce.c2f6e8","name":"Warning Code","links":["ec70f217.722bf"],"x":210,"y":280,"wires":[["94f6a229.bd301"]],"l":true},{"id":"c6c5f66a.57e118","type":"link in","z":"9a5395ce.c2f6e8","name":"Warning Code Description","links":["51b9012.16a8"],"x":250,"y":380,"wires":[["b2658090.6b7f4"]],"l":true},{"id":"d4b300dc.d3df","type":"link in","z":"9a5395ce.c2f6e8","name":"Fault Code","links":["3ce6e7ab.defb48"],"x":200,"y":560,"wires":[["ce2d71d1.ae529"]],"l":true},{"id":"988d6b16.5e9be8","type":"link in","z":"9a5395ce.c2f6e8","name":"Fault Description","links":["fc18758b.ce2508"],"x":220,"y":640,"wires":[["7116ea58.2912f4"]],"l":true},{"id":"da76812c.b7233","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 1","channel":"0","interval":"1000","x":190,"y":100,"wires":[["843c5afb.a73f08"]]},{"id":"92045fa2.6d254","type":"widgetlords-vpe-3011b-relay","z":"4826a594.91d66c","name":"K1","channel":"0","x":510,"y":180,"wires":[]},{"id":"efec8d4f.4d032","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 2","channel":"1","interval":"1000","x":220,"y":260,"wires":[["164516d8.45b0c9"]]},{"id":"164516d8.45b0c9","type":"widgetlords-vpe-3011b-relay","z":"4826a594.91d66c","name":"K2","channel":"0","x":540,"y":260,"wires":[]},{"id":"843c5afb.a73f08","type":"debug","z":"4826a594.91d66c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":540,"y":120,"wires":[]},{"id":"3888c556.aaf7fa","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":170,"y":200,"wires":[["92045fa2.6d254","164516d8.45b0c9"]]},{"id":"aef11a24.dcc698","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 3","channel":"2","interval":"1000","x":170,"y":360,"wires":[[]]},{"id":"19f9f51f.e6c8fb","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 4","channel":"3","interval":"1000","x":170,"y":420,"wires":[[]]},{"id":"dc4a1ed6.a90ab","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 5","channel":"4","interval":"1000","x":170,"y":480,"wires":[[]]},{"id":"da18083f.7cea28","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 6","channel":"5","interval":"1000","x":170,"y":540,"wires":[[]]},{"id":"eca8212.22653e","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 7","channel":"6","interval":"1000","x":170,"y":600,"wires":[[]]},{"id":"3cb3f7d1.857b28","type":"widgetlords-vpe-3011b-digital","z":"4826a594.91d66c","name":"DI 8","channel":"7","interval":"1000","x":170,"y":660,"wires":[[]]},{"id":"42f5aee1.d68e7","type":"widgetlords-vpe-3011b-sdafe","z":"4826a594.91d66c","d":true,"name":"","channel":"6","input_type":"7","interval":"1000","x":450,"y":380,"wires":[["184e46cc.f7f349"]]},{"id":"184e46cc.f7f349","type":"debug","z":"4826a594.91d66c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":380,"wires":[]},{"id":"3c81b2cd.386dbe","type":"widgetlords-analog-out","z":"4826a594.91d66c","name":"A2 0-10V","channel":"2","address":"0","x":660,"y":520,"wires":[]},{"id":"90c95d68.7caca","type":"widgetlords-analog-out","z":"4826a594.91d66c","name":"A1 4-20","channel":"0","address":"0","x":660,"y":780,"wires":[]},{"id":"773b37b7.6fe0e8","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"800","payloadType":"num","x":440,"y":780,"wires":[["90c95d68.7caca"]]},{"id":"cdaa4454.e31088","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"4000","payloadType":"num","x":450,"y":900,"wires":[["90c95d68.7caca"]]},{"id":"38741306.92071c","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2000","payloadType":"num","x":430,"y":840,"wires":[["90c95d68.7caca"]]},{"id":"4510f0d0.86c7f","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":450,"y":620,"wires":[["3c81b2cd.386dbe","90c95d68.7caca"]]},{"id":"20662da3.5c4e42","type":"function","z":"4826a594.91d66c","name":"Temp to analogue","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\nvar target_temp = msg.payload\nvar offset = 0.5\nif (target_temp >= max){\n    target_temp = max\n} \nelse if (target_temp <= min){\n    target_temp = min\n}\n\n// voltage = 1 or current = 2 selection\nvar selector = 1\nif(selector==1){\n    var ana_max = 4000\n    var ana_min = 0\n}\nelse{\n    var ana_max = 4000\n    var ana_min = 800\n}\n\nvar target_percentage = ((target_temp-offset)-min) / (max-min)\n\nvar target_ana = target_percentage *(ana_max-ana_min)+ana_min\n\nmsg.payload = parseFloat((target_ana).toFixed(0))\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":440,"wires":[["491a2190.a9a7a","3c81b2cd.386dbe"]]},{"id":"ae852b98.390368","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"15","payloadType":"num","x":410,"y":440,"wires":[["20662da3.5c4e42"]]},{"id":"491a2190.a9a7a","type":"debug","z":"4826a594.91d66c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":460,"wires":[]},{"id":"f4d8e826.9a4ad8","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"4000","payloadType":"num","x":450,"y":580,"wires":[["3c81b2cd.386dbe"]]},{"id":"a4a22633.1cc058","type":"widgetlords-analog-out","z":"a37ace7a.dab1a","name":"A3 0-10V","channel":"2","address":"0","x":1520,"y":2460,"wires":[]},{"id":"63b58268.3b133c","type":"function","z":"a37ace7a.dab1a","name":"Temp to analogue","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\nvar target_temp = msg.payload\nvar offset = 0.5\nif (target_temp >= max){\n    target_temp = max\n} \nelse if (target_temp <= min){\n    target_temp = min\n}\n\n// voltage = 1 or current = 2 selection\nvar selector = 1\nif(selector==1){\n    var ana_max = 4000\n    var ana_min = 0\n}\nelse{\n    var ana_max = 4000\n    var ana_min = 800\n}\n\nvar target_percentage = ((target_temp-offset)-min) / (max-min)\n\nvar target_ana = target_percentage *(ana_max-ana_min)+ana_min\n\nmsg.payload = parseFloat((target_ana).toFixed(0))\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1230,"y":2460,"wires":[["a4a22633.1cc058"]]},{"id":"5846933f.4a635c","type":"widgetlords-analog-out","z":"4826a594.91d66c","name":"A1 0-5","channel":"2","address":"0","x":1070,"y":780,"wires":[]},{"id":"c98343e5.171b6","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":860,"y":780,"wires":[["5846933f.4a635c"]]},{"id":"227ce968.5065e6","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"4000","payloadType":"num","x":870,"y":900,"wires":[["5846933f.4a635c"]]},{"id":"444da160.20aeb","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2000","payloadType":"num","x":850,"y":840,"wires":[["5846933f.4a635c"]]},{"id":"7f0b8c32.f6e274","type":"inject","z":"df9841f2.71dce","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2620,"wires":[["e4deaed3.e92b9","783f60d3.8951a"]]},{"id":"3dd23c0d.ea4774","type":"debug","z":"df9841f2.71dce","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":2200,"wires":[]},{"id":"5fd67a3a.c00044","type":"function","z":"df9841f2.71dce","name":"Setup - FC3 708 1","func":"var fc=3;\nvar sa=708;\nvar addresses=1;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":170,"y":2940,"wires":[["d2ef9762.04d0e8","4542b5c0.2c4e4c"]]},{"id":"d2ef9762.04d0e8","type":"modbus-flex-getter","z":"df9841f2.71dce","name":"Read","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"276147dc.e6e7f8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":490,"y":2780,"wires":[[],["a8159631.161688","3dd23c0d.ea4774"]]},{"id":"e4deaed3.e92b9","type":"function","z":"df9841f2.71dce","name":"Setup - FC3 300 62","func":"var fc=3;\nvar sa=300;\nvar addresses=62;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":170,"y":2740,"wires":[["d2ef9762.04d0e8","549476c5.f61428"]]},{"id":"549476c5.f61428","type":"function","z":"df9841f2.71dce","name":"Setup - FC3 200 24","func":"var fc=3;\nvar sa=200;\nvar addresses=24;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":170,"y":2840,"wires":[["d2ef9762.04d0e8","5fd67a3a.c00044"]]},{"id":"a8159631.161688","type":"switch","z":"df9841f2.71dce","name":"","property":"modbusRequest.address","propertyType":"msg","rules":[{"t":"eq","v":"300","vt":"str"},{"t":"eq","v":"200","vt":"str"},{"t":"eq","v":"708","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":450,"y":3220,"wires":[["37f375c0.632e9a","7f3c6dcf.1d9844","1011c8b2.add7a7","5ffc4e62.43bcc","d064c86.cad5138","8fe435ba.ac5808","e72f41d9.6f9fd","e8345517.0e3258","8e3a9302.b4c66","557c9867.8f5e08","8460160d.7ffca8","14adb88c.208237","850f5928.2bab38","581861a3.4e7be","92bcfc72.40854","d9fb97ca.c56038","e666c7da.95f308","dfe04e1c.23f62","8fd49acc.486058"],["54d26e0c.2176a"],["d3ae2c52.92d06"]]},{"id":"1795c9d7.1118c6","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 100","func":"var fc=6;\nvar sa=100;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1640,"y":520,"wires":[["f283b09a.14ddc"]]},{"id":"f283b09a.14ddc","type":"modbus-flex-write","z":"df9841f2.71dce","name":"ModBus Write","showStatusActivities":false,"showErrors":false,"server":"276147dc.e6e7f8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2020,"y":520,"wires":[[],[]]},{"id":"9819a4fa.874458","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 105","func":"var fc=6;\nvar sa=105;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1600,"y":640,"wires":[["f283b09a.14ddc"]]},{"id":"1d1648ef.fbbd77","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 101","func":"var fc=6;\nvar sa=101;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1620,"y":780,"wires":[["f283b09a.14ddc"]]},{"id":"815fc409.1f7568","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 103","func":"var fc=6;\nvar sa=103;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1660,"y":1040,"wires":[["f283b09a.14ddc"]]},{"id":"700581d9.2880f","type":"link in","z":"df9841f2.71dce","name":"Fault Code Simulation","links":["c8517e28.6fca4"],"x":1455,"y":1140,"wires":[["9e3bc08c.2164b","3886721b.80235e"]]},{"id":"abe1fcb5.cba1a","type":"link in","z":"df9841f2.71dce","name":"Fault Simulation Enable","links":["323a71e4.aadf9e"],"x":1435,"y":1220,"wires":[["35151b28.1ce0a4"]]},{"id":"9e3bc08c.2164b","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 700","func":"var fc=6;\nvar sa=700;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1660,"y":1100,"wires":[["f283b09a.14ddc"]]},{"id":"3886721b.80235e","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 701","func":"var fc=6;\nvar sa=701;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1660,"y":1200,"wires":[["f283b09a.14ddc"]]},{"id":"35151b28.1ce0a4","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 707","func":"var fc=6;\nvar sa=707;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1640,"y":1280,"wires":[["f283b09a.14ddc"]]},{"id":"64221cd3.fec434","type":"function","z":"df9841f2.71dce","name":"freq","func":"var nom_freq = msg.payload.data[0]/100\nvar min_freq = msg.payload.data[1]/100\nvar max_freq = msg.payload.data[2]/100\n\n\nglobal.set(\"min_freq\",min_freq)\nglobal.set(\"max_freq\",max_freq)\n\n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":1860,"wires":[[]]},{"id":"14adb88c.208237","type":"function","z":"df9841f2.71dce","name":"Remote temp2 337","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 337\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":3720,"wires":[["14c409b1.3f71d6"]]},{"id":"c8c0c970.d5ea08","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3720,"wires":[["1dbd7b84.830b74"],["b5aae718.4f2df8"]]},{"id":"1dbd7b84.830b74","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"unit","pt":"msg","to":" ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1800,"y":3660,"wires":[["7aee277e.173f38"]]},{"id":"94f61483.82a378","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1740,"y":3720,"wires":[["7aee277e.173f38"]]},{"id":"581861a3.4e7be","type":"function","z":"df9841f2.71dce","name":"Remote press 2 341","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 341\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":920,"y":3800,"wires":[["be9101e4.dc0e3"]]},{"id":"14c409b1.3f71d6","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Temp 2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3720,"wires":[["5362105.9f312f"]]},{"id":"be9101e4.dc0e3","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Press 2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3800,"wires":[["b5b73046.0f6af"]]},{"id":"92bcfc72.40854","type":"function","z":"df9841f2.71dce","name":"Remote press 1 316","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 316\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":920,"y":3840,"wires":[["846bf351.07c5f"]]},{"id":"846bf351.07c5f","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Press 1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3840,"wires":[["60b2c68f.6baad8"]]},{"id":"850f5928.2bab38","type":"function","z":"df9841f2.71dce","name":"Remote temp1 320","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 320\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":3760,"wires":[["b9bb7d72.05f3a"]]},{"id":"b9bb7d72.05f3a","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Temp 1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3760,"wires":[["9263cbdf.b1b988"]]},{"id":"d9fb97ca.c56038","type":"function","z":"df9841f2.71dce","name":"Remote flow 314","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 314\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":3880,"wires":[["d2a37965.f4a418"]]},{"id":"d2a37965.f4a418","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Flow","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3880,"wires":[["49fcaf3a.a86a2"]]},{"id":"e666c7da.95f308","type":"function","z":"df9841f2.71dce","name":"Remote diff temp 346","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 346\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":920,"y":3920,"wires":[["37870a07.4dd6b6"]]},{"id":"37870a07.4dd6b6","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Diff Temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3920,"wires":[["c9ba35c2.1ed748"]]},{"id":"dfe04e1c.23f62","type":"function","z":"df9841f2.71dce","name":"Remote diff press 349","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 349\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":920,"y":3960,"wires":[["35d8bbbc.493e84"]]},{"id":"35d8bbbc.493e84","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Remote Diff Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3960,"wires":[["5e325dbd.8adc44"]]},{"id":"8fd49acc.486058","type":"function","z":"df9841f2.71dce","name":"Remote tank 350","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 350\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = false\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 301\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data[0] = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":910,"y":4000,"wires":[["7d87ab8f.9a2804"]]},{"id":"7d87ab8f.9a2804","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"unit","pt":"msg","to":"Tank Level","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":4000,"wires":[["83a08c28.cdbe7"]]},{"id":"e11aac26.b2adf","type":"function","z":"41ddd688.39b148","name":"scale","func":"msg.payload = (msg.payload)*100\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":1300,"wires":[["95e70fe.90b4cf"]]},{"id":"9af2180d.43b188","type":"ui_numeric","z":"41ddd688.39b148","name":"Flow Limit","label":"Flow Limit","tooltip":"","group":"ab3a9e02.8ace9","order":4,"width":"0","height":"0","wrap":false,"passthru":true,"topic":"","format":"{{value}} m<sup>3</sup>/h","min":"0","max":"16","step":"0.2","x":380,"y":1300,"wires":[["e11aac26.b2adf"]]},{"id":"d24d4153.79441","type":"ui_numeric","z":"41ddd688.39b148","name":"Setpoint","label":"setpoint","tooltip":"","group":"ab3a9e02.8ace9","order":8,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}} %","min":0,"max":"100","step":"5","x":420,"y":1480,"wires":[["eceb8148.bd0d7"]]},{"id":"eceb8148.bd0d7","type":"function","z":"41ddd688.39b148","name":"scale","func":"msg.payload = msg.payload*100\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":1480,"wires":[["5d64db1a.33c914"]]},{"id":"8ee60760.f2ca18","type":"ui_button","z":"41ddd688.39b148","name":"","group":"806379db.c33df8","order":7,"width":0,"height":0,"passthru":false,"label":"Clear Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"[]","payloadType":"json","topic":"","x":1090,"y":640,"wires":[["c7a90dd.e1d50f"]]},{"id":"c7a90dd.e1d50f","type":"link out","z":"41ddd688.39b148","name":"clear_data","links":["c2d62c34.8824","936243f7.676ee","eedcac74.84ba","99bde37e.fe497"],"x":1315,"y":640,"wires":[]},{"id":"35d2076f.67d128","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3760,"wires":[["1dbd7b84.830b74"],["c037d880.deb9e8"]]},{"id":"b5aae718.4f2df8","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)-273).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3720,"wires":[["94f61483.82a378"]]},{"id":"c037d880.deb9e8","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)-273).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3760,"wires":[["94f61483.82a378"]]},{"id":"c60e7367.60dd9","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3800,"wires":[["1dbd7b84.830b74"],["7bc7dafc.811c84"]]},{"id":"7bc7dafc.811c84","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3800,"wires":[["94f61483.82a378"]]},{"id":"6307d1be.3945e","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3840,"wires":[["1dbd7b84.830b74"],["3d3f664c.c1837a"]]},{"id":"3d3f664c.c1837a","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3840,"wires":[["94f61483.82a378"]]},{"id":"331b4adb.148926","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3880,"wires":[["1dbd7b84.830b74"],["2c465245.98ad3e"]]},{"id":"2c465245.98ad3e","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3880,"wires":[["94f61483.82a378"]]},{"id":"3ff23842.1e6cb8","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3920,"wires":[["1dbd7b84.830b74"],["a78de862.9aca78"]]},{"id":"a78de862.9aca78","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3920,"wires":[["94f61483.82a378"]]},{"id":"faa23adb.055a08","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":3960,"wires":[["1dbd7b84.830b74"],["cc98ed23.a1897"]]},{"id":"cc98ed23.a1897","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":3960,"wires":[["94f61483.82a378"]]},{"id":"ff938b93.52faf8","type":"switch","z":"df9841f2.71dce","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"65535","vt":"num"},{"t":"neq","v":"65535","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":4000,"wires":[["1dbd7b84.830b74"],["78f7da98.805354"]]},{"id":"78f7da98.805354","type":"function","z":"df9841f2.71dce","name":"rounding","func":"\n\nmsg.payload = parseFloat(((msg.payload.data / 100)).toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":4000,"wires":[["94f61483.82a378"]]},{"id":"5362105.9f312f","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3720,"wires":[["c8c0c970.d5ea08"]]},{"id":"9263cbdf.b1b988","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3760,"wires":[["35d2076f.67d128"]]},{"id":"b5b73046.0f6af","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3800,"wires":[["c60e7367.60dd9"]]},{"id":"60b2c68f.6baad8","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3840,"wires":[["6307d1be.3945e"]]},{"id":"49fcaf3a.a86a2","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3880,"wires":[["331b4adb.148926"]]},{"id":"c9ba35c2.1ed748","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3920,"wires":[["3ff23842.1e6cb8"]]},{"id":"5e325dbd.8adc44","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":3960,"wires":[["faa23adb.055a08"]]},{"id":"83a08c28.cdbe7","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.data","x":1270,"y":4000,"wires":[["ff938b93.52faf8"]]},{"id":"69f71969.615508","type":"modbus-flex-getter","z":"eb529f3f.63dd2","name":"Read Valve","showStatusActivities":false,"showErrors":false,"logIOActivities":false,"server":"276147dc.e6e7f8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":730,"y":180,"wires":[[],["d41c6310.9ad7d"]]},{"id":"af29968b.4dc458","type":"function","z":"eb529f3f.63dd2","name":"Application- FC3 32810","func":"var fc=3;\nvar sa=32810;\nvar addresses=1;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":340,"wires":[["69f71969.615508","7981b9ca.16ae78"]]},{"id":"5b51e73b.c2c548","type":"debug","z":"eb529f3f.63dd2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1230,"y":420,"wires":[]},{"id":"9f06ecd7.5ec7a","type":"modbus-flex-write","z":"eb529f3f.63dd2","name":"ModBus Write","showStatusActivities":false,"showErrors":false,"server":"276147dc.e6e7f8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":960,"y":440,"wires":[[],["5b51e73b.c2c548"]]},{"id":"a30c20cf.13863","type":"function","z":"eb529f3f.63dd2","name":"Application- FC6 32810","func":"var fc=6;\nvar sa=32810;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":460,"wires":[["9f06ecd7.5ec7a","bff76720.e05e28"]]},{"id":"a74fb536.e37e48","type":"inject","z":"df9841f2.71dce","d":true,"name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":2560,"wires":[["e4deaed3.e92b9"]]},{"id":"bd95f373.ef331","type":"function","z":"eb529f3f.63dd2","name":"32 Bit Write - FC 16","func":"var fc=16;\nvar sa=70;\nvar addresses=2;\nvar value=msg.payload;\nbuf=Buffer.alloc(4);\nbuf.writeFloatBE(value);\n//buf.writeFloatBE(16001.5);\nvar values=[(buf[0]*256+buf[1]),(buf[2]*256)+buf[3]]\n//msg.slave_id=37;\nmsg.payload={\"value\":values , 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":40,"wires":[[]]},{"id":"82fd7730.cb7ae8","type":"function","z":"eb529f3f.63dd2","name":"32 bit read","func":"\nvar lg = msg.payload.data.length\n\nif (lg < 1){\n\nconst buf = Buffer.from(msg.payload.buffer);\nconst value = buf.readUInt32BE();\nmsg.payload = value;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":80,"wires":[[]]},{"id":"1fb49842.985288","type":"comment","z":"eb529f3f.63dd2","name":"Valve initial Configuration","info":"","x":150,"y":40,"wires":[]},{"id":"7981b9ca.16ae78","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":380,"wires":[["414ce1b6.75c42"]]},{"id":"e2169d08.65086","type":"function","z":"eb529f3f.63dd2","name":"32 bit float read","func":"\nvar lg = msg.payload.data.length\n\nif (lg > 1){\n\nconst buf = Buffer.from(msg.payload.buffer);\nconst value = buf.readFloatBE();\n\nmsg.payload = value;\nmsg.payload = parseFloat(msg.payload.toFixed(1));\n\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":220,"wires":[["5b51e73b.c2c548","874b4ba2.c1c508"]]},{"id":"414ce1b6.75c42","type":"change","z":"eb529f3f.63dd2","name":"digital mode","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":420,"wires":[["a30c20cf.13863"]]},{"id":"af06f619.0aaf38","type":"function","z":"eb529f3f.63dd2","name":"Cooling - FC3 32811","func":"var fc=3;\nvar sa=32811;\nvar addresses=1;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":280,"y":600,"wires":[["8befb295.9552a","69f71969.615508"]]},{"id":"6e798500.f951bc","type":"function","z":"eb529f3f.63dd2","name":"Cooling - FC6 32811","func":"var fc=6;\nvar sa=32811;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":280,"y":720,"wires":[["9f06ecd7.5ec7a","452f190b.ce56a8"]]},{"id":"8befb295.9552a","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":640,"wires":[["a448e884.191308"]]},{"id":"a448e884.191308","type":"change","z":"eb529f3f.63dd2","name":"cooling mode","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":680,"wires":[["6e798500.f951bc"]]},{"id":"bff76720.e05e28","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":540,"wires":[["af06f619.0aaf38"]]},{"id":"bdcfbd4d.22ae7","type":"function","z":"eb529f3f.63dd2","name":"Valve Type - FC6 32802","func":"var fc=6;\nvar sa=32802;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":240,"wires":[["9f06ecd7.5ec7a","9d197804.3b0868"]]},{"id":"7b302ef2.96bb2","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":160,"wires":[["e7c50842.8e2c28"]]},{"id":"e7c50842.8e2c28","type":"change","z":"eb529f3f.63dd2","name":"DN32","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":200,"wires":[["bdcfbd4d.22ae7"]]},{"id":"9d197804.3b0868","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":280,"wires":[["af29968b.4dc458"]]},{"id":"51828857.6c0828","type":"function","z":"eb529f3f.63dd2","name":"Units Display - FC3 32787","func":"var fc=3;\nvar sa=32787;\nvar addresses=1;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":860,"wires":[["5d74181c.6c5f18","69f71969.615508"]]},{"id":"112519c.127cce6","type":"function","z":"eb529f3f.63dd2","name":"Units display - FC6 32787","func":"var fc=6;\nvar sa=32787;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":980,"wires":[["ce048843.2809e8","9f06ecd7.5ec7a"]]},{"id":"5d74181c.6c5f18","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":900,"wires":[["9dd2a383.cbb5a"]]},{"id":"9dd2a383.cbb5a","type":"change","z":"eb529f3f.63dd2","name":"% mode","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":940,"wires":[["112519c.127cce6"]]},{"id":"452f190b.ce56a8","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":800,"wires":[["51828857.6c0828"]]},{"id":"a0cd4af0.c06ad8","type":"function","z":"eb529f3f.63dd2","name":"Units setpoint - FC3 32788","func":"var fc=3;\nvar sa=32788;\nvar addresses=1;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":300,"y":1120,"wires":[["34f138fc.7a2038","69f71969.615508"]]},{"id":"e9ebde18.2a129","type":"function","z":"eb529f3f.63dd2","name":"Units setpoint - FC6 32788","func":"var fc=6;\nvar sa=32788;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":300,"y":1240,"wires":[["9f06ecd7.5ec7a","3b190b52.6f4854"]]},{"id":"34f138fc.7a2038","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":1160,"wires":[["db8ec00d.4d021"]]},{"id":"db8ec00d.4d021","type":"change","z":"eb529f3f.63dd2","name":"% mode","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":1200,"wires":[["e9ebde18.2a129"]]},{"id":"ce048843.2809e8","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":1060,"wires":[["a0cd4af0.c06ad8"]]},{"id":"4b1ab2bd.d6c54c","type":"function","z":"eb529f3f.63dd2","name":"Design FLow - FC3 32798","func":"var fc=3;\nvar sa=32798;\nvar addresses=2;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":320,"y":1380,"wires":[["46f1c188.9882","69f71969.615508"]]},{"id":"46f1c188.9882","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":1420,"wires":[["d53db3b1.d84f2"]]},{"id":"d53db3b1.d84f2","type":"change","z":"eb529f3f.63dd2","name":"100 %","rules":[{"t":"set","p":"payload","pt":"msg","to":"100.0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":1460,"wires":[["5c48a765.7c8888"]]},{"id":"3b190b52.6f4854","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":1320,"wires":[["4b1ab2bd.d6c54c"]]},{"id":"5c48a765.7c8888","type":"function","z":"eb529f3f.63dd2","name":"Design Flow - FC 16 32798","func":"var fc=16;\nvar sa=32798;\nvar addresses=2;\nvar value=msg.payload;\nbuf=Buffer.alloc(4);\nbuf.writeFloatBE(value);\n//buf.writeFloatBE(16001.5);\nvar values=[(buf[0]*256+buf[1]),(buf[2]*256)+buf[3]]\n//msg.slave_id=37;\nmsg.payload={\"value\":values , 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":1520,"wires":[["9f06ecd7.5ec7a","d598d53b.8b3918"]]},{"id":"97da71e1.80026","type":"inject","z":"eb529f3f.63dd2","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":80,"wires":[["4453cf8d.393a6"]]},{"id":"34d461ff.58d0be","type":"function","z":"eb529f3f.63dd2","name":"Setpoint - FC 16 33280","func":"var fc=16;\nvar sa=33280;\nvar addresses=2;\nvar value=msg.payload;\nbuf=Buffer.alloc(4);\nbuf.writeFloatBE(value);\n//buf.writeFloatBE(16001.5);\nvar values=[(buf[0]*256+buf[1]),(buf[2]*256)+buf[3]]\n//msg.slave_id=37;\nmsg.payload={\"value\":values , 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":1840,"wires":[["b9fe9436.27aca8"]]},{"id":"b9fe9436.27aca8","type":"link out","z":"eb529f3f.63dd2","name":"To Valve Write","links":["e4d23ad4.0c4108"],"x":1180,"y":1840,"wires":[],"l":true},{"id":"e4d23ad4.0c4108","type":"link in","z":"eb529f3f.63dd2","name":"to write in","links":["b9fe9436.27aca8"],"x":785,"y":320,"wires":[["9f06ecd7.5ec7a"]],"l":true},{"id":"f9c94949.d1c8b8","type":"function","z":"eb529f3f.63dd2","name":"Setpoint and Valve - FC3 33282","func":"var fc=3;\nvar sa=33282;\nvar addresses=2;\nmsg.topic = \"SPV\"\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":810,"y":1980,"wires":[[]]},{"id":"723e5ede.d8098","type":"link out","z":"eb529f3f.63dd2","name":"to valve read","links":["3126ef76.72531"],"x":1190,"y":2120,"wires":[],"l":true},{"id":"3126ef76.72531","type":"link in","z":"eb529f3f.63dd2","name":"to valve read in","links":["723e5ede.d8098"],"x":880,"y":20,"wires":[["69f71969.615508"]],"l":true},{"id":"a5f899ce.1a1b28","type":"function","z":"eb529f3f.63dd2","name":"Valve Mode - FC6 33284","func":"var fc=6;\nvar sa=33284;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":810,"y":1780,"wires":[["b9fe9436.27aca8"]]},{"id":"c6f3e4a4.94bcc8","type":"function","z":"eb529f3f.63dd2","name":"Valve Speed - FC6 32803","func":"var fc=6;\nvar sa=32803;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":810,"y":1720,"wires":[["b9fe9436.27aca8"]]},{"id":"2990d696.0da3ba","type":"function","z":"eb529f3f.63dd2","name":"alarms- FC3 33536","func":"var fc=3;\nvar sa=33536;\nvar addresses=2;\nmsg.topic = \"Alarm\"\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":790,"y":2180,"wires":[["723e5ede.d8098"]]},{"id":"1f5cffe1.6017d","type":"function","z":"eb529f3f.63dd2","name":"Status - FC3 33798 16","func":"var fc=3;\nvar sa=33798;\nvar addresses=16;\nmsg.topic = \"LONG\"\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":800,"y":2100,"wires":[["723e5ede.d8098","2fbe2c7e.221474"]]},{"id":"4377c8ec.347e28","type":"function","z":"a37ace7a.dab1a","name":"rational fit","func":"var q = global.get(\"Flow\");\nvar q_max = 4.6\n\nvar p1 = 8594\nvar p2 = 4.258\nvar q1 = 6451\nvar q2 = 2322\nvar Q = 52000\n//var Q = 31500\nvar x = q/q_max\n\nf = (p1*x+p2)/(x^2+q1*x+q2)\nmsg.payload = f*Q\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":920,"y":2000,"wires":[["ad8b3486.0214a8","5a7039ae.5779e8"]]},{"id":"d41c6310.9ad7d","type":"switch","z":"eb529f3f.63dd2","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"LONG","vt":"str"},{"t":"eq","v":"SPV","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":890,"y":200,"wires":[["c0512f38.512ad"],["e2169d08.65086"],[]]},{"id":"96bdf204.1567","type":"ui_dropdown","z":"eea6a755.f6fb28","name":"","label":"Speed","tooltip":"","place":"Valve Speed","group":"8dd78c30.ffe35","order":2,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"3 sec/mm","value":1,"type":"num"},{"label":"6 sec/mm","value":2,"type":"num"},{"label":"12 sec/mm","value":3,"type":"num"},{"label":"24 sec/mm","value":4,"type":"num"}],"payload":"","topic":"","x":450,"y":160,"wires":[["465f9627.8e57f8"]]},{"id":"b448ffee.1e561","type":"ui_button","z":"eea6a755.f6fb28","name":"","group":"8dd78c30.ffe35","order":1,"width":0,"height":0,"passthru":false,"label":"Initial Configuration","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":490,"y":100,"wires":[["49b85d73.09e884"]]},{"id":"b6ce637b.57a25","type":"link out","z":"eea6a755.f6fb28","name":"valve opening","links":["fc8fe1e6.d3cac"],"x":1000,"y":400,"wires":[],"l":true},{"id":"465f9627.8e57f8","type":"link out","z":"eea6a755.f6fb28","name":"valve speed","links":["2b93ab3e.1d0664"],"x":1015,"y":160,"wires":[],"l":true},{"id":"49b85d73.09e884","type":"link out","z":"eea6a755.f6fb28","name":"valve config","links":["dc16bc73.d8718"],"x":1030,"y":100,"wires":[],"l":true},{"id":"fc8fe1e6.d3cac","type":"link in","z":"eb529f3f.63dd2","name":"Valve Opening in","links":["ffa989da.dcf3b8","7dc4aa8f.3dc8a4","b6ce637b.57a25"],"x":415,"y":1840,"wires":[["34d461ff.58d0be"]]},{"id":"2b93ab3e.1d0664","type":"link in","z":"eb529f3f.63dd2","name":"Valve Speed In","links":["465f9627.8e57f8"],"x":440,"y":1720,"wires":[["c6f3e4a4.94bcc8"]]},{"id":"98c23be.16799c8","type":"ui_dropdown","z":"eea6a755.f6fb28","name":"","label":"Mode","tooltip":"","place":"Valve Mode","group":"8dd78c30.ffe35","order":3,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"Normal","value":1,"type":"num"},{"label":"Calibration","value":2,"type":"num"},{"label":"Flush","value":3,"type":"num"},{"label":"De-Air","value":4,"type":"num"},{"label":"Alarm","value":5,"type":"num"}],"payload":"","topic":"","x":450,"y":220,"wires":[["906fb165.4fe22"]]},{"id":"906fb165.4fe22","type":"link out","z":"eea6a755.f6fb28","name":"Valve Mode","links":["a958127.e228cf"],"x":1010,"y":220,"wires":[],"l":true},{"id":"a958127.e228cf","type":"link in","z":"eb529f3f.63dd2","name":"Valve Mode in","links":["906fb165.4fe22"],"x":400,"y":1780,"wires":[["a5f899ce.1a1b28"]]},{"id":"4542b5c0.2c4e4c","type":"link out","z":"df9841f2.71dce","name":"to valve ","links":["191b0aae.7f1885"],"x":200,"y":3060,"wires":[],"l":true},{"id":"191b0aae.7f1885","type":"link in","z":"eb529f3f.63dd2","name":"to valve in","links":["4542b5c0.2c4e4c"],"x":440,"y":2020,"wires":[["cd217cde.71afc"]]},{"id":"c0512f38.512ad","type":"link out","z":"eb529f3f.63dd2","name":"to data","links":["630da9f6.e912e8"],"x":1095,"y":120,"wires":[]},{"id":"5af24b08.1511b4","type":"function","z":"eb529f3f.63dd2","name":"Total Opp Hours 33798","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 33798\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 33798\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":2320,"wires":[["ebd781fd.cb1b2"]]},{"id":"9c05c20d.b1d12","type":"function","z":"eb529f3f.63dd2","name":"Lifetime Estimate 33800","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 33800\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 33798\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":810,"y":2380,"wires":[["b0d72270.69c53"]]},{"id":"ad106ed8.21f89","type":"function","z":"eb529f3f.63dd2","name":"Min since power 33808","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 33808\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 33798\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":809.5,"y":2436.25,"wires":[["ebd91561.c75d68"]]},{"id":"78790893.6100c8","type":"function","z":"eb529f3f.63dd2","name":"Min since cali 33810","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 33810\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 33798\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"x":800,"y":2500,"wires":[["674c4679.1d6d58"]]},{"id":"ee2aae76.991a8","type":"function","z":"eb529f3f.63dd2","name":"Min since closed 33812","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 33812\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 33798\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":2560,"wires":[["c9b0c88a.820ab8"]]},{"id":"76015bc1.2f6b04","type":"function","z":"eb529f3f.63dd2","name":"Min since open 33814","func":"// The purpose of this block is to make it use to extract information \n// from the modbus read output block which covers everything from\n// Address 301 to 362 with respect to the MODbus functional profile\n\n\n// Firstly, define the MODbus address you are interested in as stated\n// in the functional profile\n// example if you want to read the pump head on address 301\n// then modbus_add = 301 \nvar Modbus_add = 33814\n\n// Some addresses are a 32bit, which is indicated by the functional \n// profile, as having a HI and LO part on seperate addresses\n// Example is Opperation time, which is on address 327 and 328\n// if you want to read one of these 32bit addresses, change the \n// Double_add from \"false\" to \"true\". The address should be the first\n// of the double, so from previous example, Modbus_add = 327\n\nvar Double_add = true\n\n// the code below will now extract and format the data point you have \n// selected. you will not need to change anything below\n\nvar index = Modbus_add - 33798\nvar msg1 ={'payload' : {'data' : [],'buffer': []}}\n\nif (Double_add === true){\n\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]//\nindex = index+1\nmsg1.payload.data[1] = msg.payload.data[index]//PowerLO\nmsg1.payload.buffer[2] = msg.payload.buffer[index*2]//\nmsg1.payload.buffer[3] = msg.payload.buffer[index*2+1]//\n\n// Create new Buffer based on array bytes\nconst buf = Buffer.from(msg1.payload.buffer);\n\n// Represent these bytes as 32-bit unsigned int\nconst value = buf.readUInt32BE();\n\n// save the value\nmsg1.payload.data = value;    \n}\nelse {\nmsg1.payload.data[0] = msg.payload.data[index]\nmsg1.payload.buffer[0] = msg.payload.buffer[index*2]\nmsg1.payload.buffer[1] = msg.payload.buffer[index*2+1]\n}\nreturn msg1;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":2620,"wires":[["aabbae08.e433b"]]},{"id":"630da9f6.e912e8","type":"link in","z":"eb529f3f.63dd2","name":"","links":["c0512f38.512ad"],"x":420,"y":2320,"wires":[["5af24b08.1511b4","9c05c20d.b1d12","ad106ed8.21f89","78790893.6100c8","ee2aae76.991a8","76015bc1.2f6b04"]]},{"id":"ebd781fd.cb1b2","type":"link out","z":"eb529f3f.63dd2","name":"valve opp hours","links":["9a88cba0.70e4d8"],"x":1100,"y":2320,"wires":[]},{"id":"b0d72270.69c53","type":"link out","z":"eb529f3f.63dd2","name":"valve est life","links":["8db3305d.89df3"],"x":1095,"y":2380,"wires":[]},{"id":"ebd91561.c75d68","type":"link out","z":"eb529f3f.63dd2","name":"valve min since power","links":["b191b94d.a30058"],"x":1095,"y":2440,"wires":[]},{"id":"674c4679.1d6d58","type":"link out","z":"eb529f3f.63dd2","name":"valve min since cali","links":["8ced6b62.130b28"],"x":1095,"y":2500,"wires":[]},{"id":"c9b0c88a.820ab8","type":"link out","z":"eb529f3f.63dd2","name":"valve min since closed","links":["4074f8fa.cff398"],"x":1095,"y":2560,"wires":[]},{"id":"aabbae08.e433b","type":"link out","z":"eb529f3f.63dd2","name":"valve min since open","links":["4e3fd305.fe0dac"],"x":1095,"y":2620,"wires":[]},{"id":"9654c3eb.28d4c","type":"ui_numeric","z":"eea6a755.f6fb28","name":"","label":"Valve Opening","tooltip":"","group":"8dd78c30.ffe35","order":4,"width":"0","height":"0","wrap":false,"passthru":true,"topic":"","format":"{{value}} %","min":0,"max":"100","step":"5","x":500,"y":440,"wires":[["b6ce637b.57a25"]]},{"id":"6170e4bb.ddbd2c","type":"ui_text","z":"eea6a755.f6fb28","group":"7185a1fe.34f35","order":5,"width":0,"height":0,"name":"","label":"Total Opperational Hours","format":"{{msg.payload.data}}","layout":"row-spread","x":1030,"y":500,"wires":[]},{"id":"490a757d.1348cc","type":"inject","z":"eea6a755.f6fb28","name":"","repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"4","payloadType":"num","x":150,"y":160,"wires":[["96bdf204.1567"]]},{"id":"d1aa4ff3.cfe9e","type":"inject","z":"eea6a755.f6fb28","name":"","repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"1","payloadType":"num","x":150,"y":220,"wires":[["98c23be.16799c8"]]},{"id":"b9fe2643.02a328","type":"ui_text","z":"eea6a755.f6fb28","d":true,"group":"7185a1fe.34f35","order":5,"width":0,"height":0,"name":"","label":"Lifetime expended","format":"{{msg.payload.data}} %","layout":"row-spread","x":1010,"y":560,"wires":[]},{"id":"263c6e9d.aa29e2","type":"ui_text","z":"eea6a755.f6fb28","group":"7185a1fe.34f35","order":5,"width":0,"height":0,"name":"","label":"Min Sinced Powered","format":"{{msg.payload.data}}","layout":"row-spread","x":1020,"y":620,"wires":[]},{"id":"f131a4dd.f61628","type":"ui_text","z":"eea6a755.f6fb28","group":"7185a1fe.34f35","order":5,"width":0,"height":0,"name":"","label":"Min Sinced Calibrated","format":"{{msg.payload.data}}","layout":"row-spread","x":1020,"y":680,"wires":[]},{"id":"733d3b48.edf824","type":"ui_text","z":"eea6a755.f6fb28","group":"7185a1fe.34f35","order":5,"width":0,"height":0,"name":"","label":"Min Sinced Closed","format":"{{msg.payload.data}}","layout":"row-spread","x":1010,"y":740,"wires":[]},{"id":"39b06378.3fcb8c","type":"ui_text","z":"eea6a755.f6fb28","group":"7185a1fe.34f35","order":5,"width":0,"height":0,"name":"","label":"Min Sinced Opened","format":"{{msg.payload.data}}","layout":"row-spread","x":990,"y":800,"wires":[]},{"id":"9a88cba0.70e4d8","type":"link in","z":"eea6a755.f6fb28","name":"","links":["ebd781fd.cb1b2"],"x":460,"y":500,"wires":[["6170e4bb.ddbd2c"]]},{"id":"8db3305d.89df3","type":"link in","z":"eea6a755.f6fb28","name":"","links":["b0d72270.69c53"],"x":455,"y":560,"wires":[["b9fe2643.02a328"]]},{"id":"b191b94d.a30058","type":"link in","z":"eea6a755.f6fb28","name":"","links":["ebd91561.c75d68"],"x":455,"y":620,"wires":[["263c6e9d.aa29e2"]]},{"id":"8ced6b62.130b28","type":"link in","z":"eea6a755.f6fb28","name":"","links":["674c4679.1d6d58"],"x":455,"y":660,"wires":[["f131a4dd.f61628"]]},{"id":"4074f8fa.cff398","type":"link in","z":"eea6a755.f6fb28","name":"","links":["c9b0c88a.820ab8"],"x":455,"y":700,"wires":[["733d3b48.edf824"]]},{"id":"4e3fd305.fe0dac","type":"link in","z":"eea6a755.f6fb28","name":"","links":["aabbae08.e433b"],"x":455,"y":740,"wires":[["39b06378.3fcb8c"]]},{"id":"36dab671.ec5aba","type":"ui_chart","z":"eea6a755.f6fb28","name":"Flow Chart","group":"bb2dbcc9.07f63","order":3,"width":0,"height":0,"label":"Pump Flow","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"20","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1010,"y":960,"wires":[[]]},{"id":"c9c6b162.7e0a2","type":"ui_chart","z":"eea6a755.f6fb28","name":"Head Chart","group":"bb2dbcc9.07f63","order":4,"width":0,"height":0,"label":"Pump Head","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"12","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1010,"y":1080,"wires":[[]]},{"id":"33257799.3ef8e8","type":"ui_gauge","z":"eea6a755.f6fb28","name":"RPM","group":"bb2dbcc9.07f63","order":5,"width":"3","height":"3","gtype":"gage","title":"","label":"RPM","format":"{{msg.payload.data[0] | uppercase}}","min":"1300","max":"4000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":990,"y":900,"wires":[]},{"id":"bead3e3.06e5ec","type":"ui_text","z":"eea6a755.f6fb28","group":"bb2dbcc9.07f63","order":1,"width":"3","height":"1","name":"Flow Value","label":"Flow:","format":"{{msg.payload}} m<sup>3</sup>/h","layout":"row-left","x":1010,"y":1020,"wires":[]},{"id":"48b742e1.a93eac","type":"ui_text","z":"eea6a755.f6fb28","group":"bb2dbcc9.07f63","order":2,"width":"3","height":"1","name":"Head Value","label":"Head:","format":"{{msg.payload}} m","layout":"row-left","x":1010,"y":1140,"wires":[]},{"id":"bdcea5fd.685bd8","type":"ui_gauge","z":"eea6a755.f6fb28","name":"kW Gauge","group":"bb2dbcc9.07f63","order":6,"width":"3","height":"3","gtype":"gage","title":"","label":"kW","format":"{{msg.payload.data[0] | uppercase}}","min":"0","max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1010,"y":1200,"wires":[]},{"id":"7e8b0518.66a62c","type":"link in","z":"eea6a755.f6fb28","name":"","links":["22ff831a.97c09c"],"x":875,"y":900,"wires":[["33257799.3ef8e8"]]},{"id":"248ab9d0.7a6676","type":"link in","z":"eea6a755.f6fb28","name":"","links":["53473916.7aade8"],"x":875,"y":960,"wires":[["36dab671.ec5aba","bead3e3.06e5ec"]]},{"id":"1cc8528e.76be5d","type":"link in","z":"eea6a755.f6fb28","name":"","links":["5c0c0e5c.0d0d2"],"x":875,"y":1080,"wires":[["c9c6b162.7e0a2","48b742e1.a93eac"]]},{"id":"c82d5fe1.1723a","type":"link in","z":"eea6a755.f6fb28","name":"","links":["16dbf834.0ab598"],"x":875,"y":1200,"wires":[["bdcea5fd.685bd8"]]},{"id":"eedcac74.84ba","type":"link in","z":"41ddd688.39b148","name":"","links":["c7a90dd.e1d50f"],"x":1035,"y":260,"wires":[["dbc94141.821cf","6b22be57.0e27","59ac475d.5b9938"]]},{"id":"99bde37e.fe497","type":"link in","z":"eea6a755.f6fb28","name":"","links":["c7a90dd.e1d50f"],"x":815,"y":1020,"wires":[["36dab671.ec5aba","c9c6b162.7e0a2"]]},{"id":"f139670c.beedb8","type":"inject","z":"a37ace7a.dab1a","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":810,"y":1520,"wires":[["2123be63.a1a432"]]},{"id":"8561cfdc.459dd","type":"ui_chart","z":"a37ace7a.dab1a","name":"Return Water Temp (RWT)","group":"e932fe53.8056","order":2,"width":"0","height":"0","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"10","ymax":"30","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#2ca02c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1900,"y":1180,"wires":[[]]},{"id":"8a1431fd.0f321","type":"ui_chart","z":"a37ace7a.dab1a","name":"Supply Air Temp (SAT)","group":"23da77c.24a8d88","order":2,"width":"6","height":"6","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"10","ymax":"28","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1920,"y":1320,"wires":[[]]},{"id":"52e70cbb.d302f4","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":1680,"wires":[["8561cfdc.459dd","8a1431fd.0f321","8e804c74.30442","8ef835f1.5d3208","6791af7e.42fa2","90282acf.37d378"]]},{"id":"c2d62c34.8824","type":"link in","z":"a37ace7a.dab1a","name":"","links":["c7a90dd.e1d50f"],"x":995,"y":1040,"wires":[["8ef835f1.5d3208","8e804c74.30442","6791af7e.42fa2","90282acf.37d378"]]},{"id":"e06fcce0.dcd8b","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":9,"width":0,"height":0,"name":"","label":"Actual SetPoint","format":"{{msg.payload}}","layout":"row-spread","x":1960,"y":880,"wires":[]},{"id":"9ab13d70.76e84","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":5,"width":0,"height":0,"name":"","label":"Actual FlowLimit","format":"{{msg.payload}}","layout":"row-spread","x":1960,"y":940,"wires":[]},{"id":"ae59b5a9.609928","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":2,"width":0,"height":0,"name":"","label":"Remote Control:","format":"{{msg.payload}}","layout":"row-spread","x":1960,"y":680,"wires":[]},{"id":"2d267034.709ef","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":3,"width":0,"height":0,"name":"","label":"Start / Stop:","format":"{{msg.payload}}","layout":"row-spread","x":1950,"y":640,"wires":[]},{"id":"b6c75a6b.baf528","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":4,"width":0,"height":0,"name":"","label":"FlowLIMIT:","format":"{{msg.payload}}","layout":"row-spread","x":1950,"y":760,"wires":[]},{"id":"3a769143.f576ee","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":1,"width":0,"height":0,"name":"","label":"Control Mode","format":"{{msg.payload}}","layout":"row-spread","x":1960,"y":820,"wires":[]},{"id":"a6fce854.f3cd68","type":"link in","z":"a37ace7a.dab1a","name":"","links":["e8521bba.edeff8","a5a80b61.670c28"],"x":1615,"y":640,"wires":[["2d267034.709ef"]]},{"id":"3050675a.844fd8","type":"link in","z":"a37ace7a.dab1a","name":"","links":["e9e83e7f.4bc83","892449e3.63c0c8"],"x":1615,"y":680,"wires":[["ae59b5a9.609928"]]},{"id":"a8564ce.1044db","type":"link in","z":"a37ace7a.dab1a","name":"","links":["683bc76a.1f89a8","79600cac.5f5084"],"x":1615,"y":760,"wires":[["b6c75a6b.baf528"]]},{"id":"2014622f.167b0e","type":"link in","z":"a37ace7a.dab1a","name":"","links":["a6485d81.d9d4a","4d4d0b7a.c51f04"],"x":1615,"y":820,"wires":[["3a769143.f576ee"]]},{"id":"e2559591.a6b6c8","type":"link in","z":"a37ace7a.dab1a","name":"","links":["369cdd9f.add602","a058e9d5.7e1cb8","d1dc324f.0537"],"x":1615,"y":880,"wires":[["e06fcce0.dcd8b"]]},{"id":"f1c04c67.11f53","type":"link in","z":"a37ace7a.dab1a","name":"","links":["13396b70.3389d5","938c064a.8b0d78","80a06905.9cdd48"],"x":1615,"y":940,"wires":[["9ab13d70.76e84"]]},{"id":"aedc057a.e4cee8","type":"ui_numeric","z":"a37ace7a.dab1a","name":"","label":"Setpoint","tooltip":"","group":"3c1be052.4e291","order":8,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}} &deg C","min":"12","max":"16","step":1,"x":260,"y":2640,"wires":[["8b0687a8.aabb98","da120961.813ae8"]]},{"id":"8b0687a8.aabb98","type":"function","z":"a37ace7a.dab1a","name":"temp to setpoint","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\nvar sensor_min = global.get(\"sensor_min\")\nvar sensor_max = global.get(\"sensor_max\")\n    \nvar r_max = max\nvar r_min = min\nvar tmp = msg.payload\nsetpoint = ((tmp-r_min)/(r_max-r_min))*10000\nmsg.payload = setpoint\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":2820,"wires":[["ecd5ef92.f0259"]]},{"id":"c166b3c9.b6e0f","type":"ui_switch","z":"a37ace7a.dab1a","d":true,"name":"","label":"Pump / Valve Mode","tooltip":"","group":"3c1be052.4e291","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"valve","onvalueType":"str","onicon":"","oncolor":"","offvalue":"pump","offvalueType":"str","officon":"","offcolor":"","x":170,"y":2500,"wires":[["ecd5ef92.f0259","582dbebf.73fba","1b309e6c.3f25b2","7d341822.ed75e8","7c5741ba.da542","a15f55cf.36c818"]]},{"id":"87d1dd9b.dbc81","type":"PID","z":"a37ace7a.dab1a","name":"","setpoint":"13","pb":1,"ti":"10","td":0,"integral_default":0.5,"smooth_factor":3,"max_interval":600,"enable":1,"disabled_op":0,"x":1010,"y":2540,"wires":[["951613a7.ada7","740427d8.341ec8"]]},{"id":"951613a7.ada7","type":"function","z":"a37ace7a.dab1a","name":"Scale","func":"msg.payload = (1-msg.payload)*100\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1200,"y":2540,"wires":[["ffa989da.dcf3b8","e1bf8990.02e118"]]},{"id":"ffa989da.dcf3b8","type":"link out","z":"a37ace7a.dab1a","name":"valve opening","links":["fc8fe1e6.d3cac"],"x":1700,"y":2540,"wires":[],"l":true},{"id":"da120961.813ae8","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"setpoint","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":2560,"wires":[["87d1dd9b.dbc81"]]},{"id":"ecd5ef92.f0259","type":"traffic","z":"a37ace7a.dab1a","name":"","property_allow":"payload","filter_allow":"pump","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"valve","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":true,"differ":false,"x":1250,"y":2820,"wires":[["492954fa.13c0bc"]]},{"id":"acb83135.52e1","type":"widgetlords-vpe-3011b-sdafe","z":"a37ace7a.dab1a","name":"","channel":"6","input_type":"7","interval":"1000","x":450,"y":980,"wires":[["de4fe73c.65e318"]]},{"id":"de4fe73c.65e318","type":"function","z":"a37ace7a.dab1a","name":"scaling","func":"var DP = (msg.payload/10000)*0.6*10\nmsg.payload=parseFloat(DP).toFixed(2);\nmsg.topic = \"DP Sensor\"\nflow.set(\"DP\",DP)\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":980,"wires":[["8e804c74.30442"]]},{"id":"b4a0978c.fa50f8","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Pump Head","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":880,"wires":[["8e804c74.30442"]]},{"id":"cf44ccd.291df3","type":"change","z":"a37ace7a.dab1a","d":true,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"DP","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":2640,"wires":[["bbfe568.cb042a8"]]},{"id":"bbfe568.cb042a8","type":"PID","z":"a37ace7a.dab1a","d":true,"name":"","setpoint":"1","pb":1,"ti":"10","td":0,"integral_default":0.5,"smooth_factor":3,"max_interval":600,"enable":1,"disabled_op":0,"x":1190,"y":2640,"wires":[["2069b2e8.d7180e"]]},{"id":"582dbebf.73fba","type":"traffic","z":"a37ace7a.dab1a","d":true,"name":"","property_allow":"payload","filter_allow":"valve","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"pump","filter_stop":"stop","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":1510,"y":2640,"wires":[["492954fa.13c0bc"]]},{"id":"2069b2e8.d7180e","type":"function","z":"a37ace7a.dab1a","d":true,"name":"scale","func":"msg.payload = msg.payload*10000\nreturn msg;","outputs":1,"noerr":0,"x":1340,"y":2660,"wires":[["582dbebf.73fba"]]},{"id":"217c8eb3.5000f2","type":"link out","z":"a37ace7a.dab1a","name":"Control Mode","links":["1c3332b0.74637d"],"x":1740,"y":3040,"wires":[],"l":true},{"id":"792ca6f0.fa0798","type":"link out","z":"a37ace7a.dab1a","name":"BMS ON/OFF","links":["eb88f949.f317c8"],"x":1720,"y":3140,"wires":[],"l":true},{"id":"f727e95e.f8b268","type":"link out","z":"a37ace7a.dab1a","name":"GO/STOP","links":["e1c1e566.23bef8"],"x":1730,"y":3240,"wires":[],"l":true},{"id":"c6ea705.bef079","type":"link out","z":"a37ace7a.dab1a","name":"Set FlowLimit","links":["ee14a6b0.4cd808"],"x":1740,"y":3420,"wires":[],"l":true},{"id":"9d53dacc.987e88","type":"link out","z":"a37ace7a.dab1a","name":"Enable FlowLimit","links":["aa3ab941.3d0628"],"x":1730,"y":3340,"wires":[],"l":true},{"id":"f2bad4c7.1d0888","type":"change","z":"a37ace7a.dab1a","name":"Const. Temp","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3280,"wires":[["217c8eb3.5000f2","e0c35b1e.740258"]]},{"id":"e0c35b1e.740258","type":"change","z":"a37ace7a.dab1a","name":"BMS, GO, FlowLimit","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1140,"y":3340,"wires":[["792ca6f0.fa0798","f727e95e.f8b268","9d53dacc.987e88","cdee99bf.605028"]]},{"id":"cdee99bf.605028","type":"change","z":"a37ace7a.dab1a","name":"Define FlowLimit","rules":[{"t":"set","p":"payload","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":3400,"wires":[["c6ea705.bef079","b94bf505.58c9a8"]]},{"id":"f62c7bb6.0d32e8","type":"delay","z":"a37ace7a.dab1a","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":570,"y":2180,"wires":[["64cbfb77.838544"]]},{"id":"b94bf505.58c9a8","type":"change","z":"a37ace7a.dab1a","name":"Setpoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"1300","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":3460,"wires":[["1a433392.73ce4c","f6476056.a7edb"]]},{"id":"eb88f949.f317c8","type":"link in","z":"41ddd688.39b148","name":"to bms on/off","links":["750803c0.453eec","792ca6f0.fa0798"],"x":95,"y":320,"wires":[["a3db36a5.0ed478","9758040f.cb7458"]]},{"id":"e1c1e566.23bef8","type":"link in","z":"41ddd688.39b148","name":"to start stop","links":["f727e95e.f8b268","68e6ec1d.3e2f94"],"x":55,"y":380,"wires":[["43daf734.69feb8","fdab57f7.03a318"]]},{"id":"aa3ab941.3d0628","type":"link in","z":"41ddd688.39b148","name":"to enable flowlimit","links":["9d53dacc.987e88","de8d1237.44aac"],"x":235,"y":1120,"wires":[["b79db931.e3a078"]]},{"id":"1c3332b0.74637d","type":"link in","z":"41ddd688.39b148","name":"to control mode","links":["217c8eb3.5000f2","13bd57a6.1ac0c8"],"x":275,"y":1160,"wires":[["6446ea3c.132c04"]]},{"id":"ee14a6b0.4cd808","type":"link in","z":"41ddd688.39b148","name":"too flow limit","links":["adfa0760.7bd248","c6ea705.bef079"],"x":215,"y":1260,"wires":[["9af2180d.43b188"]]},{"id":"78854915.ccc2f8","type":"function","z":"a37ace7a.dab1a","d":true,"name":"Format Data","func":"// this is where you define the legend for \n// the datasets\n//var title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data1')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data1\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2590,"y":620,"wires":[["3088e34d.02068c"]]},{"id":"3088e34d.02068c","type":"template","z":"a37ace7a.dab1a","d":true,"name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 10,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Head [m]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":2640,"y":780,"wires":[["e9cc6543.9a09b8"]]},{"id":"e9cc6543.9a09b8","type":"ui_template","z":"a37ace7a.dab1a","group":"8911427a.03002","name":"Scatter Plot","order":1,"width":"6","height":"6","format":"this will be ignored","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":3190,"y":840,"wires":[[]]},{"id":"6791af7e.42fa2","type":"change","z":"a37ace7a.dab1a","d":true,"name":"","rules":[{"t":"delete","p":"data1","pt":"flow"},{"t":"delete","p":"count","pt":"flow"},{"t":"delete","p":"data2","pt":"flow"},{"t":"delete","p":"data3","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":740,"wires":[[]]},{"id":"a172d45e.bd3fc8","type":"ui_button","z":"a37ace7a.dab1a","name":"help","group":"3c1be052.4e291","order":1,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"mi-help_outline","payload":"","payloadType":"str","topic":"","x":190,"y":580,"wires":[["a1396f0f.e1659"]]},{"id":"a426c0c5.e78ab","type":"ui_button","z":"a37ace7a.dab1a","name":"information","group":"3c1be052.4e291","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"mi-info_outline","payload":"","payloadType":"str","topic":"","x":200,"y":640,"wires":[["fa52296b.383d28"]]},{"id":"ebed89dd.8751f8","type":"ui_toast","z":"a37ace7a.dab1a","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":true,"topic":"","name":"","x":570,"y":580,"wires":[[]]},{"id":"fa52296b.383d28","type":"template","z":"a37ace7a.dab1a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<body >\n<h1 style=\"max-width:600px\">\n    Grundfos Distributed Pumping Temperature Control Demo\n</h1>\n<p style=\"max-width:600px\">\n    The purpose of this demo is to showcase the MAGNA3 capabilities within temperature control and other features. For this purpose, simplified thermodynamic equations are implemented in the Dedicated Control Unit (DCU), to simulate the temperature response of a coil supplied by chilled water. The coil is assumed to be ideal performance, meaning that the coil characteristic follows the prescribed curve with no deviations. \n    This model does not include or simulate humidity, which while an important part of A/C control does not impact the temperature control element except as a setpoint influencer.  \n</p>\n<p style=\"max-width:600px\">\n<img src=\"/intro.png\" alt=\"intro\" style=\"width:100%;height:auto;background-color:#FFFFFF\" >\n</p>\n<p style=\"max-width:600px\">\n    The incoming air temperature is the load on the system and as it passes over the coil, it is cooled down. This demo has the possiblity to simulate a change in occupancy of the building, which will reduce the load of the system, thereby it is possible to not only see the initial temperature response but also how the demo behaves as the load on the building changes.\n</p>\n<p style=\"max-width:600px\">\n    The demo offers two different control options, a DPS coil pump mode and a PICV mode. The following sections will explain the difference between these two modes. The flow meter reading is used as an input for the Coil Power output curve for both modes.\n</p>\n\n<h2 style=\"max-width:600px\">DPS Coil Pump Mode</h2>\n<p style=\"max-width:600px\">\n    In this mode, the pump the controller is passing the simulated Supply Air Temperature (SAT) to the as an analog signal in the 0-10V range. \n</p>\n<p style=\"max-width:600px\">\n<img src=\"/dps_ahu.PNG\" alt=\"DPS AHU\" style=\"width:100%;height:auto;\" >\n</p>\n<p style=\"max-width:600px\">\n    The pump is using its’ Constant Temperature Control mode, which automatically adjusts the speed of the pump, and thereby the flow in the system, according to the load in the simulation and the setpoint defined via the Dashboard. It is possible to change the Controller parameters, Kp and Ti which are respectively the Proportional- and Integrator constants. This will affect the pumps response and serve to showcase and educate the impact of tuning the Controller in the pump\n</p>\n\n<h2 style=\"max-width:600px\">Pressure Independent Control Valve (PICV) Mode</h2>\n<p style=\"max-width:600px\">\n    In this mode, the flow is controlled via a PICV valve which lift-percentage is controlled by DCU which is using a PI-controller to maintain the SAT at the defined Setpoint.\n</p>\n<p style=\"max-width:600px\">\n<img src=\"/valve_ahu.PNG\" alt=\"Valve AHU\" style=\"width:100%;height:auto;\" >\n</p>\n<p style=\"max-width:600px\">\n   In this mode, the pump is serving as a pressure source, and operates in Constant Head Control mode. This is representative of ASHRAE’s recommendation of maintaining a constant differential pressure across the Index branch, as the pump head in this small closed-loop demo is equal to the differential pressure across the whole demo loop.<br>\n   It is possible to configure the travel speed of the PICV, but as default it is set to 24 sec/mm which is the factory default speed of this particular PICV.\n</p>\n\n</body>\n</html>\n","output":"str","x":390,"y":640,"wires":[["ebed89dd.8751f8"]]},{"id":"783f60d3.8951a","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":380,"y":2600,"wires":[]},{"id":"4453cf8d.393a6","type":"function","z":"eb529f3f.63dd2","name":"Valve Type - FC3 32802","func":"var fc=3;\nvar sa=32802;\nvar addresses=1;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":120,"wires":[["7b302ef2.96bb2","69f71969.615508"]]},{"id":"b2db991d.bb7528","type":"function","z":"4826a594.91d66c","name":"Flowmeter - FC3 0 2","func":"var fc=3;\nvar sa=0;\nvar addresses=2;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 97, 'address': sa , 'quantity': addresses };\n//msg.topic = \"Flow Meter\"\nreturn msg;\n\n","outputs":1,"noerr":0,"x":880,"y":100,"wires":[["11320fd0.63125"]]},{"id":"11320fd0.63125","type":"modbus-flex-getter","z":"4826a594.91d66c","name":"Read Valve","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"276147dc.e6e7f8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1170,"y":80,"wires":[[],["ed76089a.eb3098","c9b9992c.05bd68"]]},{"id":"b1280425.d25df8","type":"inject","z":"4826a594.91d66c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":640,"y":40,"wires":[["b2db991d.bb7528"]]},{"id":"ed76089a.eb3098","type":"debug","z":"4826a594.91d66c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1390,"y":80,"wires":[]},{"id":"c9b9992c.05bd68","type":"function","z":"4826a594.91d66c","name":"32 bit float read - flow","func":"\nvar lg = msg.payload.data.length\n\nif (lg > 1){\n\nconst buf = Buffer.from(msg.payload.buffer);\nconst value = buf.readFloatBE();\nmsg.payload = value*0.001; //m3/h\n}\nmsg.topic = \"Flow Meter\"\nreturn msg;","outputs":1,"noerr":0,"x":1400,"y":180,"wires":[["ed76089a.eb3098"]]},{"id":"bbefe13e.84d5d","type":"inject","z":"6a9884df.6ee45c","d":true,"name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":100,"wires":[["4e106079.3e327"]]},{"id":"4e106079.3e327","type":"function","z":"6a9884df.6ee45c","name":"Flowmeter - FC3 0 2","func":"var fc=3;\nvar sa=0;\nvar addresses=2;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 97, 'address': sa , 'quantity': addresses };\n//msg.topic = \"Flow Meter\"\nreturn msg;\n\n","outputs":1,"noerr":0,"x":340,"y":160,"wires":[["a894debb.2db54"]]},{"id":"a894debb.2db54","type":"modbus-flex-getter","z":"6a9884df.6ee45c","name":"Read Valve","showStatusActivities":false,"showErrors":false,"logIOActivities":false,"server":"276147dc.e6e7f8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":630,"y":140,"wires":[[],["a745f883.db2458"]]},{"id":"a745f883.db2458","type":"function","z":"6a9884df.6ee45c","name":"32 bit float read - flow","func":"\nvar lg = msg.payload.data.length\nvar flow\nif (lg > 1){\n\nconst buf = Buffer.from(msg.payload.buffer);\nconst value = buf.readFloatBE();\nflow = value*0.001; //m3/h\n}\nmsg.payload = parseFloat(flow.toFixed(1));\nmsg.topic = \"Flow Meter\"\nglobal.set(\"Flow\",flow)\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":240,"wires":[["65abf0d5.8ff66"]]},{"id":"65abf0d5.8ff66","type":"link out","z":"6a9884df.6ee45c","name":"flowmeter","links":["9553b266.7ae0b","c097fd22.94385","7759f7a8.bb0988","c22575f7.3781d8","74bd3d6d.31eb64","501c3f8a.bbd56","783b6376.99515c","a1628605.98ba88","d82611c.9a16bf"],"x":1040,"y":240,"wires":[]},{"id":"74bd3d6d.31eb64","type":"link in","z":"41ddd688.39b148","name":"","links":["65abf0d5.8ff66"],"x":915,"y":80,"wires":[["dbc94141.821cf","235c90b0.e8778","e8b2da9d.4f75f8"]]},{"id":"2fbe2c7e.221474","type":"link out","z":"eb529f3f.63dd2","name":"to flowmeter","links":["22a2e2f4.2119ee"],"x":1095,"y":2240,"wires":[],"l":true},{"id":"22a2e2f4.2119ee","type":"link in","z":"6a9884df.6ee45c","name":"","links":["2fbe2c7e.221474"],"x":100,"y":220,"wires":[["4e106079.3e327"]]},{"id":"a058e15a.e7f9c","type":"modbus-queue-info","z":"df9841f2.71dce","name":"","topic":"","unitid":"17","queueReadIntervalTime":1000,"lowLowLevel":25,"lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"276147dc.e6e7f8","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":false,"updateOnAllUnitQueues":false,"x":250,"y":2260,"wires":[[]]},{"id":"ebf056d2.2837f8","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":2140,"wires":[["2990d696.0da3ba"]]},{"id":"6ee9fc4b.13f254","type":"modbus-queue-info","z":"df9841f2.71dce","name":"","topic":"","unitid":"97","queueReadIntervalTime":1000,"lowLowLevel":25,"lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"276147dc.e6e7f8","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":false,"updateOnAllUnitQueues":false,"x":250,"y":2320,"wires":[[]]},{"id":"bc6dae73.2c1f4","type":"modbus-queue-info","z":"df9841f2.71dce","name":"","topic":"","unitid":"37","queueReadIntervalTime":1000,"lowLowLevel":25,"lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"276147dc.e6e7f8","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":false,"updateOnAllUnitQueues":false,"x":250,"y":2380,"wires":[[]]},{"id":"1a433392.73ce4c","type":"link out","z":"a37ace7a.dab1a","name":"Set SetPoint","links":["5c5cf3e0.1b94ec"],"x":1750,"y":3520,"wires":[],"l":true},{"id":"e8b2da9d.4f75f8","type":"function","z":"41ddd688.39b148","name":"Format Data","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data1')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data1\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"x":1390,"y":120,"wires":[["e3fb8422.302d48"]]},{"id":"e3fb8422.302d48","type":"template","z":"41ddd688.39b148","name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 10,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Head [m]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":1500,"y":200,"wires":[["89b6ef37.006fc"]]},{"id":"89b6ef37.006fc","type":"ui_template","z":"41ddd688.39b148","group":"38d14db9.3d4dd2","name":"Scatter Plot","order":0,"width":"6","height":"6","format":"this will be ignored","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1490,"y":260,"wires":[[]]},{"id":"59ac475d.5b9938","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"delete","p":"data1","pt":"flow"},{"t":"delete","p":"count","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":260,"wires":[[]]},{"id":"7731e54e.df188c","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1700,"y":2600,"wires":[]},{"id":"1b309e6c.3f25b2","type":"traffic","z":"a37ace7a.dab1a","name":"","property_allow":"payload","filter_allow":"valve","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"pump","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":930,"y":2400,"wires":[["87d1dd9b.dbc81"]]},{"id":"7d341822.ed75e8","type":"switch","z":"a37ace7a.dab1a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"valve","vt":"str"},{"t":"eq","v":"pump","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":430,"y":2320,"wires":[["e314c295.5aa13"],["8c8a6c4e.84398"]]},{"id":"df0a5d72.3ec5e","type":"ui_toast","z":"a37ace7a.dab1a","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":true,"topic":"","name":"","x":1010,"y":2260,"wires":[[]]},{"id":"cd217cde.71afc","type":"function","z":"eb529f3f.63dd2","name":"Flowrate - FC3 33282","func":"var fc=3;\nvar sa=33282;\nvar addresses=2;\nmsg.topic = \"SPV\"\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":760,"y":2040,"wires":[["1f5cffe1.6017d","723e5ede.d8098"]]},{"id":"8509e52e.c09158","type":"function","z":"eb529f3f.63dd2","name":"Design Flow - FC 16 32798","func":"var fc=6;\nvar sa=32789;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 37, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"x":320,"y":1680,"wires":[["9f06ecd7.5ec7a","2bb7a1b2.19c78e"]]},{"id":"d598d53b.8b3918","type":"delay","z":"eb529f3f.63dd2","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":1580,"wires":[["83f73da7.48545"]]},{"id":"83f73da7.48545","type":"change","z":"eb529f3f.63dd2","name":"100 %","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":274.5555419921875,"y":1629.77783203125,"wires":[["8509e52e.c09158"]]},{"id":"874b4ba2.c1c508","type":"link out","z":"eb529f3f.63dd2","name":"valve feedback","links":["c0c19bd5.9bed68","aa1b1be0.935928","1de5ee33.954ea2"],"x":1385,"y":240,"wires":[],"l":true},{"id":"1de5ee33.954ea2","type":"link in","z":"eea6a755.f6fb28","name":"","links":["874b4ba2.c1c508"],"x":800,"y":1300,"wires":[["378a375b.1234f8"]]},{"id":"378a375b.1234f8","type":"ui_chart","z":"eea6a755.f6fb28","name":"Valve Position","group":"bb2dbcc9.07f63","order":3,"width":0,"height":0,"label":"Valve Position","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1020,"y":1300,"wires":[[]]},{"id":"c0c19bd5.9bed68","type":"link in","z":"a37ace7a.dab1a","name":"","links":["874b4ba2.c1c508"],"x":1055,"y":1140,"wires":[["90282acf.37d378"]]},{"id":"90282acf.37d378","type":"ui_chart","z":"a37ace7a.dab1a","name":"Valve Position","group":"8443a485.7acdd8","order":1,"width":0,"height":0,"label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1440,"y":1080,"wires":[[]]},{"id":"1bc1a497.34ba0b","type":"function","z":"df9841f2.71dce","name":"Controller settings","func":"var msg1 ={'payload' : {}}\nvar msg2 ={'payload' : {}}\nvar msg3 ={'payload' : {}}\n\nmsg1.payload = msg.payload.data[0]/10\nmsg2.payload = msg.payload.data[1]/10\n\nif(msg.payload.data[2]===0){\n    msg3.payload = \"Inverse\"\n}\nelse{\n    msg3.payload = \"Direct\"\n}\nreturn [msg1,msg2,msg3];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1010,"y":1980,"wires":[["43081592.80b45c"],["38d360c0.fd28"],["a6462bbb.947fe8"]]},{"id":"43081592.80b45c","type":"link out","z":"df9841f2.71dce","name":"Kp","links":["f66db02b.e63ab","6f2eb6ff.14ca38","9abd9e1e.476e3"],"x":1270,"y":1940,"wires":[],"l":true},{"id":"38d360c0.fd28","type":"link out","z":"df9841f2.71dce","name":"Ti","links":["ada843e2.698ae","878ee3e3.176e8","6885436a.d33b6c"],"x":1270,"y":1980,"wires":[],"l":true},{"id":"a6462bbb.947fe8","type":"link out","z":"df9841f2.71dce","name":"Mode","links":["a2631ba7.5e7e58","a68f64c8.6d5208","1051e5c5.c2317a"],"x":1270,"y":2020,"wires":[],"l":true},{"id":"77c4d9d3.2bf6b8","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":6,"width":0,"height":0,"name":"","label":"Kp","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":980,"wires":[]},{"id":"d3699206.02a7d","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":7,"width":0,"height":0,"name":"","label":"Ti","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":1020,"wires":[]},{"id":"472553c7.c96f8c","type":"ui_text","z":"a37ace7a.dab1a","group":"5bc5e1ec.4bddf","order":8,"width":0,"height":0,"name":"","label":"Mode","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":1060,"wires":[]},{"id":"9abd9e1e.476e3","type":"link in","z":"a37ace7a.dab1a","name":"","links":["43081592.80b45c"],"x":1735,"y":980,"wires":[["77c4d9d3.2bf6b8"]]},{"id":"6885436a.d33b6c","type":"link in","z":"a37ace7a.dab1a","name":"","links":["38d360c0.fd28"],"x":1735,"y":1020,"wires":[["d3699206.02a7d"]]},{"id":"1051e5c5.c2317a","type":"link in","z":"a37ace7a.dab1a","name":"","links":["a6462bbb.947fe8"],"x":1735,"y":1060,"wires":[["472553c7.c96f8c"]]},{"id":"a56d37bb.cdedb8","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 100","func":"var fc=6;\nvar sa=109;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":100,"wires":[["f283b09a.14ddc"]]},{"id":"da5770de.fd98b","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 110","func":"var fc=6;\nvar sa=110;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":180,"wires":[["f283b09a.14ddc"]]},{"id":"62a6b03b.d6eb3","type":"function","z":"df9841f2.71dce","name":"Setup - FC6 111","func":"var fc=6;\nvar sa=111;\n//var slave_ip=msg.payload.slave_ip;\n//msg.slave_ip=\"192.168.1.31\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 17, 'address': sa , 'quantity': 1 };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":240,"wires":[["f283b09a.14ddc"]]},{"id":"3919db04.977524","type":"debug","z":"df9841f2.71dce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":1940,"wires":[]},{"id":"73108ba.156b974","type":"ui_numeric","z":"a37ace7a.dab1a","name":"Kp value","label":"Kp Value","tooltip":"","group":"3c1be052.4e291","order":15,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"3","step":"0.1","x":480,"y":1160,"wires":[["9bc46cf2.9a70e","5aa9e07d.9deee"]]},{"id":"e5ee0fb7.a7982","type":"ui_numeric","z":"a37ace7a.dab1a","name":"Ti value","label":"Ti Value","tooltip":"","group":"3c1be052.4e291","order":16,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"100","step":1,"x":480,"y":1240,"wires":[["9fef15c3.eaa448","ecb5e62e.5d7318"]]},{"id":"9bc46cf2.9a70e","type":"function","z":"a37ace7a.dab1a","name":"scaling","func":"msg.payload = msg.payload*10\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1120,"wires":[["29760a5b.916ca6"]]},{"id":"9fef15c3.eaa448","type":"function","z":"a37ace7a.dab1a","name":"scaling","func":"msg.payload = msg.payload*10\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":1200,"wires":[["f3718a8b.de2b18"]]},{"id":"29760a5b.916ca6","type":"link out","z":"a37ace7a.dab1a","name":"Kp Set","links":["cb085822.546338"],"x":845,"y":1120,"wires":[]},{"id":"f3718a8b.de2b18","type":"link out","z":"a37ace7a.dab1a","name":"Ti Set","links":["d8fbd7c1.2b36e8"],"x":825,"y":1200,"wires":[]},{"id":"cb085822.546338","type":"link in","z":"df9841f2.71dce","name":"","links":["29760a5b.916ca6","a99be986.78ded8"],"x":1315,"y":100,"wires":[["a56d37bb.cdedb8"]]},{"id":"d8fbd7c1.2b36e8","type":"link in","z":"df9841f2.71dce","name":"","links":["f3718a8b.de2b18","c5519854.d02f98"],"x":1315,"y":180,"wires":[["da5770de.fd98b"]]},{"id":"b01f5b48.299b78","type":"link out","z":"a37ace7a.dab1a","name":"Controller Mode","links":["3a6424d0.8181ac"],"x":1740,"y":2840,"wires":[],"l":true},{"id":"a6f4219c.7a3e6","type":"change","z":"a37ace7a.dab1a","name":"Inverse Controller","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":3220,"wires":[["b01f5b48.299b78","f2bad4c7.1d0888","a87ee11b.7d982"]]},{"id":"24b39065.8d103","type":"change","z":"a37ace7a.dab1a","name":"Direct Controller","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":2880,"wires":[["f6548ee8.30a7e","b01f5b48.299b78","a87ee11b.7d982"]]},{"id":"f6548ee8.30a7e","type":"change","z":"a37ace7a.dab1a","name":"Constant Head","rules":[{"t":"set","p":"payload","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":2920,"wires":[["66914969.85ec08","217c8eb3.5000f2"]]},{"id":"66914969.85ec08","type":"change","z":"a37ace7a.dab1a","name":"BMS ON and GO","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":2960,"wires":[["792ca6f0.fa0798","f727e95e.f8b268","9b186076.b6aad"]]},{"id":"c6a198ad.018d08","type":"change","z":"a37ace7a.dab1a","name":"Setpoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"8000","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":3040,"wires":[["1a433392.73ce4c"]]},{"id":"9b186076.b6aad","type":"change","z":"a37ace7a.dab1a","name":"Disable FlowLimit","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3000,"wires":[["c6a198ad.018d08","9d53dacc.987e88"]]},{"id":"3a6424d0.8181ac","type":"link in","z":"df9841f2.71dce","name":"","links":["f5068c8.250e17","7d630945.6dc628","b01f5b48.299b78"],"x":1285,"y":240,"wires":[["62a6b03b.d6eb3"]]},{"id":"7c5741ba.da542","type":"traffic","z":"a37ace7a.dab1a","name":"","property_allow":"payload","filter_allow":"pump","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"valve","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":true,"differ":false,"x":850,"y":3100,"wires":[["a6f4219c.7a3e6"]]},{"id":"a15f55cf.36c818","type":"traffic","z":"a37ace7a.dab1a","name":"","property_allow":"payload","filter_allow":"valve","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"pump","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":850,"y":2900,"wires":[["24b39065.8d103"]]},{"id":"f6476056.a7edb","type":"function","z":"a37ace7a.dab1a","name":"","func":"msg.payload = msg.payload/100\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":3060,"wires":[["aedc057a.e4cee8"]]},{"id":"e47ab166.e0e3e","type":"link in","z":"a37ace7a.dab1a","name":"","links":["3753d190.8334be","7369d0b5.faf2a"],"x":185,"y":1140,"wires":[["73108ba.156b974","34c353d.543e8ac","7f85e173.483b2"]]},{"id":"1a0f3e11.4bbcc2","type":"link in","z":"a37ace7a.dab1a","name":"","links":["5d2bf0b5.ab2ac","b58fb21e.b37b9"],"x":195,"y":1200,"wires":[["e5ee0fb7.a7982","51826d40.59fc14"]]},{"id":"c519cc77.135ea","type":"ui_switch","z":"41ddd688.39b148","name":"","label":"Controller: Direct/Inverse","tooltip":"","group":"ab3a9e02.8ace9","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":490,"y":180,"wires":[["7d630945.6dc628"]]},{"id":"7d630945.6dc628","type":"link out","z":"41ddd688.39b148","name":"Controller Mode","links":["3a6424d0.8181ac"],"x":720,"y":180,"wires":[],"l":true},{"id":"f2ea5495.2eb0a8","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":8,"width":0,"height":0,"name":"","label":"Kp","format":"{{msg.payload}}","layout":"row-spread","x":2030,"y":720,"wires":[]},{"id":"632f83d9.ea045c","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":9,"width":0,"height":0,"name":"","label":"Ti","format":"{{msg.payload}}","layout":"row-spread","x":2030,"y":760,"wires":[]},{"id":"80ac1623.526708","type":"ui_text","z":"41ddd688.39b148","group":"2635b728.9e6d88","order":4,"width":0,"height":0,"name":"","label":"Mode","format":"{{msg.payload}}","layout":"row-spread","x":2030,"y":800,"wires":[]},{"id":"f66db02b.e63ab","type":"link in","z":"41ddd688.39b148","name":"","links":["43081592.80b45c"],"x":1775,"y":720,"wires":[["f2ea5495.2eb0a8"]]},{"id":"878ee3e3.176e8","type":"link in","z":"41ddd688.39b148","name":"","links":["38d360c0.fd28"],"x":1775,"y":760,"wires":[["632f83d9.ea045c"]]},{"id":"a2631ba7.5e7e58","type":"link in","z":"41ddd688.39b148","name":"","links":["a6462bbb.947fe8"],"x":1775,"y":800,"wires":[["80ac1623.526708"]]},{"id":"a87ee11b.7d982","type":"link out","z":"a37ace7a.dab1a","name":"controller mode ui","links":["507c3eb5.73061"],"x":1730,"y":2940,"wires":[],"l":true},{"id":"507c3eb5.73061","type":"link in","z":"41ddd688.39b148","name":"","links":["5e5e4656.3d5298","a87ee11b.7d982"],"x":195,"y":60,"wires":[["c519cc77.135ea"]]},{"id":"cd1b806a.652c2","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":180,"wires":[["c519cc77.135ea"]]},{"id":"34c353d.543e8ac","type":"delay","z":"a37ace7a.dab1a","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":1120,"wires":[["9bc46cf2.9a70e"]]},{"id":"51826d40.59fc14","type":"delay","z":"a37ace7a.dab1a","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":1200,"wires":[["9fef15c3.eaa448"]]},{"id":"3d8a5adf.4accf6","type":"ui_ui_control","z":"a37ace7a.dab1a","name":"","events":"all","x":1460,"y":300,"wires":[["3f75bbf3.c834c4"]]},{"id":"3f75bbf3.c834c4","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1650,"y":300,"wires":[]},{"id":"3274bba4.c98ed4","type":"ui_button","z":"a37ace7a.dab1a","name":"Pump mode","group":"3c1be052.4e291","order":5,"width":"3","height":"1","passthru":false,"label":"Pump","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"{\"group\":{\"hide\":[\"Simulations_Valve_Position\"]}}","payloadType":"json","topic":"","x":490,"y":300,"wires":[["3d8a5adf.4accf6","88360eed.998df","840d6be4.0f6f38","6414ff69.1b9c2","e00c501f.7dbe7"]]},{"id":"354721d.a7950de","type":"ui_button","z":"a37ace7a.dab1a","name":"Valve Mode","group":"3c1be052.4e291","order":6,"width":"3","height":"1","passthru":false,"label":"PICV","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Valve_Position\"],\"hide\":[\"Simulations_Control_Simulation_Kp_Value\",\"Simulations_Control_Simulation_Ti_Value\"]}}","payloadType":"json","topic":"","x":510,"y":420,"wires":[["3d8a5adf.4accf6","aff238d3.006b98","42a71e9d.f6543","df22498a.007628","e27de0a8.e0fdb"]]},{"id":"fdf2e199.a66e8","type":"ui_button","z":"a37ace7a.dab1a","name":"start sim","group":"3c1be052.4e291","order":18,"width":0,"height":0,"passthru":false,"label":"Start","tooltip":"","color":"","bgcolor":"","icon":"","payload":"start","payloadType":"str","topic":"","x":220,"y":2180,"wires":[["f62c7bb6.0d32e8","a15f55cf.36c818","7c5741ba.da542"]]},{"id":"88360eed.998df","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":340,"wires":[["354721d.a7950de"]]},{"id":"840d6be4.0f6f38","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":240,"wires":[["3274bba4.c98ed4"]]},{"id":"42a71e9d.f6543","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":380,"wires":[["3274bba4.c98ed4"]]},{"id":"aff238d3.006b98","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":500,"wires":[["354721d.a7950de"]]},{"id":"7fd97725.987658","type":"link out","z":"a37ace7a.dab1a","name":"Pump/Valve","links":["71e0e596.3a3ccc"],"x":975,"y":420,"wires":[]},{"id":"6414ff69.1b9c2","type":"change","z":"a37ace7a.dab1a","name":"pump","rules":[{"t":"set","p":"payload","pt":"msg","to":"pump","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":400,"wires":[["7fd97725.987658"]]},{"id":"df22498a.007628","type":"change","z":"a37ace7a.dab1a","name":"valve","rules":[{"t":"set","p":"payload","pt":"msg","to":"valve","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":440,"wires":[["7fd97725.987658"]]},{"id":"71e0e596.3a3ccc","type":"link in","z":"a37ace7a.dab1a","name":"Pump/Valve","links":["7fd97725.987658"],"x":215,"y":2400,"wires":[["7d341822.ed75e8","1b309e6c.3f25b2","ecd5ef92.f0259","a15f55cf.36c818","7c5741ba.da542"]]},{"id":"1805fd6e.760613","type":"ui_button","z":"a37ace7a.dab1a","name":"","group":"3c1be052.4e291","order":19,"width":0,"height":0,"passthru":true,"label":"Pump Status","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":1150,"y":500,"wires":[["45eed858.d1f9c8"]]},{"id":"45eed858.d1f9c8","type":"function","z":"a37ace7a.dab1a","name":"","func":"var bookkeeper = flow.get(\"bookkeeper\") \nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_Pump_Status\"]}}\n    flow.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_Pump_Status\"]}}\n    flow.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":500,"wires":[["3d8a5adf.4accf6","300396dc.a1367a"]]},{"id":"300396dc.a1367a","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1570,"y":480,"wires":[]},{"id":"a46531a3.6c268","type":"inject","z":"a37ace7a.dab1a","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":260,"wires":[["2a44b2e.82a844e","840d6be4.0f6f38","88360eed.998df","691b1e1f.e26b8","cd2032f8.66e04","6b7bc99f.15f2d8","bc68a75.60c5658"]]},{"id":"2a44b2e.82a844e","type":"change","z":"a37ace7a.dab1a","name":"pump","rules":[{"t":"set","p":"bookkeeper","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":500,"wires":[["1805fd6e.760613"]]},{"id":"fceaf8b4.5ab7b8","type":"ui_button","z":"41ddd688.39b148","name":"","group":"806379db.c33df8","order":11,"width":0,"height":0,"passthru":true,"label":"Pump Status","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":670,"y":1720,"wires":[["8ee4c4e1.c52bf8"]]},{"id":"8ee4c4e1.c52bf8","type":"function","z":"41ddd688.39b148","name":"","func":"var bookkeeper = flow.get(\"bookkeeper\") \nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"MAGNA3_Dashboard_Status\"]}}\n    flow.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"MAGNA3_Dashboard_Status\"]}}\n    flow.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":1720,"wires":[["ffb6e60a.f9ef28"]]},{"id":"2ed2d8ba.8ae8b8","type":"inject","z":"41ddd688.39b148","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":1720,"wires":[["d41890e8.89a0b","17a05bb2.d590e4"]]},{"id":"d41890e8.89a0b","type":"change","z":"41ddd688.39b148","name":"bookkeeper","rules":[{"t":"set","p":"bookkeeper","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":1720,"wires":[["fceaf8b4.5ab7b8"]]},{"id":"ffb6e60a.f9ef28","type":"ui_ui_control","z":"41ddd688.39b148","name":"","events":"all","x":1020,"y":1720,"wires":[[]]},{"id":"54a872fe.b77b6c","type":"ui_button","z":"41ddd688.39b148","name":"","group":"806379db.c33df8","order":12,"width":0,"height":0,"passthru":true,"label":"Pump Info","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":660,"y":1780,"wires":[["9bfed662.242f38"]]},{"id":"9bfed662.242f38","type":"function","z":"41ddd688.39b148","name":"","func":"var bookkeeper = flow.get(\"bookkeeper2\") \nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"MAGNA3_Dashboard_Info\"]}}\n    flow.set(\"bookkeeper2\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"MAGNA3_Dashboard_Info\"]}}\n    flow.set(\"bookkeeper2\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":1780,"wires":[["ffb6e60a.f9ef28"]]},{"id":"17a05bb2.d590e4","type":"change","z":"41ddd688.39b148","name":"bookkeeper","rules":[{"t":"set","p":"bookkeeper2","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":1780,"wires":[["54a872fe.b77b6c"]]},{"id":"486ef189.1805f","type":"ui_button","z":"41ddd688.39b148","name":"BMS","group":"806379db.c33df8","order":2,"width":"3","height":"1","passthru":false,"label":"BMS","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"1","payloadType":"num","topic":"","x":490,"y":560,"wires":[["a3db36a5.0ed478","f68235ee.fc9fb8","b2210fa3.ebf2"]]},{"id":"531e8a1a.4d0114","type":"ui_button","z":"41ddd688.39b148","name":"Local","group":"806379db.c33df8","order":1,"width":"3","height":"1","passthru":false,"label":"Local","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"0","payloadType":"num","topic":"","x":510,"y":640,"wires":[["a3db36a5.0ed478","8be589ce.1ca4b8","9bb3cfbe.85fb6"]]},{"id":"d0349d96.b9a2b","type":"ui_button","z":"41ddd688.39b148","name":"Stop Pump","group":"806379db.c33df8","order":5,"width":"3","height":"1","passthru":false,"label":"Stop","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"0","payloadType":"num","topic":"","x":530,"y":940,"wires":[["43daf734.69feb8","6bd3ac8b.80aef4","9173f7f6.e3f388","c5645ce2.a48ec"]]},{"id":"b3daaa62.2e1de8","type":"ui_button","z":"41ddd688.39b148","name":"Start Pump","group":"806379db.c33df8","order":6,"width":"3","height":"1","passthru":false,"label":"Start","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"1","payloadType":"num","topic":"","x":530,"y":840,"wires":[["43daf734.69feb8","a540736a.8739b","19add9f.112f726","4b8bab3e.703384"]]},{"id":"b2210fa3.ebf2","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":560,"wires":[["531e8a1a.4d0114"]]},{"id":"f68235ee.fc9fb8","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":480,"wires":[["486ef189.1805f"]]},{"id":"9bb3cfbe.85fb6","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":640,"wires":[["486ef189.1805f"]]},{"id":"8be589ce.1ca4b8","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":700,"wires":[["531e8a1a.4d0114"]]},{"id":"a540736a.8739b","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":780,"wires":[["b3daaa62.2e1de8"]]},{"id":"6bd3ac8b.80aef4","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1000,"wires":[["d0349d96.b9a2b"]]},{"id":"19add9f.112f726","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":860,"wires":[["d0349d96.b9a2b"]]},{"id":"9173f7f6.e3f388","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":940,"wires":[["b3daaa62.2e1de8"]]},{"id":"9758040f.cb7458","type":"switch","z":"41ddd688.39b148","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":190,"y":440,"wires":[["f68235ee.fc9fb8","b2210fa3.ebf2"],["8be589ce.1ca4b8","9bb3cfbe.85fb6"]]},{"id":"fdab57f7.03a318","type":"switch","z":"41ddd688.39b148","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":190,"y":780,"wires":[["a540736a.8739b","19add9f.112f726","4b8bab3e.703384"],["6bd3ac8b.80aef4","9173f7f6.e3f388","c5645ce2.a48ec"]]},{"id":"197762e7.ee914d","type":"inject","z":"a37ace7a.dab1a","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"1","payloadType":"num","x":170,"y":1000,"wires":[["73108ba.156b974"]]},{"id":"cbb6565f.086be8","type":"inject","z":"a37ace7a.dab1a","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"8","payloadType":"num","x":170,"y":1060,"wires":[["e5ee0fb7.a7982"]]},{"id":"8e8278b8.f7c828","type":"ui_text_input","z":"9a5395ce.c2f6e8","name":"Error Code input","label":"Error Code","tooltip":"","group":"26881754.b529d8","order":2,"width":0,"height":0,"passthru":true,"mode":"number","delay":300,"topic":"","x":250,"y":80,"wires":[["c8517e28.6fca4"]]},{"id":"250020c1.43591","type":"template","z":"a37ace7a.dab1a","name":"pump mode","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<p style=\"max-width:500px\">\n<img src=\"/pump.jpg\" alt=\"intro\" style=\"width:100%;height:auto;\">\n</p>","output":"str","x":770,"y":2340,"wires":[["df0a5d72.3ec5e"]]},{"id":"8c8a6c4e.84398","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Change to Pump Mode","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2340,"wires":[["250020c1.43591"]]},{"id":"e314c295.5aa13","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Change to PICV Mode","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2280,"wires":[["c5ecf155.1ee4"]]},{"id":"c5ecf155.1ee4","type":"template","z":"a37ace7a.dab1a","name":"valvemode","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<p style=\"max-width:500px\">\n<img src=\"/valve.jpg\" alt=\"intro\" style=\"width:100%;height:auto;\">\n</p>","output":"str","x":770,"y":2280,"wires":[["df0a5d72.3ec5e"]]},{"id":"a1396f0f.e1659","type":"template","z":"a37ace7a.dab1a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<body style=\"background-color:blue\">\n<h1 style=\"max-width:600px\">\n    How to use this dashboard\n</h1>\n<p style=\"max-width:600px\">\n<img src=\"/help_simulation.png\" alt=\"intro\" style=\"width:100%;height:auto;\" >\n</p>\n\n<p style=\"max-width:600px\">\n  <ol style=\"max-width:600px\">\n      <li>Select either the Pump or PICV mode</li>\n      <li>The settings in this menu can be changed either before the demo is started or on the fly, and the response of the demo is seen immidiately</li>\n      <li>When ready, press start and the simulation will begin and you can follow the progress on the different plots</li>\n      <li>If you which to stop or restart the simulation, press the Reset</li>\n      <li>You can toggle the view of the Pump Status, Flow-, Pressure and Return Water Temp chart to simplify the dashboard</li>\n      <li>It is possible to toggle between either the Duty Point- or the Flow Power chart and the data is consistent untill cleared</li>\n  </ol> \n</p>\n\n\n</body>\n</html>\n","output":"str","x":360,"y":580,"wires":[["ebed89dd.8751f8"]]},{"id":"5aa9e07d.9deee","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"Kp","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1160,"wires":[[]]},{"id":"ecb5e62e.5d7318","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"Ti","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":1240,"wires":[[]]},{"id":"e27de0a8.e0fdb","type":"change","z":"a37ace7a.dab1a","name":"Kp","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":320,"wires":[["ddf2207.20688e","7369d0b5.faf2a"]]},{"id":"ddf2207.20688e","type":"change","z":"a37ace7a.dab1a","name":"Ti","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":360,"wires":[["b58fb21e.b37b9"]]},{"id":"e00c501f.7dbe7","type":"change","z":"a37ace7a.dab1a","name":"Kp","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"Kp","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":240,"wires":[["c9d2ba48.39aa48","7369d0b5.faf2a"]]},{"id":"c9d2ba48.39aa48","type":"change","z":"a37ace7a.dab1a","name":"Ti","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"Ti","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":280,"wires":[["b58fb21e.b37b9"]]},{"id":"7369d0b5.faf2a","type":"link out","z":"a37ace7a.dab1a","name":"Kp enable/disable","links":["e47ab166.e0e3e"],"x":1220,"y":240,"wires":[],"l":true},{"id":"b58fb21e.b37b9","type":"link out","z":"a37ace7a.dab1a","name":"Ti enable/disable","links":["1a0f3e11.4bbcc2"],"x":1210,"y":280,"wires":[],"l":true},{"id":"7f85e173.483b2","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":560,"y":1080,"wires":[]},{"id":"be6e32e9.099b","type":"ui_numeric","z":"a37ace7a.dab1a","name":"Occupancy numeric","label":"Occupancy","tooltip":"","group":"3c1be052.4e291","order":11,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}} %","min":0,"max":"100","step":"5","x":840,"y":1440,"wires":[["34da4e0c.52f2f2","a98c37a6.158f68","c86030bb.0d66b"]]},{"id":"4a62c117.c881e","type":"ui_numeric","z":"eea6a755.f6fb28","name":"P value","label":"P Value","tooltip":"","group":"8dd78c30.ffe35","order":5,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":"-10","max":"20","step":"0.5","x":420,"y":320,"wires":[["852137b7.8e6728"]]},{"id":"14ca1dc2.785e32","type":"ui_numeric","z":"eea6a755.f6fb28","name":"I Value","label":"I Value","tooltip":"","group":"8dd78c30.ffe35","order":6,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"100","step":1,"x":410,"y":380,"wires":[["abdadda9.5b77d"]]},{"id":"852137b7.8e6728","type":"change","z":"eea6a755.f6fb28","name":"P part","rules":[{"t":"move","p":"payload","pt":"msg","to":"prop_band","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":320,"wires":[["fa787cd7.2bc46"]]},{"id":"fa787cd7.2bc46","type":"link out","z":"eea6a755.f6fb28","name":"valve_PID","links":["4c2c9ea7.2b377","acf41e52.0f6f"],"x":1020,"y":320,"wires":[],"l":true},{"id":"abdadda9.5b77d","type":"change","z":"eea6a755.f6fb28","name":"I part","rules":[{"t":"move","p":"payload","pt":"msg","to":"t_integral","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":380,"wires":[["fa787cd7.2bc46"]]},{"id":"6cb3847a.b5686c","type":"inject","z":"eea6a755.f6fb28","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"1","payloadType":"num","x":130,"y":320,"wires":[["4a62c117.c881e"]]},{"id":"7e407172.d455a","type":"inject","z":"eea6a755.f6fb28","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"10","payloadType":"num","x":130,"y":380,"wires":[["14ca1dc2.785e32"]]},{"id":"4c2c9ea7.2b377","type":"link in","z":"a37ace7a.dab1a","name":"","links":["fa787cd7.2bc46"],"x":765,"y":2500,"wires":[["87d1dd9b.dbc81"]]},{"id":"d92607da.b59ed8","type":"link in","z":"a37ace7a.dab1a","name":"","links":["53473916.7aade8"],"x":1075,"y":720,"wires":[["8ef835f1.5d3208"]]},{"id":"c86030bb.0d66b","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"occupancy","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":1540,"wires":[[]]},{"id":"48e304b4.01937c","type":"ui_button","z":"a37ace7a.dab1a","name":"flow hide","group":"3c1be052.4e291","order":20,"width":"2","height":"1","passthru":false,"label":"Flow","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":500,"y":60,"wires":[["691b1e1f.e26b8"]]},{"id":"be9f9a7c.7b3ca8","type":"ui_button","z":"a37ace7a.dab1a","name":"Pressure hide","group":"3c1be052.4e291","order":21,"width":"2","height":"1","passthru":false,"label":"Press","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":520,"y":120,"wires":[["cd2032f8.66e04"]]},{"id":"d821745c.e30188","type":"ui_button","z":"a37ace7a.dab1a","name":"RWT hide","group":"3c1be052.4e291","order":22,"width":"2","height":"1","passthru":false,"label":"RWT","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":500,"y":180,"wires":[["6b7bc99f.15f2d8"]]},{"id":"691b1e1f.e26b8","type":"function","z":"a37ace7a.dab1a","name":"","func":"\nvar bookkeeper = context.get('bookkeeper')\nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_Flow\"]}}\n    context.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_Flow\"]}}\n    context.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"bookkeeper\", false)","finalize":"","libs":[],"x":760,"y":60,"wires":[["3d8a5adf.4accf6","2500eadb.dd1e86"]]},{"id":"cd2032f8.66e04","type":"function","z":"a37ace7a.dab1a","name":"","func":"\nvar bookkeeper = context.get('bookkeeper')\nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_Pressure\"]}}\n    context.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_Pressure\"]}}\n    context.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"bookkeeper\", false)","finalize":"","libs":[],"x":760,"y":120,"wires":[["3d8a5adf.4accf6","82f5cf8a.03d7c"]]},{"id":"6b7bc99f.15f2d8","type":"function","z":"a37ace7a.dab1a","name":"","func":"\nvar bookkeeper = context.get('bookkeeper')\nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_RWT\"]}}\n    context.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_RWT\"]}}\n    context.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"bookkeeper\", false)","finalize":"","libs":[],"x":760,"y":180,"wires":[["3d8a5adf.4accf6","b204c42c.316078"]]},{"id":"9553b266.7ae0b","type":"link in","z":"a37ace7a.dab1a","name":"","links":["65abf0d5.8ff66"],"x":2295,"y":620,"wires":[["78854915.ccc2f8","f4d87094.d6e3e"]]},{"id":"3403ad95.234f02","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"move","p":"payload.data[0]","pt":"msg","to":"actual_c_mode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":2200,"wires":[[]]},{"id":"8abe5c58.5167a","type":"switch","z":"a37ace7a.dab1a","name":"Flow Head","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"6","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":2730,"y":500,"wires":[["801f26a1.b716e8"],["4db69779.6dc7e8"],["71f47649.472ab8"]]},{"id":"f4d87094.d6e3e","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"actual_c_mode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":2470,"y":540,"wires":[["8abe5c58.5167a","1f704101.5e0f5f"]]},{"id":"a170a3be.8bf04","type":"function","z":"a37ace7a.dab1a","name":"prepare all data","func":"var legend1 = \"DPS\";\nvar legend2 = \"Constant Head\";\nvar legend3 = \"Prop. Press.\";\nvar title = \"Pump Duty Point\"\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nvar data1 = flow.get('data1')||'';\n\nvar data2 = flow.get('data2')||'';\n\nvar data3 = flow.get('data3')||'';\n\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"legend2\" : legend2,\n                \"data2\"   : data2,\n                \"legend3\" : legend3,\n                \"data3\"   : data3\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3010,"y":680,"wires":[["d2f8263e.d0ea18"]]},{"id":"71f47649.472ab8","type":"function","z":"a37ace7a.dab1a","name":"Format Data - DPS","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data1')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data1\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2930,"y":560,"wires":[["a170a3be.8bf04"]]},{"id":"801f26a1.b716e8","type":"function","z":"a37ace7a.dab1a","name":"Format Data - Constant","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data2')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data2\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2950,"y":460,"wires":[["a170a3be.8bf04"]]},{"id":"4db69779.6dc7e8","type":"function","z":"a37ace7a.dab1a","name":"Format Data - prop","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data3')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data3\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2930,"y":500,"wires":[["a170a3be.8bf04","b716ef8e.2b413"]]},{"id":"d2f8263e.d0ea18","type":"template","z":"a37ace7a.dab1a","name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend2}}}\",\n          backgroundColor: \"rgba(137, 0, 39, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data2}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend3}}}\",\n          backgroundColor: \"rgba(244, 149, 0, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data3}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 9,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Head [m]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":3020,"y":760,"wires":[["e9cc6543.9a09b8"]]},{"id":"1f704101.5e0f5f","type":"switch","z":"a37ace7a.dab1a","name":"Flow Power","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"6","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":2750,"y":960,"wires":[["eb2d3bcd.7c6da8"],["2b090e69.cedaf2"],["f458c825.e92b88"]]},{"id":"f9c63868.a2ace8","type":"function","z":"a37ace7a.dab1a","name":"prepare all data","func":"var legend1 = \"DPS\";\nvar legend2 = \"Constant Head\";\nvar legend3 = \"Prop. Press.\";\nvar title = \"Power / Flow\"\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nvar data1 = flow.get('data4')||'';\n\nvar data2 = flow.get('data5')||'';\n\nvar data3 = flow.get('data6')||'';\n\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"legend2\" : legend2,\n                \"data2\"   : data2,\n                \"legend3\" : legend3,\n                \"data3\"   : data3\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3030,"y":1140,"wires":[["efd2245f.fd1198"]]},{"id":"f458c825.e92b88","type":"function","z":"a37ace7a.dab1a","name":"Format Data - DPS","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data4')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('W')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data4\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2950,"y":1020,"wires":[["f9c63868.a2ace8"]]},{"id":"eb2d3bcd.7c6da8","type":"function","z":"a37ace7a.dab1a","name":"Format Data - Constant","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data5')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('W')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data5\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2970,"y":920,"wires":[["f9c63868.a2ace8"]]},{"id":"2b090e69.cedaf2","type":"function","z":"a37ace7a.dab1a","name":"Format Data - prop","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data6')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('W')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data6\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2950,"y":960,"wires":[["f9c63868.a2ace8","e568eeca.630c2"]]},{"id":"efd2245f.fd1198","type":"template","z":"a37ace7a.dab1a","name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend2}}}\",\n          backgroundColor: \"rgba(137, 0, 39, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data2}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend3}}}\",\n          backgroundColor: \"rgba(244, 149, 0, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data3}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 200,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Power [W]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":3040,"y":1220,"wires":[["27fa3141.b508ee"]]},{"id":"6846d759.d2f798","type":"change","z":"df9841f2.71dce","d":true,"name":"Global W","rules":[{"t":"move","p":"payload.data[0]","pt":"msg","to":"W","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1320,"y":2940,"wires":[[]]},{"id":"27fa3141.b508ee","type":"ui_template","z":"a37ace7a.dab1a","group":"c08fc457.414228","name":"Scatter Plot","order":1,"width":"6","height":"6","format":"this will be ignored","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":3210,"y":1280,"wires":[[]]},{"id":"24992ad7.273d06","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"delete","p":"data1","pt":"flow"},{"t":"delete","p":"count","pt":"flow"},{"t":"delete","p":"data2","pt":"flow"},{"t":"delete","p":"data3","pt":"flow"},{"t":"delete","p":"data4","pt":"flow"},{"t":"delete","p":"data5","pt":"flow"},{"t":"delete","p":"data6","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":3600,"y":940,"wires":[[]]},{"id":"39901e76.ac7892","type":"ui_button","z":"a37ace7a.dab1a","name":"Flow Power Switch","group":"8911427a.03002","order":3,"width":"3","height":"1","passthru":true,"label":"Flow / Power","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"{\"group\":{\"hide\":[\"Simulations_Pump_Duty_Point\"],\"show\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3370,"y":1060,"wires":[["20dbbafa.955106"]]},{"id":"65909cf1.cdbd14","type":"ui_button","z":"a37ace7a.dab1a","name":"Duty Point Switch","group":"c08fc457.414228","order":3,"width":"3","height":"1","passthru":true,"label":"Duty Point","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Pump_Duty_Point\"],\"hide\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3370,"y":980,"wires":[["20dbbafa.955106"]]},{"id":"20dbbafa.955106","type":"link out","z":"a37ace7a.dab1a","name":"To UI Control","links":["40686a0b.0674e4"],"x":3580,"y":1020,"wires":[],"l":true},{"id":"40686a0b.0674e4","type":"link in","z":"a37ace7a.dab1a","name":"","links":["20dbbafa.955106"],"x":1225,"y":160,"wires":[["3d8a5adf.4accf6"]]},{"id":"bbdf3bb7.1dd6d8","type":"ui_button","z":"a37ace7a.dab1a","name":"Duty Clear","group":"8911427a.03002","order":2,"width":"3","height":"1","passthru":false,"label":"Clear Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Pump_Duty_Point\"],\"hide\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3250,"y":900,"wires":[["24992ad7.273d06"]]},{"id":"8a2fece3.a7516","type":"ui_button","z":"a37ace7a.dab1a","name":"Power Clear","group":"c08fc457.414228","order":2,"width":"3","height":"1","passthru":false,"label":"Clear Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Pump_Duty_Point\"],\"hide\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3250,"y":940,"wires":[["24992ad7.273d06"]]},{"id":"bc68a75.60c5658","type":"link out","z":"a37ace7a.dab1a","name":"start up","links":["9910ea32.5a87b8","8d6abe2e.bcc22"],"x":225,"y":160,"wires":[]},{"id":"9910ea32.5a87b8","type":"link in","z":"a37ace7a.dab1a","name":"","links":["bc68a75.60c5658"],"x":3145,"y":1020,"wires":[["65909cf1.cdbd14"]]},{"id":"79893fd7.44a47","type":"ui_numeric","z":"a37ace7a.dab1a","name":"SAT Start Temp","label":"SAT Start","tooltip":"","group":"3c1be052.4e291","order":7,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}} &deg C","min":"13","max":"28","step":1,"x":560,"y":1600,"wires":[["3ff635bf.9f29da"]]},{"id":"3ff635bf.9f29da","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"Ta_s","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"Ta_s_setting","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":1600,"wires":[[]]},{"id":"da3abf38.b0f2","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"22","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":1600,"wires":[["79893fd7.44a47"]]},{"id":"dc16bc73.d8718","type":"link in","z":"eb529f3f.63dd2","name":"","links":["49b85d73.09e884"],"x":75,"y":120,"wires":[["4453cf8d.393a6","ff5c1165.9fcd9"]]},{"id":"91851f2f.c0b96","type":"ui_toast","z":"eb529f3f.63dd2","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":550,"y":60,"wires":[]},{"id":"ff5c1165.9fcd9","type":"change","z":"eb529f3f.63dd2","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Initiated","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Valve Configuration","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":60,"wires":[["91851f2f.c0b96"]]},{"id":"c4976c6.145639","type":"ui_toast","z":"eb529f3f.63dd2","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":970,"y":1640,"wires":[]},{"id":"2bb7a1b2.19c78e","type":"change","z":"eb529f3f.63dd2","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Completed","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Valve Configuration","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1640,"wires":[["c4976c6.145639"]]},{"id":"6336608a.2e11b","type":"function","z":"df9841f2.71dce","name":"","func":"var W = msg.payload.data[0]\n\nglobal.set('W',W)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1330,"y":2900,"wires":[[]]},{"id":"2500eadb.dd1e86","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":40,"wires":[["71e5a282.b77d3c"]]},{"id":"82f5cf8a.03d7c","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":80,"wires":[["4d0a18f.5e7cee8"]]},{"id":"b204c42c.316078","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":120,"wires":[["85f01fe2.045cc"]]},{"id":"71e5a282.b77d3c","type":"link out","z":"a37ace7a.dab1a","name":"to flow","links":["375a7bc5.bd5d04"],"x":1535,"y":40,"wires":[]},{"id":"4d0a18f.5e7cee8","type":"link out","z":"a37ace7a.dab1a","name":"to press","links":["46bd80a2.59ff6"],"x":1535,"y":80,"wires":[]},{"id":"85f01fe2.045cc","type":"link out","z":"a37ace7a.dab1a","name":"to rwt","links":["939dca25.e6cc28"],"x":1535,"y":120,"wires":[]},{"id":"939dca25.e6cc28","type":"link in","z":"a37ace7a.dab1a","name":"","links":["85f01fe2.045cc"],"x":1615,"y":1180,"wires":[["8561cfdc.459dd"]]},{"id":"46bd80a2.59ff6","type":"link in","z":"a37ace7a.dab1a","name":"","links":["4d0a18f.5e7cee8"],"x":1055,"y":860,"wires":[["8e804c74.30442"]]},{"id":"375a7bc5.bd5d04","type":"link in","z":"a37ace7a.dab1a","name":"","links":["71e5a282.b77d3c"],"x":975,"y":740,"wires":[["8ef835f1.5d3208"]]},{"id":"b716ef8e.2b413","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3210,"y":460,"wires":[]},{"id":"e568eeca.630c2","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3260,"y":1126.5999755859375,"wires":[]},{"id":"ed96737f.e32","type":"change","z":"a37ace7a.dab1a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1840,"wires":[["2a8d4a45.bd1a16"]]},{"id":"2a8d4a45.bd1a16","type":"link out","z":"a37ace7a.dab1a","name":"stop","links":["ffdb5471.804238"],"x":735,"y":1840,"wires":[]},{"id":"ffdb5471.804238","type":"link in","z":"a37ace7a.dab1a","name":"","links":["2a8d4a45.bd1a16"],"x":1095,"y":3120,"wires":[["f727e95e.f8b268"]]},{"id":"4b8bab3e.703384","type":"delay","z":"41ddd688.39b148","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":810,"y":740,"wires":[["227b3b5a.069c44"]]},{"id":"c5645ce2.a48ec","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":820,"wires":[["4b8bab3e.703384"]]},{"id":"227b3b5a.069c44","type":"change","z":"41ddd688.39b148","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":680,"wires":[["43daf734.69feb8"]]},{"id":"ec6d0e16.f7c74","type":"function","z":"df9841f2.71dce","name":"","func":"var BK = context.get(\"BK\")\n\nif (msg.payload >40 && BK === false){\n    msg.payload = \"stop\"\n    context.set(\"BK\",true)\n}\nelse if (msg.payload <= 32 && BK === true){\n    msg.payload = \"go\"\n    context.set(\"BK\",false)\n}\n\nelse if (msg.payload > 32 && BK === true){\n    msg.payload = \"stop\"\n    \n}\nelse{\n    msg.payload = \"go\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"BK\",false)","finalize":"","libs":[],"x":1530,"y":3560,"wires":[["1a097da9.245622"]]},{"id":"1a097da9.245622","type":"link out","z":"df9841f2.71dce","name":"liquid temp safety","links":["4246f81d.31b668"],"x":1800,"y":3560,"wires":[],"l":true},{"id":"dcff7055.59f24","type":"traffic","z":"df9841f2.71dce","name":"","property_allow":"payload","filter_allow":"go","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"stop","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":true,"differ":false,"x":570,"y":420,"wires":[["6b594b18.0fed14"]]},{"id":"4246f81d.31b668","type":"link in","z":"df9841f2.71dce","name":"liquid temp safety in","links":["1a097da9.245622"],"x":130,"y":480,"wires":[["43698330.70868c"]],"l":true},{"id":"96f6e944.43af48","type":"switch","z":"df9841f2.71dce","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"stop","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":500,"wires":[["64b660ef.89041","c1ae97eb.a20598"]]},{"id":"43698330.70868c","type":"rbe","z":"df9841f2.71dce","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":330,"y":480,"wires":[["96f6e944.43af48","dcff7055.59f24"]]},{"id":"50a9370b.1bc638","type":"ui_toast","z":"df9841f2.71dce","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":true,"topic":"","name":"","x":1150,"y":500,"wires":[[]]},{"id":"64b660ef.89041","type":"template","z":"df9841f2.71dce","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<body>\n<h1> We are running a bit hot!</h1>\n<p style=\"max-width:600px\">\n    We can see you have been enjoying this demo but unfourtuanly it needs to take a break and let the water cool down a bit, as it is now above 40 degrees celcius. \n    Due to the small scale of the demo and the water circulating in closed loop, it is natural for the water to be heat up. \n    This in no way affects the operation of the pump, which is rated to 110 degrees celcius, but as people might touch or come into contact with the unprotected piping, we want to ensure there is no risk to users from hot pipes. \n</p>\n\n<p style=\"max-width:600px\">\n    please give the demo some time to cool down and maybe grab a hot drink for yourself while waiting \n    \n</p>\n\n</body>\n</html>\n","output":"str","x":920,"y":500,"wires":[["50a9370b.1bc638"]]},{"id":"c1ae97eb.a20598","type":"change","z":"df9841f2.71dce","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":460,"wires":[["6b594b18.0fed14","cc4c0d5f.111df"]]},{"id":"a28c1e0f.86eb4","type":"inject","z":"df9841f2.71dce","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"41","payloadType":"num","x":1280,"y":3520,"wires":[["ec6d0e16.f7c74"]]},{"id":"cc4c0d5f.111df","type":"link out","z":"df9841f2.71dce","name":"temp safety stop","links":["be0feba1.e18f58"],"x":765,"y":480,"wires":[]},{"id":"be0feba1.e18f58","type":"link in","z":"41ddd688.39b148","name":"","links":["cc4c0d5f.111df"],"x":45,"y":940,"wires":[["fdab57f7.03a318"]]},{"id":"4512a46f.5de48c","type":"modbus-write","z":"de07c079.634c3","d":true,"name":"FC6 108 Feedback Sensor","showStatusActivities":false,"showErrors":false,"unitid":"1","dataType":"HoldingRegister","adr":"108","quantity":"1","server":"276147dc.e6e7f8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1180,"y":1940,"wires":[[],[]]},{"id":"97e906da.508008","type":"ui_slider","z":"de07c079.634c3","d":true,"name":"Occupancy-h","label":"Occupancy ","tooltip":"","group":"988388a.75b7578","order":10,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"100","step":1,"x":450,"y":1420,"wires":[["29289ff8.7d7f9","af9f52c3.752bf"]]},{"id":"29289ff8.7d7f9","type":"ui_text","z":"de07c079.634c3","d":true,"group":"988388a.75b7578","order":12,"width":"2","height":"1","name":"Load Setting Display-h","label":"","format":"{{msg.payload | uppercase}} %","layout":"row-left","x":860,"y":1400,"wires":[]},{"id":"b7cd6412.617738","type":"ui_switch","z":"de07c079.634c3","d":true,"name":"Sim_ON_OFF-h","label":"Stop / Start","tooltip":"","group":"988388a.75b7578","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"start","onvalueType":"str","onicon":"","oncolor":"","offvalue":"stop","offvalueType":"str","officon":"","offcolor":"","x":220,"y":2320,"wires":[["db46c63d.974d48","332462fb.6c4bde","a3f988d0.5aa408"]]},{"id":"f754c0d3.6b941","type":"traffic","z":"de07c079.634c3","name":"","property_allow":"payload","filter_allow":"start","ignore_case_allow":true,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"stop","ignore_case_stop":true,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":690,"y":1980,"wires":[["784268f.33c0498","ab4a3d8a.dc8a3"]]},{"id":"784268f.33c0498","type":"change","z":"de07c079.634c3","d":true,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Sensor","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":1920,"wires":[["4512a46f.5de48c","7d161af2.033364"]]},{"id":"376ec190.4550ae","type":"function","z":"de07c079.634c3","name":"Coil Power ","func":"var status = global.get(\"coil_status\")/100\n\nvar p1 = 7.84e3\nvar p2 = 9.346e-15\nvar q1 = 2/3\nq = msg.payload*0.277778\nmsg.payload = (((p1*q+p2)/(q+q1))*2)*status;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2350,"y":1580,"wires":[[]]},{"id":"6a7c44b5.c2fb4c","type":"function","z":"de07c079.634c3","d":true,"name":"Return Water Temp","func":"var p = msg.payload\nvar q = global.get(\"Flow\")*0.00028; //water Flow, assumed to be constant\nvar Tw_s = flow.get(\"Tw_s\") || 30;\nvar Ts = flow.get(\"Ts\") || 1;\nvar Tw_r = flow.get(\"Tw_r\") || 30;\nvar rho = 997\nvar V = 0.09  // m3, volume of water \nvar M = V*rho  // Mass of water volumne\nvar c = 4182  // water heat storage capacity\nvar C = M*c  // Thermal Capacity of Coil\n\nvar dot_T = (-q*rho*c*(Tw_r-Tw_s)+p)/C\n\nvar T = Tw_r+dot_T*Ts\n\nflow.set(\"Tw_r\",T)\nmsg.Tw_r = T\nmsg.payload = parseFloat(T).toFixed(2);\nmsg.topic = \"water\"\nmsg.dot_T = dot_T\nmsg.q = q\nmsg.Tw_s = Tw_s\nmsg.Tw_r = Tw_r\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1830,"y":1940,"wires":[["78e0ca22.a63d24","308cb11f.f9331e","6361e7.f7d56e18","cdbd7705.fd1478","299dc1e2.e9f63e","21e17550.f4573a","c4d4f52a.dc55c8"]]},{"id":"ca4ead2e.edbe5","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"delete","p":"Tw_r","pt":"flow"},{"t":"set","p":"Ta_s","pt":"flow","to":"Ta_s_setting","tot":"flow"},{"t":"delete","p":"T","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":1800,"wires":[[]]},{"id":"443fd49.de45f2c","type":"function","z":"de07c079.634c3","name":"Supply Air Temp","func":"var p = msg.payload;\nvar q = 2.5; //Air Flow, assumed to be constant\n//var q = 2;\nvar O = flow.get('occupancy');\n//var q = 3-((O)/100)*1; \nflow.set('q_air',q);\nvar Ta_s = flow.get(\"Ta_s\")||13;\nvar Ts = flow.get(\"Ts\") || 1;\nvar Ta_r = 13; \nvar rho = 1.225\nvar V = 80 // m3, volume of ahu \nvar M = V*rho  // Mass of air volumne\nvar c = 1000  // air heat storage capacity\nvar C = M*c  // Thermal Capacity of Coil\n\nvar dot_T = (q*rho*c*(Ta_r-Ta_s)-p)/C\n\nvar T = Ta_s+dot_T*Ts\n\nflow.set(\"Ta_s\",T)\n\nmsg.Ta_s = T\nmsg.payload = parseFloat(T).toFixed(2);\nmsg.topic = \"air\"\nmsg.dot_T = dot_T\nmsg.Ta_s = Ta_s\nmsg.Ta_r = Ta_r\nmsg.O = O\nmsg.Ts = Ts\nmsg.p = p\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\nflow.set(\"Ta_s\",22)\nflow.set(\"Ta_r\",28)","finalize":"","libs":[],"x":1220,"y":2120,"wires":[["43fdedb1.293404","c55d0fda.f5939","c67022db.9341","dd5f4df3.2665a","bd7c173b.b3abc8","c4b86686.8efd78","3c135799.792f38","5a7128cc.a78fe8","1529109f.61c03f","24df771a.672ee8","6ccdd114.8379b","266d9458.f6115c","a0e8b60b.c48948","5ce49240.93acbc"]]},{"id":"af9f52c3.752bf","type":"function","z":"de07c079.634c3","name":"load calc","func":"var setting = msg.payload;\nvar Ta_r = 28-((100-msg.payload)/100)*3;\nflow.set(\"Ta_r\",Ta_r)\n\nmsg.payload = parseFloat(Ta_r).toFixed(1);\nmsg.Ta_r1 = Ta_r\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":1540,"wires":[["1b26534c.52a36d","7338a9f.3add958","8337c9db.96c218"]]},{"id":"c67022db.9341","type":"ui_text","z":"de07c079.634c3","group":"da80b030.8ae43","order":1,"width":"0","height":"0","name":"Supply Air Temp-h","label":"","format":"{{msg.payload}} &deg C","layout":"row-spread","x":2430,"y":2020,"wires":[]},{"id":"78e0ca22.a63d24","type":"ui_text","z":"de07c079.634c3","group":"89bc8dd.4ec5d7","order":1,"width":"0","height":"0","name":"Return Water Temp-h","label":"RWT","format":"{{msg.payload}} &deg C","layout":"row-spread","x":2720,"y":1640,"wires":[]},{"id":"1b26534c.52a36d","type":"ui_text","z":"de07c079.634c3","d":true,"group":"988388a.75b7578","order":9,"width":0,"height":0,"name":"Return Air-h","label":"Return Air ","format":"{{msg.payload}} &deg C","layout":"row-spread","x":1090,"y":1420,"wires":[]},{"id":"80ed6bc6.d69928","type":"ui_button","z":"de07c079.634c3","name":"Reset-h","group":"988388a.75b7578","order":17,"width":0,"height":0,"passthru":false,"label":"Reset","tooltip":"","color":"","bgcolor":"","icon":"","payload":"stop","payloadType":"str","topic":"","x":300,"y":1820,"wires":[["ca4ead2e.edbe5","b54052b1.7270b","db46c63d.974d48","39cfb89c.12bc28"]]},{"id":"43fdedb1.293404","type":"function","z":"de07c079.634c3","d":true,"name":"Sensor To Global","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\n\n//min = -10\n//max = 130\n\nvar sensor = ((msg.Ta_s-min)/(max-min))*10000\nsensor = parseFloat(sensor).toFixed(0);\nmsg.payload = sensor\nglobal.set(\"Sensor\",sensor)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1450,"y":2340,"wires":[["e03c2bd9.1146e8"]]},{"id":"e0bd7a47.7a7dd8","type":"inject","z":"de07c079.634c3","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"stop","payloadType":"str","x":150,"y":1940,"wires":[["b7cd6412.617738"]]},{"id":"7759f7a8.bb0988","type":"link in","z":"de07c079.634c3","name":"","links":["65abf0d5.8ff66"],"x":555,"y":1920,"wires":[["f754c0d3.6b941"]]},{"id":"c1dfd4ac.b44578","type":"ui_slider","z":"de07c079.634c3","d":true,"name":"Coil Efficiency-h","label":"Coil Efficiency ","tooltip":"","group":"988388a.75b7578","order":13,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"100","step":1,"x":460,"y":1340,"wires":[["e9aefb77.864678","e5ea173f.1e6ff8"]]},{"id":"93c6fc4a.ed417","type":"inject","z":"de07c079.634c3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"100","payloadType":"num","x":210,"y":1520,"wires":[["97e906da.508008","c1dfd4ac.b44578","ec274ece.f96ef","3f71fe02.6c3d62"]]},{"id":"e9aefb77.864678","type":"ui_text","z":"de07c079.634c3","d":true,"group":"988388a.75b7578","order":14,"width":"2","height":"1","name":"Coil Status display-h","label":"","format":"{{msg.payload | uppercase}} %","layout":"row-left","x":1120,"y":1280,"wires":[]},{"id":"e5ea173f.1e6ff8","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"coil_status","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":1180,"wires":[[]]},{"id":"e03c2bd9.1146e8","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1650,"y":2360,"wires":[]},{"id":"7d161af2.033364","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1250,"y":1880,"wires":[]},{"id":"25bc3172.06e16e","type":"ui_chart","z":"de07c079.634c3","name":"Flow Chart-h","group":"1bdc6df6.ccbdc2","order":2,"width":"0","height":"0","label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"20","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#9d0027","#a3465d","#ff7f0e","#2ca02c","#98df8a","#9d0027","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1430,"y":800,"wires":[[]]},{"id":"327f5cd6.7836b4","type":"ui_text","z":"de07c079.634c3","group":"1bdc6df6.ccbdc2","order":1,"width":"0","height":"0","name":"Flow Value-h","label":"Flow","format":"{{msg.payload}} m<sup>3</sup>/h","layout":"row-spread","x":1430,"y":840,"wires":[]},{"id":"26b14a63.bda706","type":"ui_chart","z":"de07c079.634c3","name":"Pressure Chart-h","group":"7d6c26ba.b40a38","order":2,"width":"0","height":"0","label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"13","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#facb7a","#f49500","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1450,"y":900,"wires":[[]]},{"id":"729e34cd.2db1ec","type":"ui_text","z":"de07c079.634c3","group":"7d6c26ba.b40a38","order":1,"width":"6","height":"1","name":"Head Value-h","label":"Pressure ","format":"{{msg.payload}} m","layout":"row-spread","x":1460,"y":980,"wires":[]},{"id":"fc7a7f50.addd6","type":"ui_gauge","z":"de07c079.634c3","name":"kW Gauge-h","group":"e1ad3e01.8681d","order":1,"width":"3","height":"3","gtype":"gage","title":"","label":"W","format":"{{msg.payload.data[0] | uppercase}}","min":"0","max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1430,"y":680,"wires":[]},{"id":"c16e749f.538218","type":"ui_gauge","z":"de07c079.634c3","name":"RPM-h","group":"e1ad3e01.8681d","order":2,"width":"3","height":"3","gtype":"gage","title":"","label":"RPM","format":"{{msg.payload.data[0] | uppercase}}","min":"1300","max":"4000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1420,"y":720,"wires":[]},{"id":"ae105526.5a7048","type":"comment","z":"de07c079.634c3","name":"Simulation page","info":"","x":1440,"y":640,"wires":[]},{"id":"9749eff0.d8a9c","type":"link in","z":"de07c079.634c3","name":"","links":["fd18d18e.75773","22ff831a.97c09c","6e89ac88.ae7414"],"x":415,"y":740,"wires":[["c16e749f.538218"]]},{"id":"c22575f7.3781d8","type":"link in","z":"de07c079.634c3","name":"","links":["65abf0d5.8ff66"],"x":415,"y":820,"wires":[["25bc3172.06e16e","327f5cd6.7836b4"]]},{"id":"78f8145b.b0519c","type":"link in","z":"de07c079.634c3","name":"","links":["aef19316.51085","5c0c0e5c.0d0d2","d3f2e4b2.919ad8"],"x":475,"y":900,"wires":[["729e34cd.2db1ec","c788019.ea633"]]},{"id":"86bfbe79.3e458","type":"link in","z":"de07c079.634c3","name":"","links":["f1be094c.54d548","16dbf834.0ab598","f5cbe01d.8fd82"],"x":415,"y":700,"wires":[["fc7a7f50.addd6"]]},{"id":"83548cfa.a35f2","type":"link out","z":"de07c079.634c3","name":"Set SetPoint","links":["5c5cf3e0.1b94ec"],"x":1735,"y":2720,"wires":[]},{"id":"ab54ef5d.d4692","type":"widgetlords-analog-out","z":"de07c079.634c3","name":"A3 0-10V","channel":"2","address":"0","x":1440,"y":2460,"wires":[]},{"id":"c55d0fda.f5939","type":"function","z":"de07c079.634c3","name":"Temp to analogue","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\nvar target_temp = msg.payload\nvar offset = 0.5\nif (target_temp >= max){\n    target_temp = max\n} \nelse if (target_temp <= min){\n    target_temp = min\n}\n\n// voltage = 1 or current = 2 selection\nvar selector = 1\nif(selector==1){\n    var ana_max = 4000\n    var ana_min = 0\n}\nelse{\n    var ana_max = 4000\n    var ana_min = 800\n}\n\nvar target_percentage = ((target_temp-offset)-min) / (max-min)\n\nvar target_ana = (target_percentage *(ana_max-ana_min)+ana_min)\n\nmsg.payload = parseFloat((target_ana).toFixed(0))\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1230,"y":2460,"wires":[["ab54ef5d.d4692"]]},{"id":"ab4a3d8a.dc8a3","type":"function","z":"de07c079.634c3","name":"rational fit","func":"var q = global.get(\"Flow\");\nvar q_max = 4.6\n\nvar p1 = 8594\nvar p2 = 4.258\nvar q1 = 6451\nvar q2 = 2322\nvar Q = 52000\n//var Q = 31500\nvar x = q/q_max\n\nf = (p1*x+p2)/(x^2-q1*x-q2)\nmsg.payload = f*Q\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":920,"y":2000,"wires":[["6a7c44b5.c2fb4c","443fd49.de45f2c","58223a16.68e2f4"]]},{"id":"14520cf5.75c0f3","type":"inject","z":"de07c079.634c3","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":450,"y":1560,"wires":[["ca4ead2e.edbe5"]]},{"id":"308cb11f.f9331e","type":"ui_chart","z":"de07c079.634c3","name":"Return Water Temp (RWT)-h","group":"89bc8dd.4ec5d7","order":2,"width":"0","height":"0","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"10","ymax":"30","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#2ca02c","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":2100,"y":1420,"wires":[[]]},{"id":"dd5f4df3.2665a","type":"ui_chart","z":"de07c079.634c3","name":"Supply Air Temp (SAT)-h","group":"da80b030.8ae43","order":2,"width":"6","height":"6","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"18","ymax":"32","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1710,"y":1760,"wires":[[]]},{"id":"b54052b1.7270b","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":1680,"wires":[["308cb11f.f9331e","dd5f4df3.2665a","26b14a63.bda706","25bc3172.06e16e","cbf2f00d.3369c","6fa69012.39ec2"]]},{"id":"936243f7.676ee","type":"link in","z":"de07c079.634c3","name":"","links":["c7a90dd.e1d50f"],"x":995,"y":1020,"wires":[["25bc3172.06e16e","26b14a63.bda706","cbf2f00d.3369c","6fa69012.39ec2"]]},{"id":"6a14e699.03b4e8","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":9,"width":0,"height":0,"name":"Actual SetPoint-h","label":"Actual SetPoint","format":"{{msg.payload}}","layout":"row-spread","x":1970,"y":880,"wires":[]},{"id":"a6aebac0.0a1828","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":5,"width":0,"height":0,"name":"Actual FlowLimit-h","label":"Actual FlowLimit","format":"{{msg.payload}}","layout":"row-spread","x":1970,"y":940,"wires":[]},{"id":"eed67e44.e9b1a","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":2,"width":0,"height":0,"name":"Remote Control:-h","label":"Remote Control:","format":"{{msg.payload}}","layout":"row-spread","x":1970,"y":680,"wires":[]},{"id":"f468f778.2bc608","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":3,"width":0,"height":0,"name":"Start / Stop:-h","label":"Start / Stop:","format":"{{msg.payload}}","layout":"row-spread","x":1960,"y":640,"wires":[]},{"id":"5fe51e8b.57508","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":4,"width":0,"height":0,"name":"FlowLIMIT:-h","label":"FlowLIMIT:","format":"{{msg.payload}}","layout":"row-spread","x":1950,"y":760,"wires":[]},{"id":"8cba5a4e.e31278","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":1,"width":0,"height":0,"name":"Control Mode-h","label":"Control Mode","format":"{{msg.payload}}","layout":"row-spread","x":1960,"y":820,"wires":[]},{"id":"8374c8a0.d45708","type":"link in","z":"de07c079.634c3","name":"","links":["e8521bba.edeff8","a5a80b61.670c28"],"x":1615,"y":640,"wires":[["f468f778.2bc608"]]},{"id":"e61c45d3.bf85a8","type":"link in","z":"de07c079.634c3","name":"","links":["e9e83e7f.4bc83","892449e3.63c0c8"],"x":1615,"y":680,"wires":[["eed67e44.e9b1a"]]},{"id":"8b09bddd.36fa8","type":"link in","z":"de07c079.634c3","name":"","links":["683bc76a.1f89a8","79600cac.5f5084"],"x":1615,"y":760,"wires":[["5fe51e8b.57508"]]},{"id":"675ac215.36be9c","type":"link in","z":"de07c079.634c3","name":"","links":["a6485d81.d9d4a","4d4d0b7a.c51f04"],"x":1615,"y":820,"wires":[["8cba5a4e.e31278"]]},{"id":"784de128.c583c","type":"link in","z":"de07c079.634c3","name":"","links":["369cdd9f.add602","a058e9d5.7e1cb8","d1dc324f.0537"],"x":1615,"y":880,"wires":[["6a14e699.03b4e8"]]},{"id":"cfac4884.e14b48","type":"link in","z":"de07c079.634c3","name":"","links":["13396b70.3389d5","938c064a.8b0d78","80a06905.9cdd48"],"x":1615,"y":960,"wires":[["a6aebac0.0a1828"]]},{"id":"1fe719bd.db5416","type":"ui_numeric","z":"de07c079.634c3","name":"Setpoint-h","label":"Setpoint","tooltip":"","group":"988388a.75b7578","order":8,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}} &deg C","min":"23","max":"27","step":1,"x":270,"y":2640,"wires":[["ab54baf6.93b318","cbf37956.1fb8e8"]]},{"id":"ab54baf6.93b318","type":"function","z":"de07c079.634c3","name":"temp to setpoint","func":"var min = global.get(\"min_temp\")\nvar max = global.get(\"max_temp\")\nvar sensor_min = global.get(\"sensor_min\")\nvar sensor_max = global.get(\"sensor_max\")\n    \nvar r_max = max\nvar r_min = min\nvar tmp = msg.payload\nsetpoint = ((tmp-r_min)/(r_max-r_min))*10000\nmsg.payload = setpoint\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":2820,"wires":[["5afe8bda.3707c4"]]},{"id":"81993e6a.d3f56","type":"ui_switch","z":"de07c079.634c3","d":true,"name":"Pump / Valve Mode-h","label":"Pump / Valve Mode","tooltip":"","group":"988388a.75b7578","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"valve","onvalueType":"str","onicon":"","oncolor":"","offvalue":"pump","offvalueType":"str","officon":"","offcolor":"","x":180,"y":2500,"wires":[["5afe8bda.3707c4","78422a06.82df44","c4b86686.8efd78","976cfdca.83df","332462fb.6c4bde","a3f988d0.5aa408"]]},{"id":"265b441a.07503c","type":"PID","z":"de07c079.634c3","name":"","setpoint":"27","pb":"3","ti":"10","td":0,"integral_default":"0.5","smooth_factor":3,"max_interval":600,"enable":"1","disabled_op":"0","x":1010,"y":2540,"wires":[["1cc23576.e3779b","7e6ff0f5.d4456"]]},{"id":"1cc23576.e3779b","type":"function","z":"de07c079.634c3","name":"Scale","func":"msg.payload = (msg.payload)*100\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1190,"y":2560,"wires":[["7dc4aa8f.3dc8a4","b6d90448.e82ed8"]]},{"id":"7dc4aa8f.3dc8a4","type":"link out","z":"de07c079.634c3","name":"valve opening","links":["fc8fe1e6.d3cac"],"x":1540,"y":2560,"wires":[],"l":true},{"id":"cbf37956.1fb8e8","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"setpoint","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":2740,"wires":[["265b441a.07503c"]]},{"id":"5afe8bda.3707c4","type":"traffic","z":"de07c079.634c3","name":"","property_allow":"payload","filter_allow":"pump","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"valve","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":true,"differ":false,"x":1250,"y":2780,"wires":[["83548cfa.a35f2"]]},{"id":"2cbff97c.37c6c6","type":"widgetlords-vpe-3011b-sdafe","z":"de07c079.634c3","name":"","channel":"6","input_type":"7","interval":"1000","x":450,"y":980,"wires":[["2cbc14b6.cdfe5c"]]},{"id":"2cbc14b6.cdfe5c","type":"function","z":"de07c079.634c3","name":"scaling","func":"var DP = (msg.payload/10000)*0.6*10\nmsg.payload=parseFloat(DP).toFixed(2);\nmsg.topic = \"DP Sensor\"\nflow.set(\"DP\",DP)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":1000,"wires":[["26b14a63.bda706"]]},{"id":"c788019.ea633","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Pump Head","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":880,"wires":[["26b14a63.bda706"]]},{"id":"bd7c173b.b3abc8","type":"change","z":"de07c079.634c3","d":true,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"DP","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2640,"wires":[["c7c390ed.c6fb3"]]},{"id":"c7c390ed.c6fb3","type":"PID","z":"de07c079.634c3","d":true,"name":"","setpoint":"1","pb":1,"ti":"10","td":0,"integral_default":0.5,"smooth_factor":3,"max_interval":600,"enable":1,"disabled_op":0,"x":1190,"y":2640,"wires":[["b968220e.1a265"]]},{"id":"78422a06.82df44","type":"traffic","z":"de07c079.634c3","d":true,"name":"","property_allow":"payload","filter_allow":"valve","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"pump","filter_stop":"stop","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":1510,"y":2640,"wires":[["83548cfa.a35f2"]]},{"id":"b968220e.1a265","type":"function","z":"de07c079.634c3","d":true,"name":"scale","func":"msg.payload = msg.payload*10000\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1340,"y":2660,"wires":[["78422a06.82df44"]]},{"id":"13bd57a6.1ac0c8","type":"link out","z":"de07c079.634c3","name":"Control Mode","links":["1c3332b0.74637d"],"x":1900,"y":3100,"wires":[],"l":true},{"id":"750803c0.453eec","type":"link out","z":"de07c079.634c3","name":"BMS ON/OFF","links":["eb88f949.f317c8"],"x":1920,"y":3220,"wires":[],"l":true},{"id":"68e6ec1d.3e2f94","type":"link out","z":"de07c079.634c3","name":"GO/STOP","links":["e1c1e566.23bef8"],"x":1930,"y":3320,"wires":[],"l":true},{"id":"adfa0760.7bd248","type":"link out","z":"de07c079.634c3","name":"Set FlowLimit","links":["ee14a6b0.4cd808"],"x":1900,"y":3500,"wires":[],"l":true},{"id":"de8d1237.44aac","type":"link out","z":"de07c079.634c3","name":"Enable FlowLimit","links":["aa3ab941.3d0628"],"x":1930,"y":3400,"wires":[],"l":true},{"id":"ba158593.0b3d08","type":"change","z":"de07c079.634c3","name":"Const. Temp","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3280,"wires":[["13bd57a6.1ac0c8","6ba6561f.124158"]]},{"id":"6ba6561f.124158","type":"change","z":"de07c079.634c3","name":"BMS, GO, FlowLimit","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1140,"y":3340,"wires":[["750803c0.453eec","68e6ec1d.3e2f94","de8d1237.44aac","ae59b900.25ada8"]]},{"id":"ae59b900.25ada8","type":"change","z":"de07c079.634c3","name":"Define FlowLimit","rules":[{"t":"set","p":"payload","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":3400,"wires":[["adfa0760.7bd248","8de8cbf2.613648"]]},{"id":"db46c63d.974d48","type":"delay","z":"de07c079.634c3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":570,"y":2180,"wires":[["f754c0d3.6b941"]]},{"id":"8de8cbf2.613648","type":"change","z":"de07c079.634c3","name":"Setpoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"2700","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":3460,"wires":[["3148fbdc.71ff34","39227954.c693c6"]]},{"id":"cbf2f00d.3369c","type":"change","z":"de07c079.634c3","d":true,"name":"","rules":[{"t":"delete","p":"data1","pt":"flow"},{"t":"delete","p":"count","pt":"flow"},{"t":"delete","p":"data2","pt":"flow"},{"t":"delete","p":"data3","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":760,"wires":[[]]},{"id":"710a60ca.cfe8f","type":"ui_button","z":"de07c079.634c3","name":"help-h","group":"988388a.75b7578","order":1,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"mi-help_outline","payload":"","payloadType":"str","topic":"","x":190,"y":580,"wires":[["e4ce5d6b.be392"]]},{"id":"4daabfef.5739d","type":"ui_button","z":"de07c079.634c3","name":"information-h","group":"988388a.75b7578","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"mi-info_outline","payload":"","payloadType":"str","topic":"","x":200,"y":640,"wires":[["a3de3522.c35008"]]},{"id":"7f470488.5044bc","type":"ui_toast","z":"de07c079.634c3","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":true,"topic":"","name":"","x":570,"y":580,"wires":[[]]},{"id":"a3de3522.c35008","type":"template","z":"de07c079.634c3","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<body >\n<h1 style=\"max-width:600px\">\n    Grundfos Distributed Pumping Temperature Control Demo\n</h1>\n<p style=\"max-width:600px\">\n    The purpose of this demo is to showcase the MAGNA3 capabilities within temperature control and other features. For this purpose, simplified thermodynamic equations are implemented in the Dedicated Control Unit (DCU), to simulate the temperature response of a coil supplied by chilled water. The coil is assumed to be ideal performance, meaning that the coil characteristic follows the prescribed curve with no deviations. \n    This model does not include or simulate humidity, which while an important part of A/C control does not impact the temperature control element except as a setpoint influencer.  \n</p>\n<p style=\"max-width:600px\">\n<img src=\"/intro.png\" alt=\"intro\" style=\"width:100%;height:auto;background-color:#FFFFFF\" >\n</p>\n<p style=\"max-width:600px\">\n    The incoming air temperature is the load on the system and as it passes over the coil, it is cooled down. This demo has the possiblity to simulate a change in occupancy of the building, which will reduce the load of the system, thereby it is possible to not only see the initial temperature response but also how the demo behaves as the load on the building changes.\n</p>\n<p style=\"max-width:600px\">\n    The demo offers two different control options, a DPS coil pump mode and a PICV mode. The following sections will explain the difference between these two modes. The flow meter reading is used as an input for the Coil Power output curve for both modes.\n</p>\n\n<h2 style=\"max-width:600px\">DPS Coil Pump Mode</h2>\n<p style=\"max-width:600px\">\n    In this mode, the pump the controller is passing the simulated Supply Air Temperature (SAT) to the as an analog signal in the 0-10V range. \n</p>\n<p style=\"max-width:600px\">\n<img src=\"/dps_ahu.PNG\" alt=\"DPS AHU\" style=\"width:100%;height:auto;\" >\n</p>\n<p style=\"max-width:600px\">\n    The pump is using its’ Constant Temperature Control mode, which automatically adjusts the speed of the pump, and thereby the flow in the system, according to the load in the simulation and the setpoint defined via the Dashboard. It is possible to change the Controller parameters, Kp and Ti which are respectively the Proportional- and Integrator constants. This will affect the pumps response and serve to showcase and educate the impact of tuning the Controller in the pump\n</p>\n\n<h2 style=\"max-width:600px\">Pressure Independent Control Valve (PICV) Mode</h2>\n<p style=\"max-width:600px\">\n    In this mode, the flow is controlled via a PICV valve which lift-percentage is controlled by DCU which is using a PI-controller to maintain the SAT at the defined Setpoint.\n</p>\n<p style=\"max-width:600px\">\n<img src=\"/valve_ahu.PNG\" alt=\"Valve AHU\" style=\"width:100%;height:auto;\" >\n</p>\n<p style=\"max-width:600px\">\n   In this mode, the pump is serving as a pressure source, and operates in Constant Head Control mode. This is representative of ASHRAE’s recommendation of maintaining a constant differential pressure across the Index branch, as the pump head in this small closed-loop demo is equal to the differential pressure across the whole demo loop.<br>\n   It is possible to configure the travel speed of the PICV, but as default it is set to 24 sec/mm which is the factory default speed of this particular PICV.\n</p>\n\n</body>\n</html>\n","output":"str","x":390,"y":640,"wires":[["7f470488.5044bc"]]},{"id":"3148fbdc.71ff34","type":"link out","z":"de07c079.634c3","name":"Set SetPoint","links":["5c5cf3e0.1b94ec"],"x":1790,"y":3660,"wires":[],"l":true},{"id":"b6d90448.e82ed8","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1370,"y":2520,"wires":[]},{"id":"c4b86686.8efd78","type":"traffic","z":"de07c079.634c3","name":"","property_allow":"payload","filter_allow":"valve","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"pump","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":930,"y":2400,"wires":[["265b441a.07503c"]]},{"id":"976cfdca.83df","type":"switch","z":"de07c079.634c3","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"valve","vt":"str"},{"t":"eq","v":"pump","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":430,"y":2320,"wires":[["114b35c9.3a9c5a"],["ade72b81.b33958"]]},{"id":"cd69713d.ae1e","type":"ui_toast","z":"de07c079.634c3","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":true,"topic":"","name":"","x":950,"y":2200,"wires":[[]]},{"id":"aa1b1be0.935928","type":"link in","z":"de07c079.634c3","name":"","links":["874b4ba2.c1c508"],"x":995,"y":1080,"wires":[["6fa69012.39ec2"]]},{"id":"6fa69012.39ec2","type":"ui_chart","z":"de07c079.634c3","name":"Valve Position-h","group":"16714a80.c29cf6","order":1,"width":0,"height":0,"label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1460,"y":1040,"wires":[[]]},{"id":"7311856d.e5c72c","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":6,"width":0,"height":0,"name":"Kp-h","label":"Kp","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":980,"wires":[]},{"id":"23e2007f.86548","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":7,"width":0,"height":0,"name":"Ti-h","label":"Ti","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":1020,"wires":[]},{"id":"338d42c7.ca51fe","type":"ui_text","z":"de07c079.634c3","group":"2fa7e0a2.4b9c8","order":8,"width":0,"height":0,"name":"Mode-h","label":"Mode","format":"{{msg.payload}}","layout":"row-spread","x":2000,"y":1060,"wires":[]},{"id":"6f2eb6ff.14ca38","type":"link in","z":"de07c079.634c3","name":"","links":["43081592.80b45c"],"x":1735,"y":980,"wires":[["7311856d.e5c72c"]]},{"id":"ada843e2.698ae","type":"link in","z":"de07c079.634c3","name":"","links":["38d360c0.fd28"],"x":1735,"y":1020,"wires":[["23e2007f.86548"]]},{"id":"a68f64c8.6d5208","type":"link in","z":"de07c079.634c3","name":"","links":["a6462bbb.947fe8"],"x":1735,"y":1060,"wires":[["338d42c7.ca51fe"]]},{"id":"9f010328.ad427","type":"ui_numeric","z":"de07c079.634c3","name":"Kp value-h","label":"Kp Value","tooltip":"","group":"988388a.75b7578","order":15,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"3","step":"0.1","x":490,"y":1160,"wires":[["2c0a275d.b853d8","d27afeed.ede91"]]},{"id":"1d794a4a.d0e946","type":"ui_numeric","z":"de07c079.634c3","name":"Ti value-h","label":"Ti Value","tooltip":"","group":"988388a.75b7578","order":16,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"100","step":1,"x":480,"y":1240,"wires":[["4680c6f0.a0e5c8","5f1f6cd3.f88904"]]},{"id":"2c0a275d.b853d8","type":"function","z":"de07c079.634c3","name":"scaling","func":"msg.payload = msg.payload*10\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1120,"wires":[["a99be986.78ded8"]]},{"id":"4680c6f0.a0e5c8","type":"function","z":"de07c079.634c3","name":"scaling","func":"msg.payload = msg.payload*10\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":1200,"wires":[["c5519854.d02f98"]]},{"id":"a99be986.78ded8","type":"link out","z":"de07c079.634c3","name":"Kp Set","links":["cb085822.546338"],"x":845,"y":1120,"wires":[]},{"id":"c5519854.d02f98","type":"link out","z":"de07c079.634c3","name":"Ti Set","links":["d8fbd7c1.2b36e8"],"x":825,"y":1200,"wires":[]},{"id":"f5068c8.250e17","type":"link out","z":"de07c079.634c3","name":"Controller Mode","links":["3a6424d0.8181ac"],"x":1920,"y":2840,"wires":[],"l":true},{"id":"747bd37d.8011fc","type":"change","z":"de07c079.634c3","name":"Direct Controller","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":3220,"wires":[["f5068c8.250e17","ba158593.0b3d08","5e5e4656.3d5298"]]},{"id":"e0125936.93aba8","type":"change","z":"de07c079.634c3","name":"Inverse Controller","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":2880,"wires":[["1cdd4312.4c295d","f5068c8.250e17","5e5e4656.3d5298"]]},{"id":"1cdd4312.4c295d","type":"change","z":"de07c079.634c3","name":"Constant Temp","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":2920,"wires":[["34dd4190.ef6e5e","13bd57a6.1ac0c8"]]},{"id":"34dd4190.ef6e5e","type":"change","z":"de07c079.634c3","name":"BMS ON and GO","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":2960,"wires":[["750803c0.453eec","68e6ec1d.3e2f94","f722c6f5.76d278"]]},{"id":"b9493b22.d91218","type":"change","z":"de07c079.634c3","name":"Setpoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"0100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":3060,"wires":[["3148fbdc.71ff34"]]},{"id":"f722c6f5.76d278","type":"change","z":"de07c079.634c3","name":"Disable FlowLimit","rules":[{"t":"set","p":"payload","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3000,"wires":[["b9493b22.d91218","de8d1237.44aac"]]},{"id":"332462fb.6c4bde","type":"traffic","z":"de07c079.634c3","name":"","property_allow":"payload","filter_allow":"pump","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"valve","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":true,"differ":false,"x":850,"y":3100,"wires":[["747bd37d.8011fc"]]},{"id":"a3f988d0.5aa408","type":"traffic","z":"de07c079.634c3","name":"","property_allow":"payload","filter_allow":"valve","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"pump","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":850,"y":2900,"wires":[["e0125936.93aba8"]]},{"id":"39227954.c693c6","type":"function","z":"de07c079.634c3","name":"","func":"msg.payload = msg.payload/100\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":3060,"wires":[["1fe719bd.db5416"]]},{"id":"755d59df.986ce8","type":"link in","z":"de07c079.634c3","name":"","links":["3753d190.8334be","1b07df37.9a36a1"],"x":185,"y":1140,"wires":[["9f010328.ad427","cc89b1.13acf65","680d2321.3cb9cc"]]},{"id":"86989f58.2c4ae","type":"link in","z":"de07c079.634c3","name":"","links":["5d2bf0b5.ab2ac","e358e37a.1393d"],"x":195,"y":1200,"wires":[["1d794a4a.d0e946","50bd7e1d.0e7fe"]]},{"id":"5e5e4656.3d5298","type":"link out","z":"de07c079.634c3","name":"controller mode ui","links":["507c3eb5.73061"],"x":1930,"y":2960,"wires":[],"l":true},{"id":"cc89b1.13acf65","type":"delay","z":"de07c079.634c3","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":1120,"wires":[["2c0a275d.b853d8"]]},{"id":"50bd7e1d.0e7fe","type":"delay","z":"de07c079.634c3","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":1200,"wires":[["4680c6f0.a0e5c8"]]},{"id":"5bbb7218.399fac","type":"ui_ui_control","z":"de07c079.634c3","name":"","events":"all","x":1940,"y":320,"wires":[["b2a77373.904e6"]]},{"id":"b2a77373.904e6","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2130,"y":320,"wires":[]},{"id":"48a63d44.2beac4","type":"ui_button","z":"de07c079.634c3","name":"Pump mode-h","group":"988388a.75b7578","order":5,"width":"3","height":"1","passthru":false,"label":"Pump","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"{\"group\":{\"hide\":[\"Simulations_Valve_Position\"]}}","payloadType":"json","topic":"","x":500,"y":300,"wires":[["5bbb7218.399fac","26bca757.6a8838","f8f37d10.58ebd","dc64b518.58e4b8","c4f9658b.e5af58"]]},{"id":"db934e43.49677","type":"ui_button","z":"de07c079.634c3","name":"Valve Mode-h","group":"988388a.75b7578","order":6,"width":"3","height":"1","passthru":false,"label":"PICV","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Valve_Position\"],\"hide\":[\"Simulations_Control_Simulation_Kp_Value\",\"Simulations_Control_Simulation_Ti_Value\"]}}","payloadType":"json","topic":"","x":500,"y":440,"wires":[["5bbb7218.399fac","629ffc64.f5b3d4","a84080ec.762ae","93f54efb.4c9d7","62de39e0.14fc48"]]},{"id":"56670d8b.4e0734","type":"ui_button","z":"de07c079.634c3","name":"start sim-h","group":"988388a.75b7578","order":18,"width":0,"height":0,"passthru":false,"label":"Start","tooltip":"","color":"","bgcolor":"","icon":"","payload":"start","payloadType":"str","topic":"","x":230,"y":2180,"wires":[["db46c63d.974d48","a3f988d0.5aa408","332462fb.6c4bde"]]},{"id":"26bca757.6a8838","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":340,"wires":[["db934e43.49677"]]},{"id":"f8f37d10.58ebd","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":240,"wires":[["48a63d44.2beac4"]]},{"id":"a84080ec.762ae","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#707372","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":380,"wires":[["48a63d44.2beac4"]]},{"id":"629ffc64.f5b3d4","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"colour","pt":"msg","to":"#11497B","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":500,"wires":[["db934e43.49677"]]},{"id":"32e1c5f1.4ad64a","type":"link out","z":"de07c079.634c3","name":"Pump/Valve","links":["93c41bb9.17cb48"],"x":1015,"y":580,"wires":[]},{"id":"dc64b518.58e4b8","type":"change","z":"de07c079.634c3","name":"pump","rules":[{"t":"set","p":"payload","pt":"msg","to":"pump","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":560,"wires":[["32e1c5f1.4ad64a"]]},{"id":"93f54efb.4c9d7","type":"change","z":"de07c079.634c3","name":"valve","rules":[{"t":"set","p":"payload","pt":"msg","to":"valve","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":600,"wires":[["32e1c5f1.4ad64a"]]},{"id":"93c41bb9.17cb48","type":"link in","z":"de07c079.634c3","name":"Pump/Valve","links":["32e1c5f1.4ad64a"],"x":215,"y":2400,"wires":[["976cfdca.83df","c4b86686.8efd78","5afe8bda.3707c4","a3f988d0.5aa408","332462fb.6c4bde"]]},{"id":"ae08c75c.c51b78","type":"ui_button","z":"de07c079.634c3","name":"Pump Status-h","group":"988388a.75b7578","order":19,"width":0,"height":0,"passthru":true,"label":"Pump Status","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":1160,"y":500,"wires":[["b1e08518.a6add8"]]},{"id":"b1e08518.a6add8","type":"function","z":"de07c079.634c3","name":"","func":"var bookkeeper = flow.get(\"bookkeeper\") \nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_Pump_Status\"]}}\n    flow.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_Pump_Status\"]}}\n    flow.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1340,"y":500,"wires":[["5bbb7218.399fac","877faf31.a845a"]]},{"id":"877faf31.a845a","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1610,"y":520,"wires":[]},{"id":"4e0970f1.de79f","type":"inject","z":"de07c079.634c3","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":260,"wires":[["e43cec5a.b0717","f8f37d10.58ebd","26bca757.6a8838","4f170595.98820c","62cf83bb.ae6c6c","a1fc4718.a7b338","e0abc9a.ad2ff38"]]},{"id":"e43cec5a.b0717","type":"change","z":"de07c079.634c3","name":"pump","rules":[{"t":"set","p":"bookkeeper","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":500,"wires":[["ae08c75c.c51b78"]]},{"id":"e3e56093.bd6cd","type":"inject","z":"de07c079.634c3","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"1","payloadType":"num","x":170,"y":1000,"wires":[["9f010328.ad427"]]},{"id":"35de1a64.d94cd6","type":"inject","z":"de07c079.634c3","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"8","payloadType":"num","x":170,"y":1060,"wires":[["1d794a4a.d0e946"]]},{"id":"5889971e.0c8458","type":"template","z":"de07c079.634c3","name":"pump mode","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<p style=\"max-width:500px\">\n<img src=\"/pump.jpg\" alt=\"intro\" style=\"width:100%;height:auto;\">\n</p>","output":"str","x":770,"y":2340,"wires":[["cd69713d.ae1e"]]},{"id":"ade72b81.b33958","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Change to Pump Mode","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2340,"wires":[["5889971e.0c8458"]]},{"id":"114b35c9.3a9c5a","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Change to PICV Mode","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2280,"wires":[["4054c3fa.b0b2fc"]]},{"id":"4054c3fa.b0b2fc","type":"template","z":"de07c079.634c3","name":"valvemode","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<p style=\"max-width:500px\">\n<img src=\"/valve.jpg\" alt=\"intro\" style=\"width:100%;height:auto;\">\n</p>","output":"str","x":770,"y":2280,"wires":[["cd69713d.ae1e"]]},{"id":"e4ce5d6b.be392","type":"template","z":"de07c079.634c3","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n\n<body style=\"background-color:blue\">\n<h1 style=\"max-width:600px\">\n    How to use this dashboard\n</h1>\n<p style=\"max-width:600px\">\n<img src=\"/help_simulation.png\" alt=\"intro\" style=\"width:100%;height:auto;\" >\n</p>\n\n<p style=\"max-width:600px\">\n  <ol style=\"max-width:600px\">\n      <li>Select either the Pump or PICV mode</li>\n      <li>The settings in this menu can be changed either before the demo is started or on the fly, and the response of the demo is seen immidiately</li>\n      <li>When ready, press start and the simulation will begin and you can follow the progress on the different plots</li>\n      <li>If you which to stop or restart the simulation, press the Reset</li>\n      <li>You can toggle the view of the Pump Status, Flow-, Pressure and Return Water Temp chart to simplify the dashboard</li>\n      <li>It is possible to toggle between either the Duty Point- or the Flow Power chart and the data is consistent untill cleared</li>\n  </ol> \n</p>\n\n\n</body>\n</html>\n","output":"str","x":360,"y":580,"wires":[["7f470488.5044bc"]]},{"id":"d27afeed.ede91","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"Kp","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1160,"wires":[[]]},{"id":"5f1f6cd3.f88904","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"Ti","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":1240,"wires":[[]]},{"id":"62de39e0.14fc48","type":"change","z":"de07c079.634c3","name":"Kp","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":340,"wires":[["63f208bd.029488","1b07df37.9a36a1"]]},{"id":"63f208bd.029488","type":"change","z":"de07c079.634c3","name":"Ti","rules":[{"t":"set","p":"payload","pt":"msg","to":"8","tot":"num"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":380,"wires":[["e358e37a.1393d"]]},{"id":"c4f9658b.e5af58","type":"change","z":"de07c079.634c3","name":"Kp","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"Kp","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":220,"wires":[["44a465c8.1a121c","1b07df37.9a36a1"]]},{"id":"44a465c8.1a121c","type":"change","z":"de07c079.634c3","name":"Ti","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"Ti","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":260,"wires":[["e358e37a.1393d"]]},{"id":"1b07df37.9a36a1","type":"link out","z":"de07c079.634c3","name":"Kp enable/disable","links":["755d59df.986ce8"],"x":1190,"y":260,"wires":[],"l":true},{"id":"e358e37a.1393d","type":"link out","z":"de07c079.634c3","name":"Ti enable/disable","links":["86989f58.2c4ae"],"x":1170,"y":340,"wires":[],"l":true},{"id":"680d2321.3cb9cc","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":560,"y":1080,"wires":[]},{"id":"ec274ece.f96ef","type":"ui_numeric","z":"de07c079.634c3","name":"Occupancy numeric-h","label":"Occupancy","tooltip":"","group":"988388a.75b7578","order":11,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}} %","min":0,"max":"100","step":"5","x":480,"y":1480,"wires":[["29289ff8.7d7f9","af9f52c3.752bf","3a58617b.6d2c7e"]]},{"id":"acf41e52.0f6f","type":"link in","z":"de07c079.634c3","name":"","links":["fa787cd7.2bc46"],"x":765,"y":2500,"wires":[["265b441a.07503c"]]},{"id":"2bfffed7.2d1c12","type":"link in","z":"de07c079.634c3","name":"","links":["53473916.7aade8"],"x":1115,"y":740,"wires":[["25bc3172.06e16e"]]},{"id":"3a58617b.6d2c7e","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"occupancy","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":1580,"wires":[[]]},{"id":"b64fcb50.1a68a8","type":"ui_button","z":"de07c079.634c3","name":"flow hide-h","group":"988388a.75b7578","order":20,"width":"2","height":"1","passthru":false,"label":"Flow","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":510,"y":60,"wires":[["4f170595.98820c"]]},{"id":"7534cff2.d112f","type":"ui_button","z":"de07c079.634c3","name":"Pressure hide-h","group":"988388a.75b7578","order":21,"width":"2","height":"1","passthru":false,"label":"Press","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":520,"y":120,"wires":[["62cf83bb.ae6c6c"]]},{"id":"f0504466.65f2a8","type":"ui_button","z":"de07c079.634c3","name":"RWT hide-h","group":"988388a.75b7578","order":22,"width":"2","height":"1","passthru":false,"label":"RWT","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"","payloadType":"str","topic":"","x":510,"y":180,"wires":[["a1fc4718.a7b338"]]},{"id":"4f170595.98820c","type":"function","z":"de07c079.634c3","name":"","func":"\nvar bookkeeper = context.get('bookkeeper')\nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_Flow\"]}}\n    context.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_Flow\"]}}\n    context.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"bookkeeper\", false)","finalize":"","libs":[],"x":760,"y":60,"wires":[["5bbb7218.399fac","7ff2802.453ef8"]]},{"id":"62cf83bb.ae6c6c","type":"function","z":"de07c079.634c3","name":"","func":"\nvar bookkeeper = context.get('bookkeeper')\nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_Pressure\"]}}\n    context.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_Pressure\"]}}\n    context.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"bookkeeper\", false)","finalize":"","libs":[],"x":760,"y":120,"wires":[["5bbb7218.399fac","4d7f679.ada0798"]]},{"id":"a1fc4718.a7b338","type":"function","z":"de07c079.634c3","name":"","func":"\nvar bookkeeper = context.get('bookkeeper')\nif (bookkeeper == true){\n    msg.payload = {\"group\":{\"hide\":[\"Simulations_RWT\"]}}\n    context.set(\"bookkeeper\",false)\n}\nelse if(bookkeeper == false) {\n    msg.payload = {\"group\":{\"show\":[\"Simulations_RWT\"]}}\n    context.set(\"bookkeeper\",true)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"bookkeeper\", false)","finalize":"","libs":[],"x":760,"y":180,"wires":[["5bbb7218.399fac","913b7924.961218"]]},{"id":"f9785631.8879c8","type":"link in","z":"de07c079.634c3","name":"","links":["f00f2fd6.6bac6","9e8ffa49.963718"],"x":1755,"y":160,"wires":[["5bbb7218.399fac"]]},{"id":"e0abc9a.ad2ff38","type":"link out","z":"de07c079.634c3","name":"start up","links":["c2f8cd64.1ae0d"],"x":455,"y":20,"wires":[]},{"id":"78c7ce0.a5f7034","type":"ui_numeric","z":"de07c079.634c3","name":"SAT Start Temp-h","label":"SAT Start","tooltip":"","group":"988388a.75b7578","order":7,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}} &deg C","min":"20","max":"28","step":1,"x":530,"y":1680,"wires":[["38284ab4.b03e16"]]},{"id":"38284ab4.b03e16","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"Ta_s","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"Ta_s_setting","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":1660,"wires":[[]]},{"id":"3f71fe02.6c3d62","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"22","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1640,"wires":[["78c7ce0.a5f7034"]]},{"id":"7ff2802.453ef8","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":40,"wires":[["6cf193f2.cdbb5c"]]},{"id":"4d7f679.ada0798","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":80,"wires":[["81ae1cf9.47638"]]},{"id":"913b7924.961218","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":120,"wires":[["1aee85f0.480a4a"]]},{"id":"6cf193f2.cdbb5c","type":"link out","z":"de07c079.634c3","name":"to flow","links":["d4e1bc5c.e52e9"],"x":1585,"y":40,"wires":[]},{"id":"81ae1cf9.47638","type":"link out","z":"de07c079.634c3","name":"to press","links":["15a755c1.8ec4aa"],"x":1595,"y":80,"wires":[]},{"id":"1aee85f0.480a4a","type":"link out","z":"de07c079.634c3","name":"to rwt","links":["ef1b9ce8.c7751"],"x":1575,"y":120,"wires":[]},{"id":"ef1b9ce8.c7751","type":"link in","z":"de07c079.634c3","name":"","links":["1aee85f0.480a4a"],"x":1575,"y":1160,"wires":[["308cb11f.f9331e"]]},{"id":"15a755c1.8ec4aa","type":"link in","z":"de07c079.634c3","name":"","links":["81ae1cf9.47638"],"x":1055,"y":840,"wires":[["26b14a63.bda706"]]},{"id":"d4e1bc5c.e52e9","type":"link in","z":"de07c079.634c3","name":"","links":["6cf193f2.cdbb5c"],"x":895,"y":760,"wires":[["25bc3172.06e16e"]]},{"id":"39cfb89c.12bc28","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1840,"wires":[["3f45dd58.478fa2"]]},{"id":"3f45dd58.478fa2","type":"link out","z":"de07c079.634c3","name":"stop","links":["cf0c5393.3d5dd"],"x":735,"y":1840,"wires":[]},{"id":"cf0c5393.3d5dd","type":"link in","z":"de07c079.634c3","name":"","links":["3f45dd58.478fa2"],"x":1095,"y":3140,"wires":[["68e6ec1d.3e2f94"]]},{"id":"3c135799.792f38","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2410,"y":2080,"wires":[]},{"id":"6361e7.f7d56e18","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2690,"y":1700,"wires":[]},{"id":"5a7128cc.a78fe8","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":2400,"y":2380,"wires":[]},{"id":"1529109f.61c03f","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"dot_T","targetType":"msg","statusVal":"payload","statusType":"auto","x":2410,"y":2260,"wires":[]},{"id":"cdbd7705.fd1478","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":2680,"y":1760,"wires":[]},{"id":"299dc1e2.e9f63e","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"dot_T ","targetType":"msg","statusVal":"payload","statusType":"auto","x":2690,"y":1820,"wires":[]},{"id":"4079e149.71d18","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1970,"y":2220,"wires":[]},{"id":"955015f9.d2b348","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":1960,"y":2280,"wires":[]},{"id":"80eff8ac.0bdd58","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"dot_T","targetType":"msg","statusVal":"payload","statusType":"auto","x":1970,"y":2460,"wires":[]},{"id":"610594ea.13e0ec","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1970,"y":1880,"wires":[]},{"id":"f98f1030.d08a2","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":1960,"y":1940,"wires":[]},{"id":"70653dd2.6f85a4","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"dot_T","targetType":"msg","statusVal":"payload","statusType":"auto","x":1970,"y":2120,"wires":[]},{"id":"21e17550.f4573a","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Tw_r","targetType":"msg","statusVal":"payload","statusType":"auto","x":2680,"y":1880,"wires":[]},{"id":"c4d4f52a.dc55c8","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Tw_s","targetType":"msg","statusVal":"payload","statusType":"auto","x":2680,"y":1940,"wires":[]},{"id":"6ccdd114.8379b","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Ta_r","targetType":"msg","statusVal":"payload","statusType":"auto","x":2480,"y":2140,"wires":[]},{"id":"24df771a.672ee8","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Ta_s","targetType":"msg","statusVal":"payload","statusType":"auto","x":2580,"y":2180,"wires":[]},{"id":"7338a9f.3add958","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1130,"y":1520,"wires":[]},{"id":"6d254e9e.26208","type":"debug","z":"a37ace7a.dab1a","name":"","active":false,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1730,"y":1740,"wires":[]},{"id":"4af9f642.9314a8","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Tw_r","targetType":"msg","statusVal":"payload","statusType":"auto","x":1960,"y":2000,"wires":[]},{"id":"18aa787f.d4fc38","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Tw_s","targetType":"msg","statusVal":"payload","statusType":"auto","x":1960,"y":2060,"wires":[]},{"id":"42b53822.8a8928","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Ta_r","targetType":"msg","statusVal":"payload","statusType":"auto","x":1960,"y":2340,"wires":[]},{"id":"48d69626.4b2028","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Ta_s","targetType":"msg","statusVal":"payload","statusType":"auto","x":1960,"y":2400,"wires":[]},{"id":"266d9458.f6115c","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"O","targetType":"msg","statusVal":"payload","statusType":"auto","x":2390,"y":2440,"wires":[]},{"id":"8337c9db.96c218","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Ta_r1","targetType":"msg","statusVal":"payload","statusType":"auto","x":1090,"y":1580,"wires":[]},{"id":"a0e8b60b.c48948","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"Ts","targetType":"msg","statusVal":"payload","statusType":"auto","x":2420,"y":2320,"wires":[]},{"id":"4d3af8de.7df298","type":"inject","z":"de07c079.634c3","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":70,"y":2640,"wires":[["1fe719bd.db5416"]]},{"id":"e2603c8.da51cc","type":"inject","z":"de07c079.634c3","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"27","payloadType":"num","x":110,"y":2580,"wires":[["1fe719bd.db5416"]]},{"id":"5ce49240.93acbc","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"p","targetType":"msg","statusVal":"payload","statusType":"auto","x":2650,"y":2240,"wires":[]},{"id":"58223a16.68e2f4","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1190,"y":2060,"wires":[]},{"id":"7e6ff0f5.d4456","type":"debug","z":"de07c079.634c3","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1170,"y":2500,"wires":[]},{"id":"e1bf8990.02e118","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1350,"y":2500,"wires":[]},{"id":"740427d8.341ec8","type":"debug","z":"a37ace7a.dab1a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1170,"y":2500,"wires":[]},{"id":"5603fafc.c74764","type":"function","z":"de07c079.634c3","d":true,"name":"Format Data","func":"// this is where you define the legend for \n// the datasets\n//var title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data1')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data1\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2690,"y":440,"wires":[["8c17e009.be91d"]]},{"id":"8c17e009.be91d","type":"template","z":"de07c079.634c3","d":true,"name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 10,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Head [m]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":2740,"y":600,"wires":[["c460dad.98aed28"]]},{"id":"c460dad.98aed28","type":"ui_template","z":"de07c079.634c3","group":"886dc0ab.cbd76","name":"Scatter Plot-h","order":1,"width":"6","height":"6","format":"this will be ignored","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":3300,"y":660,"wires":[[]]},{"id":"d82611c.9a16bf","type":"link in","z":"de07c079.634c3","name":"","links":["65abf0d5.8ff66"],"x":2395,"y":440,"wires":[["5603fafc.c74764","f38808fa.965338"]]},{"id":"834ec305.920fe","type":"switch","z":"de07c079.634c3","name":"Flow Head","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"6","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":2830,"y":320,"wires":[["2759de7f.3489b2"],["5d24c26b.69830c"],["4f1e7bd8.a9d384"]]},{"id":"f38808fa.965338","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"actual_c_mode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":2570,"y":360,"wires":[["834ec305.920fe","540f38e2.866a88"]]},{"id":"576a5850.01ed78","type":"function","z":"de07c079.634c3","name":"prepare all data","func":"var legend1 = \"DPS\";\nvar legend2 = \"Constant Head\";\nvar legend3 = \"Prop. Press.\";\nvar title = \"Pump Duty Point\"\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nvar data1 = flow.get('data1')||'';\n\nvar data2 = flow.get('data2')||'';\n\nvar data3 = flow.get('data3')||'';\n\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"legend2\" : legend2,\n                \"data2\"   : data2,\n                \"legend3\" : legend3,\n                \"data3\"   : data3\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3110,"y":500,"wires":[["79c6d407.fe239c"]]},{"id":"4f1e7bd8.a9d384","type":"function","z":"de07c079.634c3","name":"Format Data - DPS","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data1')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data1\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3030,"y":380,"wires":[["576a5850.01ed78"]]},{"id":"2759de7f.3489b2","type":"function","z":"de07c079.634c3","name":"Format Data - Constant","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data2')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data2\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3050,"y":280,"wires":[["576a5850.01ed78"]]},{"id":"5d24c26b.69830c","type":"function","z":"de07c079.634c3","name":"Format Data - prop","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data3')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('head')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data3\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3030,"y":320,"wires":[["576a5850.01ed78","e1c25f31.b2bc1"]]},{"id":"79c6d407.fe239c","type":"template","z":"de07c079.634c3","name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend2}}}\",\n          backgroundColor: \"rgba(137, 0, 39, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data2}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend3}}}\",\n          backgroundColor: \"rgba(244, 149, 0, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data3}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 9,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Head [m]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":3120,"y":580,"wires":[["c460dad.98aed28"]]},{"id":"540f38e2.866a88","type":"switch","z":"de07c079.634c3","name":"Flow Power","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"6","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":2850,"y":780,"wires":[["d798b64.6606148"],["ff2455c0.3fb178"],["1242bbd2.8c1bf4"]]},{"id":"ae82d106.e7d35","type":"function","z":"de07c079.634c3","name":"prepare all data","func":"var legend1 = \"DPS\";\nvar legend2 = \"Constant Head\";\nvar legend3 = \"Prop. Press.\";\nvar title = \"Power / Flow\"\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nvar data1 = flow.get('data4')||'';\n\nvar data2 = flow.get('data5')||'';\n\nvar data3 = flow.get('data6')||'';\n\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"legend2\" : legend2,\n                \"data2\"   : data2,\n                \"legend3\" : legend3,\n                \"data3\"   : data3\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3130,"y":960,"wires":[["a3e8d4a3.c6fd48"]]},{"id":"1242bbd2.8c1bf4","type":"function","z":"de07c079.634c3","name":"Format Data - DPS","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data4')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('W')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data4\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3050,"y":840,"wires":[["ae82d106.e7d35"]]},{"id":"d798b64.6606148","type":"function","z":"de07c079.634c3","name":"Format Data - Constant","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data5')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('W')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data5\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3070,"y":740,"wires":[["ae82d106.e7d35"]]},{"id":"ff2455c0.3fb178","type":"function","z":"de07c079.634c3","name":"Format Data - prop","func":"// this is where you define the legend for \n// the datasets\nvar title = \"Pump Duty Point\";\nvar legend1 = \"legend1\";\n\n// variables to be used to \nvar i, x, y, data1\ndata1 = flow.get('data6')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 998) {\n    count = 1;\n    data1 = '{x: 0,  y: 0},'; // Force the size of the\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = global.get('Flow')||0;\ny = global.get('W')||0;\n\ndata1 += \"{x: \"+x+\", y: \"+y+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                };\ndata1 += \",\";\n\n//flow.set([\"data1\", \"data2\"], [data1, data2]);\nflow.set([\"data6\"], [data1]);\n\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3050,"y":780,"wires":[["ae82d106.e7d35","31eda626.7c5dfa"]]},{"id":"a3e8d4a3.c6fd48","type":"template","z":"de07c079.634c3","name":"Format HTML","field":"template","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<canvas id=\"bubble-chart\" width=\"90%\" height=\"90%\" margin=\"auto\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'scatter',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend2}}}\",\n          backgroundColor: \"rgba(137, 0, 39, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data2}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend3}}}\",\n          backgroundColor: \"rgba(244, 149, 0, 1.0000)\",\n          borderColor: \"#000\",\n          fill: false,\n          showLine: false,\n          data: [\n            {{{payload.data3}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: false,\n            labels: {\n                fontColor: 'rgb(255, 255, 255)'\n            }\n        },\n    title: {\n        display: false,\n        text: '{{{payload.title}}}',\n        fontColor: 'rgb(255, 255, 255)'\n      },\n      scales: {\n        yAxes: [{\n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 200,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Power [W]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          },\n         \n        }],\n        xAxes: [{ \n          ticks: {\n            beginAtZero:true,\n            fontColor: 'rgb(255, 255, 255,0.5)',\n            suggestedMax: 5,\n          },\n          gridLines: {\n            display: true,\n            drawBorder: true,\n            color: 'rgb(255, 255, 255,0.1)',\n        },\n          scaleLabel: {\n            display: true,\n            labelString: \"Flow [m\\u00B3/h]\",\n            fontColor: 'rgb(255, 255, 255)',\n            \n          }\n        }]\n      }\n    }\n});\n\n</script>\n","output":"str","x":3140,"y":1040,"wires":[["c1a3273b.1d6cf8"]]},{"id":"c1a3273b.1d6cf8","type":"ui_template","z":"de07c079.634c3","group":"3ba8e044.13894","name":"Scatter Plot-h","order":1,"width":"6","height":"6","format":"this will be ignored","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":3320,"y":1100,"wires":[[]]},{"id":"537abe63.0f7f1","type":"change","z":"de07c079.634c3","name":"","rules":[{"t":"delete","p":"data1","pt":"flow"},{"t":"delete","p":"count","pt":"flow"},{"t":"delete","p":"data2","pt":"flow"},{"t":"delete","p":"data3","pt":"flow"},{"t":"delete","p":"data4","pt":"flow"},{"t":"delete","p":"data5","pt":"flow"},{"t":"delete","p":"data6","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":3700,"y":760,"wires":[[]]},{"id":"96cbb38.616965","type":"ui_button","z":"de07c079.634c3","name":"Flow Power Switch-h","group":"886dc0ab.cbd76","order":3,"width":"3","height":"1","passthru":true,"label":"Flow / Power","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"{\"group\":{\"hide\":[\"Simulations_Pump_Duty_Point\"],\"show\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3480,"y":880,"wires":[["9e8ffa49.963718"]]},{"id":"b3797fd3.2b359","type":"ui_button","z":"de07c079.634c3","name":"Duty Point Switch-h","group":"3ba8e044.13894","order":3,"width":"3","height":"1","passthru":true,"label":"Duty Point","tooltip":"","color":"","bgcolor":"#9d0027","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Pump_Duty_Point\"],\"hide\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3470,"y":800,"wires":[["9e8ffa49.963718"]]},{"id":"9e8ffa49.963718","type":"link out","z":"de07c079.634c3","name":"To UI Control","links":["f9785631.8879c8"],"x":3680,"y":840,"wires":[],"l":true},{"id":"c8e689ca.574e88","type":"ui_button","z":"de07c079.634c3","name":"Duty Clear-h","group":"886dc0ab.cbd76","order":2,"width":"3","height":"1","passthru":false,"label":"Clear Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Pump_Duty_Point\"],\"hide\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3350,"y":720,"wires":[["537abe63.0f7f1"]]},{"id":"bbf091db.77a22","type":"ui_button","z":"de07c079.634c3","name":"Power Clear-h","group":"3ba8e044.13894","order":2,"width":"3","height":"1","passthru":false,"label":"Clear Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"show\":[\"Simulations_Pump_Duty_Point\"],\"hide\":[\"Simulations_Power_Flow\"]}}","payloadType":"json","topic":"","x":3360,"y":760,"wires":[["537abe63.0f7f1"]]},{"id":"c2f8cd64.1ae0d","type":"link in","z":"de07c079.634c3","name":"","links":["e0abc9a.ad2ff38"],"x":3295,"y":880,"wires":[["b3797fd3.2b359"]]},{"id":"e1c25f31.b2bc1","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3310,"y":280,"wires":[]},{"id":"31eda626.7c5dfa","type":"debug","z":"de07c079.634c3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3360,"y":946.5999755859375,"wires":[]}]
